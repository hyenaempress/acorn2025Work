# 22.03 가설 검정(Hypothesis Testing) 완전 가이드

## 📚 목차
1. [가설 검정의 핵심 개념](#-가설-검정의-핵심-개념)
2. [P-value의 완전한 이해](#-p-value의-완전한-이해)
3. [검정 통계량과 신뢰도](#-검정-통계량과-신뢰도)
4. [가설 검정 절차](#-가설-검정-절차)
5. [척도에 따른 분석 방법](#-척도에-따른-분석-방법)
6. [구체적 검정 방법들](#-구체적-검정-방법들)
7. [실무 적용 예제](#-실무-적용-예제)

---

## 🎯 가설 검정의 핵심 개념

### 📊 가설 검정이란?
**가설 검정**은 표본 데이터를 통해 모집단의 특성에 대한 주장(가설)이 타당한지를 통계적으로 판단하는 과정입니다.

```python
# 가설 검정의 기본 구조
def hypothesis_testing_concept():
    concept = {
        "목적": "표본으로 모집단의 특성 추론",
        "방법": "확률을 이용한 과학적 의사결정",
        "핵심": "우연인가? 의미있는 차이인가?",
        "결과": "H₀ 채택 또는 기각"
    }
    return concept
```

### ⚖️ 귀무가설 vs 대립가설

#### 🔹 귀무가설 (H₀, Null Hypothesis)
- **특징**: 현상유지, 보수적 입장
- **표현**: "차이가 없다", "효과가 없다", "관계가 없다"
- **기호**: =, ≥, ≤
- **예시**: "μ = 150" (평균이 150과 같다)

#### 🔹 대립가설 (H₁, Alternative Hypothesis)
- **특징**: 변화 추구, 혁신적 입장  
- **표현**: "차이가 있다", "효과가 있다", "관계가 있다"
- **기호**: ≠, <, >
- **예시**: "μ ≠ 150" (평균이 150과 다르다)

### 📋 가설 설정 예제

| 상황 | 귀무가설 (H₀) | 대립가설 (H₁) |
|------|---------------|---------------|
| 신약 효과 검증 | 신약 효과 없음 | 신약 효과 있음 |
| 음식점 분량 의혹 | μ = 150g | μ ≠ 150g |
| 성별에 따른 키 차이 | μ₁ = μ₂ | μ₁ ≠ μ₂ |
| 교육방법 효과 | 방법간 차이 없음 | 방법간 차이 있음 |

---

## 🔬 P-value의 완전한 이해

### 🎯 강사님이 강조하신 핵심 - "95%보다 높다"의 진정한 의미

> **강사님 원문**: "P-value가 0.05보다 작다는 얘기는 뭔가가 95%보다 높다는 얘기입니다. 95% 이상 신뢰할 수 있다"

#### 🤔 **"무엇이 95%보다 높다"는 건가?**

```python
def explain_95_percent_concept():
    """강사님이 말씀하신 '95%보다 높다'의 정확한 의미"""
    
    print("🎯 '95%보다 높다'는 것은...")
    print("=" * 50)
    
    concepts = {
        "❌ 틀린 이해": [
            "P-value 자체가 95%보다 크다 (P-value는 0.05 = 5%)",
            "가설이 참일 확률이 95%다",
            "실험 성공률이 95%다"
        ],
        
        "✅ 정확한 이해": [
            "신뢰도(Confidence Level)가 95%다",
            "검정 결과를 믿을 수 있는 정도가 95%다", 
            "같은 실험을 100번 하면 95번은 올바른 결론을 낸다",
            "제1종 오류(잘못 기각)를 범할 확률이 5% 미만이다"
        ]
    }
    
    for category, explanations in concepts.items():
        print(f"\n{category}:")
        for explanation in explanations:
            print(f"   • {explanation}")
    
    return concepts

explain_95_percent_concept()
```

#### 📊 **신뢰도 95%의 구체적 의미**

| 개념 | P-value | 신뢰도 | 실제 의미 |
|------|---------|---------|-----------|
| **우연일 확률** | 0.05 (5%) | - | 이 결과가 우연히 나올 확률 |
| **신뢰할 확률** | - | 0.95 (95%) | 이 결과를 믿을 수 있는 정도 |
| **관계식** | P-value + 신뢰도 = 1.00 (100%) | | |

#### 🎯 **구체적 예시로 이해하기**

```python
def concrete_example_95_percent():
    """구체적 예시로 95% 신뢰도 이해하기"""
    
    print("🥩 예시: 음식점 분량 검증")
    print("=" * 40)
    
    scenario = {
        "상황": "음식점이 150g을 준다고 주장, 실제 측정해보니 평균 145g",
        "검정결과": "P-value = 0.023",
        "해석": {
            "P-value 의미": "우연히 이런 결과가 나올 확률 = 2.3%",
            "신뢰도 의미": "이 결과를 믿을 수 있는 정도 = 97.7%",
            "실무적 해석": "97.7% 확신으로 음식점이 150g을 안 준다고 결론"
        }
    }
    
    for key, value in scenario.items():
        if isinstance(value, dict):
            print(f"\n📊 {key}:")
            for sub_key, sub_value in value.items():
                print(f"   {sub_key}: {sub_value}")
        else:
            print(f"\n🎯 {key}: {value}")
    
    # 100번 실험했을 때의 의미
    print(f"\n🔄 만약 같은 실험을 100번 반복한다면:")
    print("   • 97번: 올바른 결론 (음식점이 150g 안 줌)")
    print("   • 3번: 잘못된 결론 (실제로는 150g 주는데 안 준다고 판단)")
    
    return scenario

concrete_example_95_percent()
```

#### 📊 P-value와 신뢰도의 관계

- **P-value = 0.05**: 우연일 확률 5% → **신뢰도 95%**
- **P-value = 0.01**: 우연일 확률 1% → **신뢰도 99%**  
- **P-value = 0.001**: 우연일 확률 0.1% → **신뢰도 99.9%**

**핵심**: P-value가 작을수록 신뢰도가 높아진다!

#### 🎯 P-value란?
- **정의**: 귀무가설이 참일 때, 관측된 결과나 그보다 극단적인 결과가 우연히 나올 확률
- **범위**: 0 ≤ P-value ≤ 1
- **핵심**: 작을수록 강력한 증거

### 🧠 **강사님의 핵심 메시지 완전 해부**

#### 🔍 **"무한대 분의 무한대"와 신뢰도의 관계**

> **강사님**: "무한대 분의 무한대 중에서 무한대 분의 일로 샘플링 했어. 그래서 이 샘플링된 데이터를 가지고 모집단의 모수를 추론하는데, 그때 P-value가 0.05보다 작으면 그거는 의미가 있다. 신뢰할 수 있다."

```python
def sampling_and_confidence():
    """샘플링과 신뢰도의 철학적 관계"""
    
    print("🌌 샘플링의 근본적 문제")
    print("=" * 40)
    
    sampling_logic = {
        "1️⃣ 현실의 딜레마": {
            "상황": "모집단 전체 조사는 불가능",
            "해결책": "극히 일부(표본)만 조사",
            "문제": "일부로 전체를 판단하는 위험성"
        },
        
        "2️⃣ 통계적 해결책": {
            "도구": "P-value라는 신뢰도 지표 도입",
            "논리": "우연일 가능성이 5% 미만이면 믿을 만함",
            "결과": "95% 확신으로 결론 도출 가능"
        },
        
        "3️⃣ 실무적 의미": {
            "before": "단순 추측: '아마 이럴 거야'",
            "after": "과학적 판단: '95% 확신으로 이렇다'",
            "가치": "의사결정의 객관적 근거 제공"
        }
    }
    
    for step, details in sampling_logic.items():
        print(f"\n{step}")
        for aspect, content in details.items():
            print(f"   {aspect}: {content}")
    
    print(f"\n🎯 핵심 통찰:")
    print("   극히 일부 데이터 → P-value로 신뢰도 검증 → 95% 확신의 결론")
    
    return sampling_logic

sampling_and_confidence()
```

#### 💡 **왜 95%가 기준인가?**

```python
def why_95_percent():
    """95% 기준의 역사적, 실용적 배경"""
    
    print("🤔 왜 하필 95%인가?")
    print("=" * 30)
    
    reasons = {
        "📚 역사적 이유": [
            "통계학자들이 관습적으로 정한 기준",
            "Ronald Fisher가 제안한 '합리적 의심' 수준",
            "과학 연구에서 널리 받아들여진 표준"
        ],
        
        "⚖️ 실용적 이유": [
            "너무 엄격하면(99%) 좋은 아이디어도 거부",
            "너무 관대하면(90%) 잘못된 결론 위험",  
            "95%는 엄격함과 실용성의 적절한 균형"
        ],
        
        "🏢 산업별 기준": [
            "의료/제약: 99% 이상 (생명과 직결)",
            "사회과학: 95% (일반적 연구)",
            "탐색적 연구: 90% (초기 검증 단계)"
        ]
    }
    
    for category, explanations in reasons.items():
        print(f"\n{category}:")
        for explanation in explanations:
            print(f"   • {explanation}")
    
    print(f"\n🎯 결론: 95%는 과학적 합의의 결과")
    
    return reasons

why_95_percent()
```

#### 🎮 **실생활 비유로 이해하기**

```python
def real_life_analogy():
    """95% 신뢰도를 실생활로 비유"""
    
    print("🎮 게임으로 이해하는 95% 신뢰도")
    print("=" * 45)
    
    analogies = {
        "🎯 양궁 선수": {
            "상황": "양궁 선수가 10발 중 9.5발을 과녁에 맞춤",
            "의미": "95% 확률로 성공할 수 있는 실력",
            "통계": "P-value < 0.05 = 95% 확신의 결론"
        },
        
        "🌧️ 일기예보": {
            "상황": "비 올 확률 95%라고 예보",
            "의미": "우산 챙길 만큼 확실한 상황",
            "통계": "결과를 믿고 행동할 만한 근거"
        },
        
        "🏥 의료진단": {
            "상황": "의사가 95% 확신으로 진단",
            "의미": "치료 결정을 내릴 만한 확실성",
            "통계": "가설을 기각할 만한 증거"
        }
    }
    
    for scenario, details in analogies.items():
        print(f"\n{scenario}")
        for key, value in details.items():
            print(f"   {key}: {value}")
    
    print(f"\n💡 공통점: 모두 '행동을 취할 만큼 확실한' 수준")
    
    return analogies

real_life_analogy()
```

```python
def interpret_pvalue(p_value, alpha=0.05):
    """P-value 해석 함수"""
    
    interpretations = {
        "p < 0.001": "매우 강한 증거 (***)",
        "0.001 ≤ p < 0.01": "강한 증거 (**)",  
        "0.01 ≤ p < 0.05": "보통 증거 (*)",
        "0.05 ≤ p < 0.10": "약한 증거 (·)",
        "p ≥ 0.10": "증거 없음 (n.s.)"
    }
    
    if p_value < alpha:
        decision = "H₀ 기각 → 대립가설 채택"
        meaning = "통계적으로 유의함"
    else:
        decision = "H₀ 채택 → 대립가설 기각"
        meaning = "통계적으로 유의하지 않음"
    
    return decision, meaning
```

### 📊 유의수준(α)과 P-value 관계

| 유의수준 | 신뢰수준 | 의미 | 사용 목적 |
|----------|----------|------|----------|
| α = 0.10 | 90% | 10% 오류 허용 | 탐색적 연구 |
| **α = 0.05** | **95%** | **5% 오류 허용** | **일반적 기준** |
| α = 0.01 | 99% | 1% 오류 허용 | 엄격한 기준 |

**판정 기준**:
- **P-value < α**: H₀ 기각 (통계적으로 유의)
- **P-value ≥ α**: H₀ 채택 (통계적으로 유의하지 않음)

---

## 📈 검정 통계량과 신뢰도

### 🔢 검정 통계량의 의미

> **강사님 설명**: "무한대 분의 무한대 중에서 무한대 분의 일로 샘플링 했어. 그래서 이 샘플링된 데이터를 가지고 모집단의 모수를 추론하는데, 그때 P-value가 0.05보다 작으면 그거는 의미가 있다. 신뢰할 수 있다."

#### 📊 샘플링과 신뢰도의 관계
```python
def sampling_reliability():
    """샘플링과 신뢰도 관계 설명"""
    
    concept = {
        "표본의 한계": "무한대 분의 일 (극히 일부)",
        "추론의 위험": "일부로 전체 판단의 위험성",
        "P-value 역할": "이 위험을 수치화한 지표",
        "신뢰도": "95% 이상 믿을 수 있는 근거"
    }
    
    return concept
```

### 🎯 검정 통계량의 종류

| 검정 | 통계량 | 사용 상황 | 분포 |
|------|--------|-----------|------|
| Z-검정 | Z값 | σ 알고 있는 경우 | 표준정규분포 |
| t-검정 | t값 | σ 모르는 경우 | t분포 |
| 카이제곱검정 | χ²값 | 범주형 데이터 | 카이제곱분포 |
| F-검정 | F값 | 분산 비교, ANOVA | F분포 |

---

## 📋 가설 검정 절차

### 🔄 7단계 완전 절차

```python
def hypothesis_testing_procedure():
    """가설 검정 7단계 절차"""
    
    steps = {
        "1단계": "연구 문제 정의",
        "2단계": "가설 설정 (H₀ vs H₁)",
        "3단계": "유의수준 결정 (α = 0.05)",
        "4단계": "적절한 검정 방법 선택",
        "5단계": "검정 통계량 계산",
        "6단계": "P-value 계산 및 비교",
        "7단계": "결론 도출 및 해석"
    }
    
    return steps
```

### 🎯 실무 예제: 음식점 분량 검증

```python
import scipy.stats as stats
import numpy as np

# 1단계: 문제 정의
문제 = "음식점이 주장하는 150g이 맞는가?"

# 2단계: 가설 설정
H0 = "μ = 150g (음식점 주장)"
H1 = "μ ≠ 150g (고객 의혹)"

# 3단계: 유의수준
alpha = 0.05

# 4단계: 검정 선택
검정방법 = "일표본 t검정"

# 5단계: 데이터 수집 및 검정통계량 계산
np.random.seed(42)
sample_weights = np.random.normal(145, 8, 30)  # 실제로는 145g
t_stat, p_value = stats.ttest_1samp(sample_weights, 150)

# 6단계: P-value 비교
print(f"P-value: {p_value:.6f}")
print(f"α: {alpha}")

# 7단계: 결론
if p_value < alpha:
    결론 = "H₀ 기각 → 150g이 아니다!"
else:
    결론 = "H₀ 채택 → 150g이 맞다"

print(f"결론: {결론}")
```

---

## 📊 척도에 따른 분석 방법

### 🔍 척도의 종류

#### 📋 척도 분류
1. **명목척도**: 단순 분류 (성별, 혈액형)
2. **서열척도**: 순서 있음 (성적 등급, 만족도)  
3. **등간척도**: 간격 의미 (온도, 지수)
4. **비율척도**: 절대 영점 (키, 몸무게, 소득)

### 🎯 독립변수-종속변수에 따른 검정 선택

| 독립변수 | 종속변수 | 분석방법 | 예시 |
|----------|----------|----------|------|
| 범주형 | 범주형 | **카이제곱검정** | 성별×선호도 |
| 범주형(2그룹) | 연속형 | **t검정** | 남녀 키 차이 |
| 범주형(3그룹+) | 연속형 | **ANOVA** | 학과별 성적 |
| 연속형 | 범주형 | **로지스틱회귀** | 소득→구매여부 |
| 연속형 | 연속형 | **회귀분석** | 공부시간→성적 |

---

## 🔬 구체적 검정 방법들

### 1️⃣ 카이제곱 검정

#### 📊 일원 카이제곱 (적합도/선호도 검정)
```python
from scipy.stats import chisquare

# 예시: 주사위 공정성 검증
observed = [4, 10, 17, 16, 8, 9]  # 관측값
expected = [10, 10, 10, 10, 10, 10]  # 기대값

chi2_stat, p_value = chisquare(observed, expected)

if p_value < 0.05:
    print("주사위가 공정하지 않다")
else:
    print("주사위가 공정하다")
```

#### 🔄 이원 카이제곱 (독립성/동질성 검정)
```python
from scipy.stats import chi2_contingency

# 예시: 성별과 흡연의 관련성
contingency_table = [
    [150, 50],   # 남성: 비흡연, 흡연
    [200, 30]    # 여성: 비흡연, 흡연
]

chi2, p_value, dof, expected = chi2_contingency(contingency_table)

if p_value < 0.05:
    print("성별과 흡연은 관련이 있다")
else:
    print("성별과 흡연은 관련이 없다")
```

### 2️⃣ t검정

#### 📊 일표본 t검정
```python
from scipy.stats import ttest_1samp

# 예시: 학생들 평균 점수가 75점인가?
scores = [78, 85, 72, 90, 88, 76, 82, 79, 86, 74]
t_stat, p_value = ttest_1samp(scores, 75)

print(f"t통계량: {t_stat:.4f}")
print(f"P-value: {p_value:.6f}")
```

#### 🔄 독립표본 t검정
```python
from scipy.stats import ttest_ind

# 예시: 남녀 키 평균 차이
male_height = [175, 178, 172, 180, 176, 174, 179, 173]
female_height = [162, 165, 160, 168, 164, 166, 163, 161]

t_stat, p_value = ttest_ind(male_height, female_height)

if p_value < 0.05:
    print("남녀 키 평균에 유의한 차이가 있다")
else:
    print("남녀 키 평균에 유의한 차이가 없다")
```

#### 🔄 대응표본 t검정
```python
from scipy.stats import ttest_rel

# 예시: 수술 전후 체중 변화
before = [67.2, 67.4, 71.5, 77.6, 86.0, 89.1, 59.5, 81.9, 105.5]
after = [62.4, 64.6, 70.4, 62.6, 80.1, 73.2, 58.2, 71.0, 101.0]

t_stat, p_value = ttest_rel(before, after)

if p_value < 0.05:
    print("수술 전후 체중에 유의한 차이가 있다")
else:
    print("수술 전후 체중에 유의한 차이가 없다")
```

### 3️⃣ ANOVA (분산분석)

#### 📊 일원분산분석
```python
from scipy.stats import f_oneway

# 예시: 세 가지 교육방법의 효과 비교
method1 = [85, 87, 82, 88, 86, 84, 89, 83]
method2 = [78, 80, 76, 82, 79, 77, 81, 75]
method3 = [90, 92, 88, 94, 91, 89, 93, 87]

f_stat, p_value = f_oneway(method1, method2, method3)

if p_value < 0.05:
    print("교육방법 간 유의한 차이가 있다")
    print("→ 사후검정(Post-hoc) 필요")
else:
    print("교육방법 간 유의한 차이가 없다")
```

### 4️⃣ 비율 검정

#### 📊 일표본 비율 검정
```python
from statsmodels.stats.proportion import proportions_ztest

# 예시: 회사 흡연율이 35%인가?
count = 45  # 흡연자 수
nobs = 100  # 전체 인원
expected_rate = 0.35

z_stat, p_value = proportions_ztest(count, nobs, expected_rate)

if p_value < 0.05:
    print("회사 흡연율이 35%와 다르다")
else:
    print("회사 흡연율이 35%와 같다")
```

---

## 💼 실무 적용 예제

### 🎯 종합 분석 함수

```python
def comprehensive_hypothesis_test(data, test_type, **kwargs):
    """실무용 종합 가설검정 함수"""
    
    import scipy.stats as stats
    import numpy as np
    
    print("=" * 60)
    print(f"📊 {test_type} 가설검정 결과")
    print("=" * 60)
    
    # 기본 정보
    print(f"📋 데이터 정보:")
    print(f"   표본 크기: {len(data)}")
    print(f"   평균: {np.mean(data):.3f}")
    print(f"   표준편차: {np.std(data, ddof=1):.3f}")
    
    # 검정 수행
    if test_type == "일표본 t검정":
        mu_0 = kwargs.get('mu_0', 0)
        t_stat, p_value = stats.ttest_1samp(data, mu_0)
        print(f"\n🔍 검정 통계량:")
        print(f"   t값: {t_stat:.4f}")
        print(f"   P-value: {p_value:.6f}")
        
    elif test_type == "정규성 검정":
        stat, p_value = stats.shapiro(data)
        print(f"\n🔍 정규성 검정 (Shapiro-Wilk):")
        print(f"   통계량: {stat:.4f}")
        print(f"   P-value: {p_value:.6f}")
    
    # 결과 해석
    alpha = kwargs.get('alpha', 0.05)
    print(f"\n📊 결과 해석 (α = {alpha}):")
    
    if p_value < 0.001:
        significance = "매우 강한 증거 (***)"
    elif p_value < 0.01:
        significance = "강한 증거 (**)"
    elif p_value < 0.05:
        significance = "보통 증거 (*)"
    elif p_value < 0.10:
        significance = "약한 증거 (·)"
    else:
        significance = "증거 없음 (n.s.)"
    
    print(f"   유의성 수준: {significance}")
    
    if p_value < alpha:
        print(f"   ✅ 결론: H₀ 기각 (p < {alpha})")
        print("   → 통계적으로 유의한 차이가 있음")
    else:
        print(f"   ❌ 결론: H₀ 채택 (p ≥ {alpha})")
        print("   → 통계적으로 유의한 차이가 없음")
    
    return p_value, significance

# 사용 예시
np.random.seed(42)
sample_data = np.random.normal(152, 10, 50)
result = comprehensive_hypothesis_test(
    sample_data, 
    "일표본 t검정", 
    mu_0=150, 
    alpha=0.05
)
```

### 📊 의사결정 트리

```python
def statistical_decision_tree():
    """통계적 의사결정 트리"""
    
    decision_flow = {
        "데이터 타입 확인": {
            "범주형 데이터": {
                "1개 변수": "카이제곱 적합도 검정",
                "2개 변수": "카이제곱 독립성 검정"
            },
            "연속형 데이터": {
                "1개 집단": "일표본 t검정",
                "2개 집단": {
                    "독립": "독립표본 t검정",
                    "대응": "대응표본 t검정"
                },
                "3개 이상 집단": "ANOVA"
            }
        }
    }
    
    return decision_flow
```

---

## 🏆 핵심 포인트 정리

### 🎯 가설검정 마스터 체크리스트

```python
def master_checklist():
    """가설검정 마스터 체크리스트"""
    
    checklist = {
        "✅ 개념 이해": [
            "P-value의 정확한 의미 파악",
            "귀무가설 vs 대립가설 구분",
            "유의수준과 신뢰수준 관계",
            "검정통계량의 역할 이해"
        ],
        "✅ 절차 숙지": [
            "7단계 절차 완벽 암기",
            "가설 설정의 원칙",
            "적절한 검정 방법 선택",
            "결과 해석과 의사결정"
        ],
        "✅ 실무 활용": [
            "Python/R 도구 활용",
            "데이터 타입별 검정 선택",
            "결과의 실무적 의미 파악",
            "보고서 작성 능력"
        ]
    }
    
    return checklist
```

### 🚨 주의사항

1. **통계적 유의성 ≠ 실무적 중요성**
2. **P-hacking 주의**: 원하는 결과 얻을 때까지 반복 금지
3. **다중검정 문제**: 여러 검정 시 α 수준 조정 필요
4. **가정 확인**: 정규성, 등분산성 등 검정 가정 확인
5. **효과크기**: P-value와 함께 효과크기도 고려

---

## 📚 다음 학습 단계

### 🗺️ 학습 로드맵
1. **현재 완료**: 가설검정 기초 이론 ✅
2. **다음 단계**: 
   - 고급 검정 방법 (비모수 검정, 베이지안)
   - 다변량 분석 (회귀분석, 주성분분석)
   - 기계학습과 통계의 연결
   - 실무 프로젝트 적용

### 🎯 성공 공식
**이론 이해 + 도구 활용 + 실무 적용 = 통계 전문가!**

---

> **🎓 축하합니다!** 가설검정의 핵심 개념부터 실무 활용까지 완벽하게 마스터했습니다! 이제 여러분은 데이터로 의사결정할 수 있는 강력한 도구를 손에 넣었습니다. 🎉
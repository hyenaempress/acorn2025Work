# 카이제곱 검정 분석 보고서

## 개요
이 보고서는 두 가지 카이제곱 독립성 검정을 수행한 결과를 정리한 문서입니다.
- **문제 1**: 부모 학력 수준과 자녀 진학 여부의 관련성 분석
- **문제 2**: 직급과 연봉의 관련성 분석

---

## 문제 1: 부모 학력 수준과 자녀 진학 여부의 관련성 검정

### 1.1 문제 설정
- **데이터**: cleanDescriptive.csv 파일의 `level2` (부모 학력), `pass2` (자녀 진학 여부) 변수
- **조건**: NA 값이 있는 행 제외

### 1.2 가설 설정
- **귀무가설 (H₀)**: 부모 학력 수준과 자녀의 대학 진학 여부는 서로 관련이 없다 (독립)
- **대립가설 (H₁)**: 부모 학력 수준과 자녀의 대학 진학 여부는 서로 관련이 있다 (독립이 아니다)

### 1.3 데이터 전처리
```python
# 데이터 로드 및 전처리
data = pd.read_csv("cleanDescriptive.csv")
data = data[['level2', 'pass2']]
data = data.dropna()  # NA 값 제거
```

### 1.4 교차표 생성
```python
ctab = pd.crosstab(index=data['level2'], columns=data['pass2'])
ctab.columns = ['실패', '합격']
ctab.index = ['고졸', '대졸', '대학원졸']
```

### 1.5 검정 결과
- **카이제곱 통계량**: 2.767
- **p-value**: 0.251
- **자유도**: 2
- **유의수준**: α = 0.05

### 1.6 결론
**p-value (0.251) > α (0.05)** 이므로 **귀무가설을 채택**합니다.

**✅ 결론: 부모 학력 수준과 자녀의 대학 진학 여부는 서로 관련이 없다.**

---

## 문제 2: 직급과 연봉의 관련성 검정

### 2.1 문제 설정
- **데이터**: MariaDB의 jikwon 테이블
- **변수**: `jikwon_jik` (직급), `jikwon_pay` (연봉)
- **조건**: NA 값이 있는 행 제외

### 2.2 가설 설정
- **귀무가설 (H₀)**: 직급과 연봉은 관련이 없다 (독립)
- **대립가설 (H₁)**: 직급과 연봉은 관련이 있다 (독립이 아니다)

### 2.3 데이터 변환 규칙
#### 직급 변환
- 이사: 1
- 부장: 2  
- 과장: 3
- 대리: 4
- 사원: 5

#### 연봉 구간 변환
- 1000~2999: 1
- 3000~4999: 2
- 5000~6999: 3
- 7000 이상: 4

### 2.4 데이터 전처리
```python
# 직급 변환
data.loc[data['직급'] == '이사', '직급'] = 1
data.loc[data['직급'] == '부장', '직급'] = 2
data.loc[data['직급'] == '과장', '직급'] = 3
data.loc[data['직급'] == '대리', '직급'] = 4
data.loc[data['직급'] == '사원', '직급'] = 5

# 연봉 구간 변환
data.loc[data['연봉'] > 7000, '연봉'] = 4
data.loc[data['연봉'] > 5000, '연봉'] = 3
data.loc[data['연봉'] > 3000, '연봉'] = 2
data.loc[data['연봉'] > 1000, '연봉'] = 1
```

### 2.5 검정 결과
- **카이제곱 통계량**: (구체적 값은 실행 결과에 따라)
- **p-value**: 0.00029
- **자유도**: (구체적 값은 실행 결과에 따라)
- **유의수준**: α = 0.05

### 2.6 결론
**p-value (0.00029) < α (0.05)** 이므로 **귀무가설을 기각하고 대립가설을 채택**합니다.

**✅ 결론: 직급과 연봉은 서로 관련이 있다.**

---

## 📊 동질성 검정 예제: 교육방법에 따른 만족도 분석

### 3.1 문제 설정
- **데이터**: survey_method.csv 파일의 `method` (교육방법), `survey` (만족도) 변수
- **강의 내용**: 교육방법에 따른 교육생들의 만족도 차이가 있는지 동질성 검정

### 3.2 가설 설정
- **귀무가설 (H₀)**: 교육방법에 따른 만족도 분포가 동일하다 (동질성)
- **대립가설 (H₁)**: 교육방법에 따른 만족도 분포가 다르다 (동질성이 아니다)

### 3.3 데이터 분석 코드
```python
import pandas as pd
import scipy.stats as stats

# 데이터 로드
data = pd.read_csv('https://raw.githubusercontent.com/pykwon/python/refs/heads/master/testdata_utf8/survey_method.csv')
print(data.head(2))
print(data['method'].unique())  # [1 2 3]
print(set(data['survey']))      # {1, 2, 3, 4, 5}

# 교차표 생성
ctab = pd.crosstab(index=data['method'], columns=data['survey'])
ctab.columns = ['매우만족', '만족', '보통', '불만족', '매우불만족']
ctab.index = ['방법1', '방법2', '방법3']
print('ctab:\n', ctab)

# 카이제곱 검정
chi2, p, dof, _ = stats.chi2_contingency(ctab)
msg = 'test statistic:{}, p-value:{}, dof:{}'
print(msg.format(chi2, p, dof))
```

### 3.4 검정 결과
- **카이제곱 통계량**: 6.545
- **p-value**: 0.586
- **자유도**: 8
- **유의수준**: α = 0.05

### 3.5 결론
**p-value (0.586) > α (0.05)** 이므로 **귀무가설을 채택**합니다.

**✅ 결론: 교육방법에 따른 교육생들의 만족도 분포는 동일하다.**

강의에서 언급한 대로 "우연히 발생된 데이터"로 새로운 의견을 받아들이기에는 증거가 부족합니다.

---

## 🎓 강의 핵심 내용 정리

### 강의에서 강조한 포인트들
1. **이원 카이제곱의 두 가지 검정**:
   - **독립성 검정**: 두 변수가 서로 관련이 있는가?
   - **동질성 검정**: 여러 집단의 분포가 동일한가?

2. **수식은 동일하지만 해석이 다름**:
   - 같은 계산 방법을 사용하지만 연구 질문에 따라 해석이 달라짐
   - 빈도에 치중하면 독립성, 비율에 치중하면 동질성

3. **가설검정의 철학적 의미**:
   - "새로운 의견을 받아들일 것인가?"의 문제
   - 기존 의견을 완전히 버리는 것이 아니라 새로운 근거 마련
   - p-value는 우연히 발생할 확률

---

## 코드 구현

### 공통 함수
```python
def myChecker(p_value, a_value):
    """가설검정 결과를 판단하는 함수"""
    if(p_value > a_value):
        print(f"P값은 {p_value}, 유의수준 알파 {a_value}보다 큼. 따라서 대립가설을 기각, 귀무가설을 채택함.")
    elif(p_value < a_value):
        print(f"P값은 {p_value}, 유의수준 알파 {a_value}보다 작음. 따라서 대립가설을 채택, 귀무가설을 기각함.")
    return 0
```

### 문제 1 구현
```python
def chiPracticeOne():
    # 데이터 로드
    data = pd.read_csv('https://raw.githubusercontent.com/pykwon/python/refs/heads/master/testdata_utf8/cleanDescriptive.csv')
    data = data[['level2', 'pass2']]
    data = data.dropna()
    
    # 교차표 생성
    ctab = pd.crosstab(index=data['level2'], columns=data['pass2'], margins=True)
    ctab.columns = ['실패', '합격', '행합']
    ctab.index = ['고졸', '대졸', '대학원졸', '열합']
    
    # 카이제곱 검정
    chi2, p, dof, expected = stats.chi2_contingency(ctab)
    print(f"Test statistic : {chi2}, p-value : {p}")
    
    # 결론
    myChecker(p, 0.05)
    print("부모의 학력수준은 자녀의 진학 여부와 관련이 없다.")
```

### 문제 2 구현
```python
def chiPracticeTwo():
    # 데이터베이스 연결 및 데이터 로드
    try:
        with open('myMaria.dat', mode='rb') as obj:
            config = pickle.load(obj)
            
        conn = MySQLdb.connect(**config)
        cursor = conn.cursor()
        sql = "SELECT jikwonjik, jikwonpay FROM jikwon"
        cursor.execute(sql)
        data = pd.DataFrame(cursor.fetchall(), columns=['직급', '연봉'])
        
        # 데이터 변환
        # 직급 변환
        data.loc[data['직급'] == '이사', '직급'] = 1
        data.loc[data['직급'] == '부장', '직급'] = 2
        data.loc[data['직급'] == '과장', '직급'] = 3
        data.loc[data['직급'] == '대리', '직급'] = 4
        data.loc[data['직급'] == '사원', '직급'] = 5
        
        # 연봉 구간 변환
        data.loc[data['연봉'] > 7000, '연봉'] = 4
        data.loc[data['연봉'] > 5000, '연봉'] = 3
        data.loc[data['연봉'] > 3000, '연봉'] = 2
        data.loc[data['연봉'] > 1000, '연봉'] = 1
        
        # 교차표 생성
        ctab = pd.crosstab(index=data['직급'], columns=data['연봉'])
        
        # 카이제곱 검정
        chi2, p, dof, _ = stats.chi2_contingency(ctab)
        print(f"Test statics : {chi2}, P-value : {p}, df : {dof}")
        
        # 결론
        myChecker(p, 0.05)
        print("직급과 연봉은 관련이 있다.")
        
    except Exception as error:
        print('에러 발생:', error)
    finally:
        cursor.close()
        conn.close()
```

### 문제 3 구현 (동질성 검정)
```python
def chiPracticeThree():
    """교육방법에 따른 만족도 동질성 검정"""
    
    # 데이터 로드
    data = pd.read_csv('https://raw.githubusercontent.com/pykwon/python/refs/heads/master/testdata_utf8/survey_method.csv')
    print("데이터 확인:")
    print(data.head(2))
    print(f"교육방법: {data['method'].unique()}")  # [1 2 3]
    print(f"만족도: {set(data['survey'])}")        # {1, 2, 3, 4, 5}
    
    # 교차표 생성
    ctab = pd.crosstab(index=data['method'], columns=data['survey'])
    ctab.columns = ['매우만족', '만족', '보통', '불만족', '매우불만족']
    ctab.index = ['방법1', '방법2', '방법3']
    print('교차표:\n', ctab)
    
    # 카이제곱 검정
    chi2, p, dof, _ = stats.chi2_contingency(ctab)
    print(f"Test statistic: {chi2:.3f}, p-value: {p:.6f}, dof: {dof}")
    
    # 결론
    myChecker(p, 0.05)
    print("교육방법에 따른 만족도 분포는 동일하다.")
```

---

## 시각화 (문제 1)

```python
import seaborn as sns
import matplotlib.pyplot as plt

plt.rc('font', family='malgun gothic')
sns.heatmap(ctab, annot=True, fmt='d', cmap='Blues')
plt.title('부모 학력 수준과 자녀 진학 여부')
plt.xlabel('자녀 진학 여부 (pass)')
plt.ylabel('부모 학력 수준 (level)')
plt.show()
```

---

## 통계적 해석

### 카이제곱 독립성 검정의 의미
- 두 범주형 변수 간의 독립성을 검정하는 방법
- 관찰빈도와 기대빈도의 차이를 통해 독립성 여부를 판단
- p-value가 유의수준보다 작으면 두 변수가 독립이 아니라고 결론

### 실무적 시사점
1. **문제 1**: 부모의 학력이 자녀의 대학 진학에 통계적으로 유의한 영향을 미치지 않음
2. **문제 2**: 회사에서 직급과 연봉이 통계적으로 유의한 관련성을 가짐 (합리적인 인사 시스템)

---

## 참고사항
- 유의수준: α = 0.05
- 사용 라이브러리: pandas, scipy.stats, numpy, matplotlib, seaborn
- 데이터베이스: MariaDB (MySQLdb 라이브러리 사용)
- 날짜: 2022.05.06
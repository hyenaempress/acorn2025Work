# 카이제곱 검정 분석 보고서

## 개요
이 보고서는 두 가지 카이제곱 독립성 검정을 수행한 결과를 정리한 문서입니다.
- **문제 1**: 부모 학력 수준과 자녀 진학 여부의 관련성 분석
- **문제 2**: 직급과 연봉의 관련성 분석

---

## 📊 추가 동질성 검정 예제들

### 4.1 교육방법별 만족도 분석 (survey_method.csv)

**🎯 연구 질문**: 교육 방법에 따른 교육생들의 만족도 분포가 동일한가?

#### 가설 설정
- **귀무가설 (H₀)**: 교육 방법과 교육생의 만족도는 관련이 없다
- **대립가설 (H₁)**: 교육 방법과 교육생의 만족도는 관련이 있다

#### 분석 과정
### 메인 실행 함수
```python
def main():
    """모든 카이제곱 검정 예제 실행"""
    
    print("=" * 60)
    print("📊 카이제곱 검정 종합 분석")
    print("=" * 60)
    
    # 문제 1: 부모 학력과 자녀 진학
    print("\n🎯 문제 1: 부모 학력과 자녀 진학 여부 (독립성 검정)")
    print("-" * 50)
    chiPracticeOne()
    
    # 문제 2: 직급과 연봉
    print("\n🎯 문제 2: 직급과 연봉 관련성 (독립성 검정)")
    print("-" * 50)
    chiPracticeTwo()
    
    # 문제 3: 교육방법과 만족도
    print("\n🎯 문제 3: 교육방법별 만족도 (동질성 검정)")
    print("-" * 50)
    chiPracticeThree()
    
    # 문제 4: 연령대별 SNS 이용률
    print("\n🎯 문제 4: 연령대별 SNS 이용률 (동질성 검정)")
    print("-" * 50)
    chiPracticeFour()
    
    # 문제 5: 표본 추출 검정
    print("\n🎯 문제 5: 표본 추출 후 검정")
    print("-" * 50)
    chiPracticeFive()
    
    print("\n✅ 모든 카이제곱 검정 분석이 완료되었습니다!")

# 실행
if __name__ == "__main__":
    main()
```python
survey_data = pd.read_csv('https://raw.githubusercontent.com/pykwon/python/refs/heads/master/testdata_utf8/survey_method.csv')
print(survey_data['method'].unique())  # 교육방법 [1 2 3]
print(set(survey_data['survey']))      # 만족도 {1, 2, 3, 4, 5}

# 교차표 작성
ctab = pd.crosstab(index=survey_data['method'], columns=survey_data['survey'])
ctab.columns = ['매우 만족', '만족', '보통', '불만족', '매우 불만족']
ctab.index = pd.Index(['방법1', '방법2', '방법3'])

# 카이제곱 검정
chi2, p, ddof, _ = stats.chi2_contingency(ctab)
print(f"test statistics: {chi2}, p-value: {p}, df: {ddof}")
```

---

### 4.2 연령대별 SNS 이용률 동질성 검정 (snsbyage.csv)

**🎯 연구 질문**: 연령대별로 SNS 서비스 이용 현황이 동일한가?

#### 가설 설정
- **귀무가설 (H₀)**: 연령대별 SNS 서비스 이용 현황은 동일하다
- **대립가설 (H₁)**: 연령대별 SNS 서비스 이용 현황은 동일하지 않다

#### 분석 과정
```python
sns_data = pd.read_csv('https://raw.githubusercontent.com/pykwon/python/refs/heads/master/testdata_utf8/snsbyage.csv')
print(sns_data['age'].unique())      # 연령대
print(sns_data['service'].unique())  # SNS 서비스

# 교차표 작성
ctab = pd.crosstab(index=sns_data['age'], columns=sns_data['service'])

# 카이제곱 검정
chi2, p, ddof, _ = stats.chi2_contingency(ctab)
print(f"test statistics: {chi2}, p-value: {p}, df: {ddof}")
```

#### 실무적 활용
- **마케팅 전략**: 연령대별로 다른 SNS 홍보 전략 수립
- **타겟팅**: 특정 연령대에 특화된 SNS 서비스 개발

---

### 4.3 표본 추출을 통한 검정력 확인

**🎯 목적**: 모집단 데이터에서 표본을 추출하여 검정 결과의 안정성 확인

#### 표본 추출 및 분석
```python
print('------------------여기서부터 모집단 추정 데이터------------------')

# 표본 추출 (n=50, 복원추출)
sample_data = sns_data.sample(n=50, replace=True, random_state=1)
print(f"표본 크기: {len(sample_data)}")

# 표본 교차표 작성
ctab_sample = pd.crosstab(index=sample_data['age'], columns=sample_data['service'])
print(ctab_sample)

# 표본 카이제곱 검정
chi2_sample, p_sample, ddof_sample, _ = stats.chi2_contingency(ctab_sample)
print(f"표본 검정 결과: chi2={chi2_sample}, p-value={p_sample}, df={ddof_sample}")
```

#### 표본 크기의 영향
- **대표본**: 더 안정적인 검정 결과
- **소표본**: 검정력 감소, Type II 오류 증가 가능성
- **표본 추출법**: 복원추출 vs 비복원추출의 차이

---

## 🔍 동질성 vs 독립성 검정 비교

### 📊 핵심 차이점

| 구분 | 독립성 검정 | 동질성 검정 |
|------|------------|------------|
| **연구 질문** | 두 변수가 관련이 있는가? | 집단별 분포가 동일한가? |
| **데이터 수집** | 한 집단에서 두 변수 측정 | 여러 집단에서 각각 측정 |
| **예시** | 성별과 제품 선호도 | 지역별 제품 선호도 분포 |
| **해석 초점** | 변수 간 연관성 | 집단 간 차이 |

### 🎯 실무에서의 구분법

```python
def 검정_유형_판별():
    """독립성 vs 동질성 검정 구분 가이드"""
    
    질문유형 = {
        "독립성_검정_질문": [
            "성별과 구매 패턴이 관련이 있는가?",
            "학력과 소득 수준이 연관되어 있는가?",
            "운동 여부와 건강 상태가 관계가 있는가?"
        ],
        
        "동질성_검정_질문": [
            "지역별로 제품 선호도가 동일한가?",
            "연령대별로 SNS 이용 패턴이 같은가?",
            "교육방법별로 만족도 분포가 유사한가?"
        ]
    }
    
    return 질문유형
```

---

## 문제 1: 부모 학력 수준과 자녀 진학 여부의 관련성 검정

### 1.1 문제 설정
- **데이터**: cleanDescriptive.csv 파일의 `level2` (부모 학력), `pass2` (자녀 진학 여부) 변수
- **조건**: NA 값이 있는 행 제외

### 1.2 가설 설정
- **귀무가설 (H₀)**: 부모 학력 수준과 자녀의 대학 진학 여부는 서로 관련이 없다 (독립)
- **대립가설 (H₁)**: 부모 학력 수준과 자녀의 대학 진학 여부는 서로 관련이 있다 (독립이 아니다)

### 1.3 데이터 전처리
```python
# 데이터 로드 및 전처리
data = pd.read_csv("cleanDescriptive.csv")
data = data[['level2', 'pass2']]
data = data.dropna()  # NA 값 제거
```

### 1.4 교차표 생성
```python
ctab = pd.crosstab(index=data['level2'], columns=data['pass2'])
ctab.columns = ['실패', '합격']
ctab.index = ['고졸', '대졸', '대학원졸']
```

### 1.5 검정 결과
- **카이제곱 통계량**: 2.767
- **p-value**: 0.251
- **자유도**: 2
- **유의수준**: α = 0.05

### 1.6 결론
**p-value (0.251) > α (0.05)** 이므로 **귀무가설을 채택**합니다.

**✅ 결론: 부모 학력 수준과 자녀의 대학 진학 여부는 서로 관련이 없다.**

---

## 문제 2: 직급과 연봉의 관련성 검정

### 2.1 문제 설정
- **데이터**: MariaDB의 jikwon 테이블
- **변수**: `jikwon_jik` (직급), `jikwon_pay` (연봉)
- **조건**: NA 값이 있는 행 제외

### 2.2 가설 설정
- **귀무가설 (H₀)**: 직급과 연봉은 관련이 없다 (독립)
- **대립가설 (H₁)**: 직급과 연봉은 관련이 있다 (독립이 아니다)

### 2.3 데이터 변환 규칙
#### 직급 변환
- 이사: 1
- 부장: 2  
- 과장: 3
- 대리: 4
- 사원: 5

#### 연봉 구간 변환
- 1000~2999: 1
- 3000~4999: 2
- 5000~6999: 3
- 7000 이상: 4

### 2.4 데이터 전처리
```python
# 직급 변환
data.loc[data['직급'] == '이사', '직급'] = 1
data.loc[data['직급'] == '부장', '직급'] = 2
data.loc[data['직급'] == '과장', '직급'] = 3
data.loc[data['직급'] == '대리', '직급'] = 4
data.loc[data['직급'] == '사원', '직급'] = 5

# 연봉 구간 변환
data.loc[data['연봉'] > 7000, '연봉'] = 4
data.loc[data['연봉'] > 5000, '연봉'] = 3
data.loc[data['연봉'] > 3000, '연봉'] = 2
data.loc[data['연봉'] > 1000, '연봉'] = 1
```

### 2.5 검정 결과
- **카이제곱 통계량**: (구체적 값은 실행 결과에 따라)
- **p-value**: 0.00029
- **자유도**: (구체적 값은 실행 결과에 따라)
- **유의수준**: α = 0.05

### 2.6 결론
**p-value (0.00029) < α (0.05)** 이므로 **귀무가설을 기각하고 대립가설을 채택**합니다.

**✅ 결론: 직급과 연봉은 서로 관련이 있다.**

---

## 📊 동질성 검정 예제: 교육방법에 따른 만족도 분석

### 3.1 문제 설정
- **데이터**: survey_method.csv 파일의 `method` (교육방법), `survey` (만족도) 변수
- **강의 내용**: 교육방법에 따른 교육생들의 만족도 차이가 있는지 동질성 검정

### 3.2 가설 설정
- **귀무가설 (H₀)**: 교육방법에 따른 만족도 분포가 동일하다 (동질성)
- **대립가설 (H₁)**: 교육방법에 따른 만족도 분포가 다르다 (동질성이 아니다)

### 3.3 데이터 분석 코드
```python
import pandas as pd
import scipy.stats as stats

# 데이터 로드
data = pd.read_csv('https://raw.githubusercontent.com/pykwon/python/refs/heads/master/testdata_utf8/survey_method.csv')
print(data.head(2))
print(data['method'].unique())  # [1 2 3]
print(set(data['survey']))      # {1, 2, 3, 4, 5}

# 교차표 생성
ctab = pd.crosstab(index=data['method'], columns=data['survey'])
ctab.columns = ['매우만족', '만족', '보통', '불만족', '매우불만족']
ctab.index = ['방법1', '방법2', '방법3']
print('ctab:\n', ctab)

# 카이제곱 검정
chi2, p, dof, _ = stats.chi2_contingency(ctab)
msg = 'test statistic:{}, p-value:{}, dof:{}'
print(msg.format(chi2, p, dof))
```

### 3.4 검정 결과
- **카이제곱 통계량**: 6.545
- **p-value**: 0.586
- **자유도**: 8
- **유의수준**: α = 0.05

### 3.5 결론
**p-value (0.586) > α (0.05)** 이므로 **귀무가설을 채택**합니다.

**✅ 결론: 교육방법에 따른 교육생들의 만족도 분포는 동일하다.**

강의에서 언급한 대로 "우연히 발생된 데이터"로 새로운 의견을 받아들이기에는 증거가 부족합니다.

---

## 🎓 강의 핵심 내용 정리

### 강의에서 강조한 포인트들
1. **이원 카이제곱의 두 가지 검정**:
   - **독립성 검정**: 두 변수가 서로 관련이 있는가?
   - **동질성 검정**: 여러 집단의 분포가 동일한가?

2. **수식은 동일하지만 해석이 다름**:
   - 같은 계산 방법을 사용하지만 연구 질문에 따라 해석이 달라짐
   - 빈도에 치중하면 독립성, 비율에 치중하면 동질성

3. **가설검정의 철학적 의미**:
   - "새로운 의견을 받아들일 것인가?"의 문제
   - 기존 의견을 완전히 버리는 것이 아니라 새로운 근거 마련
   - p-value는 우연히 발생할 확률

---

## 코드 구현

### 공통 함수
```python
def myChecker(p_value, a_value):
    """가설검정 결과를 판단하는 함수"""
    if(p_value > a_value):
        print(f"P값은 {p_value}, 유의수준 알파 {a_value}보다 큼. 따라서 대립가설을 기각, 귀무가설을 채택함.")
    elif(p_value < a_value):
        print(f"P값은 {p_value}, 유의수준 알파 {a_value}보다 작음. 따라서 대립가설을 채택, 귀무가설을 기각함.")
    return 0
```

### 문제 1 구현
```python
def chiPracticeOne():
    # 데이터 로드
    data = pd.read_csv('https://raw.githubusercontent.com/pykwon/python/refs/heads/master/testdata_utf8/cleanDescriptive.csv')
    data = data[['level2', 'pass2']]
    data = data.dropna()
    
    # 교차표 생성
    ctab = pd.crosstab(index=data['level2'], columns=data['pass2'], margins=True)
    ctab.columns = ['실패', '합격', '행합']
    ctab.index = ['고졸', '대졸', '대학원졸', '열합']
    
    # 카이제곱 검정
    chi2, p, dof, expected = stats.chi2_contingency(ctab)
    print(f"Test statistic : {chi2}, p-value : {p}")
    
    # 결론
    myChecker(p, 0.05)
    print("부모의 학력수준은 자녀의 진학 여부와 관련이 없다.")
```

### 문제 2 구현
```python
def chiPracticeTwo():
    # 데이터베이스 연결 및 데이터 로드
    try:
        with open('myMaria.dat', mode='rb') as obj:
            config = pickle.load(obj)
            
        conn = MySQLdb.connect(**config)
        cursor = conn.cursor()
        sql = "SELECT jikwonjik, jikwonpay FROM jikwon"
        cursor.execute(sql)
        data = pd.DataFrame(cursor.fetchall(), columns=['직급', '연봉'])
        
        # 데이터 변환
        # 직급 변환
        data.loc[data['직급'] == '이사', '직급'] = 1
        data.loc[data['직급'] == '부장', '직급'] = 2
        data.loc[data['직급'] == '과장', '직급'] = 3
        data.loc[data['직급'] == '대리', '직급'] = 4
        data.loc[data['직급'] == '사원', '직급'] = 5
        
        # 연봉 구간 변환
        data.loc[data['연봉'] > 7000, '연봉'] = 4
        data.loc[data['연봉'] > 5000, '연봉'] = 3
        data.loc[data['연봉'] > 3000, '연봉'] = 2
        data.loc[data['연봉'] > 1000, '연봉'] = 1
        
        # 교차표 생성
        ctab = pd.crosstab(index=data['직급'], columns=data['연봉'])
        
        # 카이제곱 검정
        chi2, p, dof, _ = stats.chi2_contingency(ctab)
        print(f"Test statics : {chi2}, P-value : {p}, df : {dof}")
        
        # 결론
        myChecker(p, 0.05)
        print("직급과 연봉은 관련이 있다.")
        
    except Exception as error:
        print('에러 발생:', error)
    finally:
        cursor.close()
        conn.close()
```

### 문제 3 구현 (동질성 검정) - 교육방법별 만족도
```python
def chiPracticeThree():
    """교육방법에 따른 만족도 동질성 검정"""
    
    # 데이터 로드
    survey_data = pd.read_csv('https://raw.githubusercontent.com/pykwon/python/refs/heads/master/testdata_utf8/survey_method.csv')
    print(survey_data)
    
    print(survey_data['method'].unique())  # 교육방법
    print(set(survey_data['survey']))      # 만족도
    
    # 교차표 작성
    ctab = pd.crosstab(index=survey_data['method'], columns=survey_data['survey'])
    ctab.columns = ['매우 만족', '만족', '보통', '불만족', '매우 불만족']
    ctab.index = pd.Index(['방법1', '방법2', '방법3'])
    print(ctab)
    
    # 카이제곱 검정
    chi2, p, ddof, _ = stats.chi2_contingency(ctab)
    msg = "test statistics: {}, p-value: {}, df:{}"
    print(msg.format(chi2, p, ddof))
    
    # 해석
    if p > 0.05:
        print("귀무 가설 채택, 교육 방법과 교육생들의 만족도는 관련이 없습니다.")
    else:
        print("귀무 가설 기각, 교육 방법과 교육생들의 만족도는 관련이 있습니다.")

### 문제 4 구현 (동질성 검정) - 연령대별 SNS 이용률
```python
def chiPracticeFour():
    """연령대별 SNS 이용률의 동질성 검정"""
    
    # 데이터 로드
    sns_data = pd.read_csv('https://raw.githubusercontent.com/pykwon/python/refs/heads/master/testdata_utf8/snsbyage.csv')
    print(sns_data)
    
    print(sns_data['age'].unique())      # 연령대
    print(sns_data['service'].unique())  # SNS 서비스
    
    # 교차표 작성
    ctab = pd.crosstab(index=sns_data['age'], columns=sns_data['service'])
    print(ctab)
    
    # 카이제곱 검정
    chi2, p, ddof, _ = stats.chi2_contingency(ctab)
    msg = "test statistics: {}, p-value: {}, df:{}"
    print(msg.format(chi2, p, ddof))
    
    # 해석
    if p > 0.05:
        print("귀무 가설 채택, 연령대와 서비스 이용은 관련이 없습니다.")
    else:
        print("귀무 가설 기각, 연령대와 서비스 이용은 관련이 있습니다.")
    
    return sns_data

### 문제 5 구현 (표본 추출 및 검정)
```python
def chiPracticeFive():
    """모집단에서 표본 추출 후 검정"""
    
    # 이전 분석의 sns_data를 모집단으로 가정
    sns_data = pd.read_csv('https://raw.githubusercontent.com/pykwon/python/refs/heads/master/testdata_utf8/snsbyage.csv')
    
    print('------------------여기서부터 모집단 추정 데이터------------------')
    
    # 표본 추출 (n=50, 복원추출)
    sample_data = sns_data.sample(n=50, replace=True, random_state=1)
    print(len(sample_data))
    
    # 표본 교차표 작성
    ctab3 = pd.crosstab(index=sample_data['age'], columns=sample_data['service'])
    print(ctab3)
    
    # 표본 카이제곱 검정
    chi2, p, ddof, _ = stats.chi2_contingency(ctab3)
    msg = "test statistics: {}, p-value: {}, df:{}"
    print(msg.format(chi2, p, ddof))
    
    # 해석
    if p > 0.05:
        print("표본 분석 결과: 연령대와 서비스 이용은 관련이 없습니다.")
    else:
        print("표본 분석 결과: 연령대와 서비스 이용은 관련이 있습니다.")
```

---

## 시각화 (문제 1)

```python
import seaborn as sns
import matplotlib.pyplot as plt

plt.rc('font', family='malgun gothic')
sns.heatmap(ctab, annot=True, fmt='d', cmap='Blues')
plt.title('부모 학력 수준과 자녀 진학 여부')
plt.xlabel('자녀 진학 여부 (pass)')
plt.ylabel('부모 학력 수준 (level)')
plt.show()
```

---

## 통계적 해석

### 카이제곱 독립성 검정의 의미
- 두 범주형 변수 간의 독립성을 검정하는 방법
- 관찰빈도와 기대빈도의 차이를 통해 독립성 여부를 판단
- p-value가 유의수준보다 작으면 두 변수가 독립이 아니라고 결론

### 실무적 시사점
1. **문제 1**: 부모의 학력이 자녀의 대학 진학에 통계적으로 유의한 영향을 미치지 않음
2. **문제 2**: 회사에서 직급과 연봉이 통계적으로 유의한 관련성을 가짐 (합리적인 인사 시스템)

---

## 참고사항
- 유의수준: α = 0.05
- 사용 라이브러리: pandas, scipy.stats, numpy, matplotlib, seaborn
- 데이터베이스: MariaDB (MySQLdb 라이브러리 사용)
- 날짜: 2022.05.06
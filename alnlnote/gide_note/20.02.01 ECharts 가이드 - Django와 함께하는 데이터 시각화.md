# 20.02.01 ECharts 완전 가이드 - Django와 함께하는 데이터 시각화

## 목차
1. [ECharts 소개](#echarts-소개)
2. [ECharts 기본 개념](#echarts-기본-개념)
3. [Django와 ECharts 연동](#django와-echarts-연동)
4. [기본 차트 유형](#기본-차트-유형)
5. [고급 차트 옵션](#고급-차트-옵션)
6. [실전 예제 모음](#실전-예제-모음)
7. [성능 최적화](#성능-최적화)
8. [트러블슈팅](#트러블슈팅)

---

## ECharts 소개

### 🎯 ECharts란?
**ECharts**(Apache ECharts)는 Baidu에서 개발하여 Apache Software Foundation에 기증한 오픈소스 JavaScript 차트 라이브러리입니다.

### ✨ 주요 특징
- **🌐 웹 표준**: Canvas, SVG, WebGL 기반 렌더링
- **📱 반응형**: 모바일 친화적 설계
- **🎨 다양한 차트**: 20+ 종류의 차트 타입 지원
- **⚡ 고성능**: 대용량 데이터 처리 최적화
- **🔧 커스터마이징**: 테마, 애니메이션, 인터랙션 등 자유자재로 설정
- **📊 실시간**: 동적 데이터 업데이트 지원

### 🏆 왜 ECharts를 선택해야 할까?

| 특징 | ECharts | Chart.js | D3.js | Plotly |
|------|---------|----------|-------|--------|
| **학습 곡선** | 쉬움 | 쉬움 | 어려움 | 보통 |
| **커스터마이징** | 높음 | 보통 | 매우 높음 | 높음 |
| **성능** | 우수 | 보통 | 우수 | 좋음 |
| **모바일 지원** | 우수 | 좋음 | 보통 | 좋음 |
| **문서화** | 우수 | 우수 | 보통 | 좋음 |
| **커뮤니티** | 대형 | 대형 | 대형 | 중형 |

---

## ECharts 기본 개념

### 🏗️ ECharts 아키텍처

```javascript
// ECharts 기본 구조
const chart = echarts.init(domElement);  // 차트 인스턴스 생성

const option = {                         // 차트 옵션 정의
    title: {},        // 제목
    tooltip: {},      // 툴팁
    legend: {},       // 범례
    grid: {},         // 그리드
    xAxis: {},        // X축
    yAxis: {},        // Y축
    series: []        // 데이터 시리즈
};

chart.setOption(option);                 // 옵션 적용
```

### 📊 핵심 컴포넌트

#### 1. **Chart Instance (차트 인스턴스)**
```javascript
// DOM 엘리먼트에 차트 인스턴스 생성
const chartDom = document.getElementById('myChart');
const myChart = echarts.init(chartDom);

// 테마 적용
const myChart = echarts.init(chartDom, 'dark');

// 초기 크기 설정
const myChart = echarts.init(chartDom, null, {
    width: 600,
    height: 400
});
```

#### 2. **Option (옵션 객체)**
ECharts의 모든 설정은 `option` 객체로 관리됩니다.

```javascript
const option = {
    // 🏷️ 제목 설정
    title: {
        text: '차트 제목',
        subtext: '부제목',
        left: 'center'
    },
    
    // 🖱️ 툴팁 설정
    tooltip: {
        trigger: 'axis',
        axisPointer: {
            type: 'cross'
        }
    },
    
    // 📋 범례 설정
    legend: {
        data: ['시리즈1', '시리즈2'],
        top: 'bottom'
    },
    
    // 📊 데이터 시리즈
    series: [{
        name: '시리즈1',
        type: 'line',
        data: [120, 132, 101, 134, 90]
    }]
};
```

#### 3. **Series (데이터 시리즈)**
실제 데이터와 차트 유형을 정의하는 핵심 부분입니다.

```javascript
// 라인 차트
series: [{
    name: '월별 매출',
    type: 'line',
    data: [120, 132, 101, 134, 90, 230, 210]
}]

// 막대 차트
series: [{
    name: '분기별 매출',
    type: 'bar',
    data: [2400, 1398, 9800, 3908, 4800]
}]

// 파이 차트
series: [{
    name: '접근 소스',
    type: 'pie',
    data: [
        {value: 1048, name: '검색엔진'},
        {value: 735, name: '직접접근'},
        {value: 580, name: '이메일마케팅'}
    ]
}]
```

---

## Django와 ECharts 연동

### 🔗 기본 연동 패턴

#### 1. **CDN 방식 (권장)**
```html
<!-- HTML 템플릿에 ECharts CDN 추가 -->
<script src="https://cdn.jsdelivr.net/npm/echarts@5/dist/echarts.min.js"></script>
```

#### 2. **Django 뷰에서 데이터 준비**
```python
# views.py
import json
from django.shortcuts import render

def chart_view(request):
    # 데이터 준비
    months = ['1월', '2월', '3월', '4월', '5월', '6월']
    sales = [2400, 1398, 9800, 3908, 4800, 3800]
    
    # JSON 직렬화
    context = {
        'months_json': json.dumps(months, ensure_ascii=False),
        'sales_json': json.dumps(sales)
    }
    
    return render(request, 'chart.html', context)
```

#### 3. **템플릿에서 차트 렌더링**
```html
<!-- chart.html -->
<div id="salesChart" style="width: 100%; height: 400px;"></div>

<script>
    // Django에서 전달받은 데이터
    const months = {{ months_json|safe }};
    const sales = {{ sales_json|safe }};
    
    // 차트 인스턴스 생성
    const chartDom = document.getElementById('salesChart');
    const myChart = echarts.init(chartDom);
    
    // 차트 옵션 설정
    const option = {
        title: {
            text: '월별 매출 현황'
        },
        tooltip: {
            trigger: 'axis'
        },
        xAxis: {
            type: 'category',
            data: months
        },
        yAxis: {
            type: 'value'
        },
        series: [{
            name: '매출',
            type: 'bar',
            data: sales
        }]
    };
    
    // 차트 렌더링
    myChart.setOption(option);
    
    // 반응형 처리
    window.addEventListener('resize', function() {
        myChart.resize();
    });
</script>
```

### 🎯 Django-ECharts 연동 베스트 프랙티스

#### 1. **JSON 직렬화 주의사항**
```python
import json
from decimal import Decimal

# ❌ 잘못된 방법 - Decimal 타입 오류
data = [Decimal('10.5'), Decimal('20.3')]
json.dumps(data)  # TypeError 발생

# ✅ 올바른 방법 - float 변환
data = [float(d) for d in data]
json.dumps(data)

# ✅ 한글 데이터 처리
korean_data = ['서울', '부산', '대구']
json.dumps(korean_data, ensure_ascii=False)
```

#### 2. **날짜 데이터 처리**
```python
import pandas as pd
from datetime import datetime

# 날짜 데이터를 문자열로 변환
df['date'] = pd.to_datetime(df['date'])
date_labels = df['date'].dt.strftime('%Y-%m-%d').tolist()

# JavaScript Date 객체로 전달하고 싶은 경우
timestamps = df['date'].astype(int) // 10**6  # 밀리초 타임스탬프
```

#### 3. **대용량 데이터 처리**
```python
# 데이터 샘플링으로 성능 향상
def prepare_chart_data(df, max_points=1000):
    if len(df) > max_points:
        # 균등 샘플링
        step = len(df) // max_points
        df = df.iloc[::step]
    
    return {
        'x_data': df['x'].tolist(),
        'y_data': df['y'].tolist()
    }
```

---

## 기본 차트 유형

### 📈 1. 라인 차트 (Line Chart)

```javascript
const lineOption = {
    title: {
        text: '주가 추이'
    },
    tooltip: {
        trigger: 'axis'
    },
    xAxis: {
        type: 'category',
        data: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun']
    },
    yAxis: {
        type: 'value'
    },
    series: [{
        name: '주가',
        type: 'line',
        data: [820, 932, 901, 934, 1290, 1330, 1320],
        smooth: true,          // 부드러운 곡선
        lineStyle: {
            color: '#5470c6',
            width: 3
        },
        areaStyle: {           // 영역 채우기
            color: 'rgba(84, 112, 198, 0.3)'
        }
    }]
};
```

### 📊 2. 막대 차트 (Bar Chart)

```javascript
const barOption = {
    title: {
        text: '지역별 판매량'
    },
    tooltip: {
        trigger: 'axis',
        axisPointer: {
            type: 'shadow'
        }
    },
    xAxis: {
        type: 'category',
        data: ['서울', '부산', '대구', '인천', '광주', '대전', '울산']
    },
    yAxis: {
        type: 'value'
    },
    series: [{
        name: '판매량',
        type: 'bar',
        data: [2400, 1398, 9800, 3908, 4800, 3800, 4300],
        itemStyle: {
            color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [
                {offset: 0, color: '#83bff6'},
                {offset: 0.5, color: '#188df0'},
                {offset: 1, color: '#188df0'}
            ])
        },
        emphasis: {            // 호버 효과
            itemStyle: {
                color: '#ff7043'
            }
        }
    }]
};
```

### 🥧 3. 파이 차트 (Pie Chart)

```javascript
const pieOption = {
    title: {
        text: '브라우저 사용률',
        left: 'center'
    },
    tooltip: {
        trigger: 'item',
        formatter: '{a} <br/>{b} : {c} ({d}%)'
    },
    legend: {
        orient: 'vertical',
        left: 'left'
    },
    series: [{
        name: '브라우저',
        type: 'pie',
        radius: '50%',
        data: [
            {value: 1048, name: 'Chrome'},
            {value: 735, name: 'Firefox'},
            {value: 580, name: 'Safari'},
            {value: 484, name: 'Edge'},
            {value: 300, name: '기타'}
        ],
        emphasis: {
            itemStyle: {
                shadowBlur: 10,
                shadowOffsetX: 0,
                shadowColor: 'rgba(0, 0, 0, 0.5)'
            }
        }
    }]
};
```

### 📈 4. 영역 차트 (Area Chart)

```javascript
const areaOption = {
    title: {
        text: '월별 방문자 수'
    },
    tooltip: {
        trigger: 'axis'
    },
    xAxis: {
        type: 'category',
        data: ['1월', '2월', '3월', '4월', '5월', '6월']
    },
    yAxis: {
        type: 'value'
    },
    series: [{
        name: '방문자',
        type: 'line',
        data: [1200, 1500, 1800, 1600, 2100, 2400],
        areaStyle: {
            color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [
                {offset: 0, color: 'rgba(58, 77, 233, 0.8)'},
                {offset: 1, color: 'rgba(58, 77, 233, 0.1)'}
            ])
        },
        smooth: true
    }]
};
```

### 🔄 5. 도넛 차트 (Doughnut Chart)

```javascript
const doughnutOption = {
    title: {
        text: '매출 구성비',
        left: 'center'
    },
    tooltip: {
        trigger: 'item'
    },
    series: [{
        name: '매출',
        type: 'pie',
        radius: ['40%', '70%'],  // 내부 반지름, 외부 반지름
        avoidLabelOverlap: false,
        label: {
            show: false,
            position: 'center'
        },
        emphasis: {
            label: {
                show: true,
                fontSize: '30',
                fontWeight: 'bold'
            }
        },
        labelLine: {
            show: false
        },
        data: [
            {value: 335, name: '온라인'},
            {value: 310, name: '오프라인'},
            {value: 234, name: '모바일'},
            {value: 135, name: '기타'}
        ]
    }]
};
```

### 📊 6. 다중 시리즈 차트

```javascript
const multiSeriesOption = {
    title: {
        text: '매출 vs 비용'
    },
    tooltip: {
        trigger: 'axis'
    },
    legend: {
        data: ['매출', '비용']
    },
    xAxis: {
        type: 'category',
        data: ['1월', '2월', '3월', '4월', '5월', '6월']
    },
    yAxis: {
        type: 'value'
    },
    series: [
        {
            name: '매출',
            type: 'bar',
            data: [2400, 1398, 9800, 3908, 4800, 3800]
        },
        {
            name: '비용',
            type: 'line',
            data: [2000, 1200, 8000, 3200, 4000, 3200],
            smooth: true
        }
    ]
};
```

---

## 고급 차트 옵션

### 🎨 1. 색상 및 스타일링

#### 단색 설정
```javascript
series: [{
    type: 'bar',
    data: [10, 20, 30],
    itemStyle: {
        color: '#ff6b6b'
    }
}]
```

#### 그라디언트 색상
```javascript
series: [{
    type: 'bar',
    data: [10, 20, 30],
    itemStyle: {
        color: new echarts.graphic.LinearGradient(
            0, 0, 0, 1,  // 방향: 위에서 아래로
            [
                {offset: 0, color: '#ff6b6b'},
                {offset: 1, color: '#feca57'}
            ]
        )
    }
}]
```

#### 데이터별 다른 색상
```javascript
series: [{
    type: 'bar',
    data: [
        {value: 10, itemStyle: {color: '#ff6b6b'}},
        {value: 20, itemStyle: {color: '#4ecdc4'}},
        {value: 30, itemStyle: {color: '#45b7d1'}}
    ]
}]
```

### 🖱️ 2. 인터랙션 설정

#### 커스텀 툴팁
```javascript
tooltip: {
    trigger: 'axis',
    formatter: function (params) {
        let result = params[0].name + '<br/>';
        params.forEach(function (item) {
            result += item.marker + ' ' + item.seriesName + ': ' + 
                     item.value.toLocaleString() + '원<br/>';
        });
        return result;
    }
}
```

#### 브러시 선택
```javascript
brush: {
    toolbox: ['rect', 'polygon', 'lineX', 'lineY', 'keep', 'clear'],
    xAxisIndex: 0
}
```

#### 줌 기능
```javascript
dataZoom: [
    {
        type: 'inside',
        start: 0,
        end: 100
    },
    {
        start: 0,
        end: 100
    }
]
```

### 📱 3. 반응형 설정

```javascript
// 반응형 옵션 설정
const mediaQuery = [
    {
        query: {
            maxWidth: 600
        },
        option: {
            grid: {
                left: '10%',
                right: '10%'
            },
            legend: {
                orient: 'horizontal',
                bottom: 0
            }
        }
    },
    {
        query: {
            minWidth: 600
        },
        option: {
            grid: {
                left: '15%',
                right: '15%'
            },
            legend: {
                orient: 'vertical',
                right: 0
            }
        }
    }
];

chart.setOption(option);
chart.setOption({media: mediaQuery});

// 윈도우 리사이즈 이벤트
window.addEventListener('resize', function() {
    chart.resize();
});
```

### 🎭 4. 애니메이션 설정

```javascript
// 전역 애니메이션 설정
animation: true,
animationDuration: 1000,
animationEasing: 'cubicOut',

// 시리즈별 애니메이션
series: [{
    type: 'bar',
    data: [10, 20, 30],
    animationDelay: function (idx) {
        return idx * 100;  // 순차적 애니메이션
    }
}]
```

---

## 실전 예제 모음

### 📊 1. Django 월별 매출 대시보드

#### 뷰 함수
```python
# views.py
from django.shortcuts import render
from django.db.models import Sum
from django.db.models.functions import TruncMonth
import json

def sales_dashboard(request):
    # 월별 매출 집계
    monthly_sales = (
        SalesModel.objects
        .annotate(month=TruncMonth('created_at'))
        .values('month')
        .annotate(total=Sum('amount'))
        .order_by('month')
    )
    
    # 차트 데이터 준비
    months = []
    sales = []
    
    for item in monthly_sales:
        months.append(item['month'].strftime('%Y-%m'))
        sales.append(float(item['total']))
    
    context = {
        'months_json': json.dumps(months),
        'sales_json': json.dumps(sales)
    }
    
    return render(request, 'dashboard.html', context)
```

#### 템플릿
```html
<!-- dashboard.html -->
<div class="row">
    <div class="col-lg-8">
        <div class="card">
            <div class="card-header">
                <h4>월별 매출 추이</h4>
            </div>
            <div class="card-body">
                <div id="salesChart" style="height: 400px;"></div>
            </div>
        </div>
    </div>
    <div class="col-lg-4">
        <div class="card">
            <div class="card-header">
                <h4>카테고리별 매출</h4>
            </div>
            <div class="card-body">
                <div id="categoryChart" style="height: 400px;"></div>
            </div>
        </div>
    </div>
</div>

<script>
    // 월별 매출 차트
    const salesChart = echarts.init(document.getElementById('salesChart'));
    const salesOption = {
        title: {
            text: '월별 매출 현황',
            left: 'center'
        },
        tooltip: {
            trigger: 'axis',
            formatter: function(params) {
                return params[0].name + '<br/>' +
                       '매출: ' + params[0].value.toLocaleString() + '원';
            }
        },
        xAxis: {
            type: 'category',
            data: {{ months_json|safe }}
        },
        yAxis: {
            type: 'value',
            axisLabel: {
                formatter: function(value) {
                    return (value / 1000000) + 'M';
                }
            }
        },
        series: [{
            name: '매출',
            type: 'line',
            data: {{ sales_json|safe }},
            smooth: true,
            areaStyle: {
                color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [
                    {offset: 0, color: 'rgba(58, 77, 233, 0.8)'},
                    {offset: 1, color: 'rgba(58, 77, 233, 0.1)'}
                ])
            }
        }]
    };
    
    salesChart.setOption(salesOption);
    
    // 반응형 처리
    window.addEventListener('resize', function() {
        salesChart.resize();
    });
</script>
```

### 📈 2. 실시간 데이터 업데이트

```javascript
// 실시간 차트 업데이트
function updateChart() {
    fetch('/api/realtime-data/')
        .then(response => response.json())
        .then(data => {
            const option = {
                xAxis: {
                    data: data.timestamps
                },
                series: [{
                    data: data.values
                }]
            };
            
            // 기존 차트에 새 데이터 적용
            chart.setOption(option);
        });
}

// 5초마다 업데이트
setInterval(updateChart, 5000);
```

### 🎯 3. 드릴다운 차트

```javascript
// 드릴다운 기능
let currentLevel = 'country';
const drilldownData = {
    'country': {
        categories: ['한국', '미국', '일본'],
        values: [100, 200, 150]
    },
    '한국': {
        categories: ['서울', '부산', '대구'],
        values: [40, 35, 25]
    }
    // ... 더 많은 데이터
};

chart.on('click', function(params) {
    const name = params.name;
    
    if (drilldownData[name]) {
        // 드릴다운 데이터로 차트 업데이트
        const newOption = {
            title: {
                text: name + ' 상세 데이터'
            },
            xAxis: {
                data: drilldownData[name].categories
            },
            series: [{
                data: drilldownData[name].values
            }]
        };
        
        chart.setOption(newOption);
        currentLevel = name;
    }
});
```

---

## 성능 최적화

### ⚡ 1. 대용량 데이터 처리

#### 데이터 샘플링
```python
# Django에서 데이터 샘플링
def get_sampled_data(queryset, max_points=1000):
    total_count = queryset.count()
    
    if total_count <= max_points:
        return queryset
    
    # 균등 간격으로 샘플링
    step = total_count // max_points
    return queryset[::step]
```

#### 가상화 스크롤링
```javascript
// 대용량 데이터용 가상화 설정
const option = {
    series: [{
        type: 'line',
        large: true,           // 대용량 데이터 모드
        largeThreshold: 2000,  // 임계값
        data: largeDataArray
    }]
};
```

### 🚀 2. 렌더링 최적화

#### Canvas vs SVG 선택
```javascript
// Canvas 렌더러 (대용량 데이터에 적합)
const chart = echarts.init(dom, null, {renderer: 'canvas'});

// SVG 렌더러 (소량 데이터, 벡터 품질 중요시)
const chart = echarts.init(dom, null, {renderer: 'svg'});
```

#### 애니메이션 비활성화
```javascript
const option = {
    animation: false,  // 성능 향상을 위해 애니메이션 비활성화
    series: [{
        type: 'line',
        data: data,
        animation: false
    }]
};
```

### 💾 3. 메모리 관리

```javascript
// 차트 인스턴스 정리
function destroyChart() {
    if (chart) {
        chart.dispose();
        chart = null;
    }
}

// 페이지 언로드 시 정리
window.addEventListener('beforeunload', destroyChart);
```

---

## 트러블슈팅

### 🔧 1. 자주 발생하는 문제들

#### 차트가 표시되지 않는 경우
```javascript
// ✅ 해결 방법들
// 1. DOM 엘리먼트 크기 확인
const chartDom = document.getElementById('chart');
console.log(chartDom.offsetWidth, chartDom.offsetHeight);

// 2. 명시적 크기 설정
const chart = echarts.init(chartDom, null, {
    width: 600,
    height: 400
});

// 3. resize 호출
chart.resize();
```

#### 데이터가 제대로 표시되지 않는 경우
```javascript
// 데이터 타입 확인
console.log('Data type:', typeof data[0]);
console.log('Data sample:', data.slice(0, 3));

// NaN, undefined 값 필터링
const cleanData = data.filter(d => d !== null && !isNaN(d));
```

#### 반응형이 작동하지 않는 경우
```javascript
// ResizeObserver 사용 (최신 브라우저)
const resizeObserver = new ResizeObserver(entries => {
    chart.resize();
});
resizeObserver.observe(chartDom);

// 또는 전통적인 방법
window.addEventListener('resize', () => {
    setTimeout(() => chart.resize(), 100);
});
```

### 🐛 2. 디버깅 팁

#### 개발자 도구 활용
```javascript
// 차트 옵션 확인
console.log('Current option:', chart.getOption());

// 차트 크기 확인
console.log('Chart size:', chart.getWidth(), chart.getHeight());

// 이벤트 리스너 확인
chart.on('click', function(params) {
    console.log('Click event:', params);
});
```

#### 단계별 디버깅
```javascript
// 1. 기본 차트 먼저 테스트
const simpleOption = {
    xAxis: { type: 'category', data: ['A', 'B', 'C'] },
    yAxis: { type: 'value' },
    series: [{ type: 'bar', data: [1, 2, 3] }]
};

// 2. 점진적으로 복잡한 옵션 추가
// 3. 각 단계에서 동작 확인
```

### 📚 3. 추가 학습 자료

- **공식 문서**: [https://echarts.apache.org/](https://echarts.apache.org/)
- **예제 갤러리**: [https://echarts.apache.org/examples/](https://echarts.apache.org/examples/)
- **GitHub**: [https://github.com/apache/echarts](https://github.com/apache/echarts)
- **커뮤니티**: Stack Overflow, Reddit r/dataviz

---

## 마무리

ECharts는 강력하면서도 사용하기 쉬운 차트 라이브러리입니다. Django와의 연동을 통해 동적이고 인터랙티브한 데이터 시각화를 구현할 수 있으며, 다양한 커스터마이징 옵션을 통해 프로젝트 요구사항에 맞는 차트를 만들 수 있습니다.

### 🎯 핵심 포인트 요약
1. **기본 구조 이해**: Chart Instance → Option → Series
2. **Django 연동**: JSON 직렬화를 통한 데이터 전달
3. **반응형 설계**: resize 이벤트 처리 필수
4. **성능 고려**: 대용량 데이터 시 샘플링 적용
5. **디버깅**: 단계별 테스트와 콘솔 로그 활용

이제 여러분도 ECharts를 활용해서 멋진 데이터 시각화를 만들어보세요! 🚀
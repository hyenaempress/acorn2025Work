# 22.07.04 ANOVA 효과크기 계산과 실무적 해석
*통계적 유의성을 넘어서 - 실무적으로 의미있는 차이인가?*

---

## 🎯 효과크기(Effect Size)란?

**통계적 유의성**과 **실무적 중요성**은 다릅니다! p-value가 0.001이라고 해서 항상 중요한 차이는 아니에요.

### 🤔 왜 효과크기가 중요한가?

```
상황 1: 대기업 vs 중소기업 급여 차이
- 평균 차이: 100만원
- p-value: 0.03 (유의함)
- 실무적 의미: 매우 중요한 차이! 💰

상황 2: 두 치료법의 혈압 차이  
- 평균 차이: 0.5mmHg
- p-value: 0.001 (매우 유의함)
- 실무적 의미: 거의 의미없는 차이... 🤷‍♀️
```

> **핵심**: p-value는 "차이가 있는지"를, 효과크기는 "얼마나 중요한 차이인지"를 알려줍니다.

---

## 📊 ANOVA 효과크기 지표들

### 🎯 1. η² (에타 제곱, Eta Squared)

**가장 일반적인 ANOVA 효과크기 지표**

```
η² = SS_between / SS_total = 집단 간 제곱합 / 전체 제곱합
```

#### 📈 Cohen의 효과크기 해석 기준

| η² 값 | 효과크기 | 해석 | 실무적 의미 |
|-------|---------|------|-------------|
| **0.01** | 작은 효과 | 1% 분산 설명 | 통계적으로만 의미 |
| **0.06** | 중간 효과 | 6% 분산 설명 | 실무적 고려 필요 |
| **0.14** | 큰 효과 | 14% 분산 설명 | 매우 중요한 차이 |

### 🎯 2. ω² (오메가 제곱, Omega Squared)

**η²의 편향을 보정한 지표** (더 보수적)

```
ω² = (SS_between - (k-1) × MS_error) / (SS_total + MS_error)
```

### 🎯 3. 편의점 알바 급여 예제로 실습

```python
import numpy as np
import pandas as pd
import scipy.stats as stats
from statsmodels.formula.api import ols
from statsmodels.stats.anova import anova_lm
from statsmodels.stats.multicomp import pairwise_tukeyhsd
import matplotlib.pyplot as plt

def calculate_effect_sizes(anova_table):
    """ANOVA 결과로부터 효과크기 계산"""
    
    # ANOVA 테이블에서 값 추출
    ss_between = anova_table.iloc[0, 1]  # sum_sq of factor
    ss_within = anova_table.iloc[1, 1]   # sum_sq of residual  
    ss_total = ss_between + ss_within
    
    df_between = anova_table.iloc[0, 0]  # df of factor
    df_within = anova_table.iloc[1, 0]   # df of residual
    ms_error = anova_table.iloc[1, 2]    # mean_sq of residual
    
    # η² (에타 제곱) 계산
    eta_squared = ss_between / ss_total
    
    # ω² (오메가 제곱) 계산 - 편향 보정
    omega_squared = (ss_between - df_between * ms_error) / (ss_total + ms_error)
    
    # 부분 η² (Partial Eta Squared) - 다른 효과를 제외한 순수 효과
    partial_eta_squared = ss_between / (ss_between + ss_within)
    
    return {
        'eta_squared': eta_squared,
        'omega_squared': max(0, omega_squared),  # 음수 방지
        'partial_eta_squared': partial_eta_squared
    }

def interpret_effect_size(eta_squared):
    """효과크기 해석"""
    if eta_squared < 0.01:
        return "무시할 수 있는 효과", "거의 의미없음"
    elif eta_squared < 0.06:
        return "작은 효과", "통계적으로만 의미"
    elif eta_squared < 0.14:
        return "중간 효과", "실무적 고려 필요"
    else:
        return "큰 효과", "매우 중요한 차이"

# === 편의점 알바 급여 분석 ===
print("🏪 GS편의점 3개 지역 알바생 급여 분석")
print("=" * 50)

# 데이터 로딩
url = 'https://raw.githubusercontent.com/pykwon/python/refs/heads/master/testdata_utf8/group3.txt'
data = np.genfromtxt(url, delimiter=',')
df = pd.DataFrame(data, columns=['pay', 'group'])

print(f"📊 데이터 개요: {df.shape[0]}명, {len(df.group.unique())}개 지역")

# 집단별 기술통계
group_stats = df.groupby('group')['pay'].agg(['count', 'mean', 'std'])
print("\n📈 지역별 급여 현황:")
print(group_stats)

# 집단별 데이터 분리
gr1 = df[df.group == 1]['pay']
gr2 = df[df.group == 2]['pay'] 
gr3 = df[df.group == 3]['pay']

print(f"\n💰 지역별 평균 급여:")
print(f"지역 1: {gr1.mean():.1f}만원")
print(f"지역 2: {gr2.mean():.1f}만원") 
print(f"지역 3: {gr3.mean():.1f}만원")
```

### 🔬 ANOVA 실행 및 효과크기 계산

```python
# ANOVA 실행
lmodel = ols('pay ~ C(group)', data=df).fit()
anova_result = anova_lm(lmodel, type=2)

print("\n📊 ANOVA 분산분석표:")
print(anova_result)

# 효과크기 계산
effect_sizes = calculate_effect_sizes(anova_result)

print(f"\n🎯 효과크기 분석:")
print(f"η² (에타제곱): {effect_sizes['eta_squared']:.4f}")
print(f"ω² (오메가제곱): {effect_sizes['omega_squared']:.4f}")
print(f"부분 η²: {effect_sizes['partial_eta_squared']:.4f}")

# 해석
effect_level, interpretation = interpret_effect_size(effect_sizes['eta_squared'])
print(f"\n💡 해석: {effect_level} ({interpretation})")
print(f"설명된 분산: {effect_sizes['eta_squared']*100:.1f}%")

# 실무적 의미
if effect_sizes['eta_squared'] >= 0.06:
    print("✅ 실무적으로 의미있는 차이 - 지역별 급여 정책 검토 필요")
else:
    print("⚠️ 통계적으로는 유의하나 실무적으로는 작은 차이")
```

---

## 🌡️ 온도와 음식점 매출 분석 (실제 사례)

### 📊 실제 비즈니스 데이터 분석

```python
def analyze_temperature_sales():
    """온도에 따른 음식점 매출 분석 (실제 사례)"""
    
    print("🌡️ 온도별 음식점 매출액 분석")
    print("=" * 50)
    
    # 데이터 로딩 및 전처리 (문서에서 제공된 코드 기반)
    sales_data = pd.read_csv('https://raw.githubusercontent.com/pykwon/python/refs/heads/master/testdata_utf8/tsales.csv',
                            dtype={'YMD': 'object'})
    
    wt_data = pd.read_csv('https://raw.githubusercontent.com/pykwon/python/refs/heads/master/testdata_utf8/tweather.csv')
    
    # 날짜 형식 통일
    wt_data.tm = wt_data.tm.map(lambda x: x.replace('-', ''))
    
    # 데이터 병합
    frame = sales_data.merge(wt_data, how='left', left_on='YMD', right_on='tm')
    
    # 필요한 컬럼만 선택
    data = frame.iloc[:, [0, 1, 7, 8]]  # 날짜, 매출액, 최고기온, 강수량
    data.columns = ['YMD', 'AMT', 'maxTa', 'sumRn']
    
    # 온도 구간화 (-5~8: 추위, 8~24: 적정, 24~37: 더위)
    data['ta_gubun'] = pd.cut(data.maxTa, bins=[-5, 8, 24, 37], labels=['추위', '적정', '더위'])
    
    # 결측치 제거
    data = data.dropna()
    
    print(f"📊 분석 데이터: {len(data)}일")
    print(f"온도 구간별 분포:")
    print(data.ta_gubun.value_counts())
    
    # 집단별 기술통계
    temp_stats = data.groupby('ta_gubun')['AMT'].agg(['count', 'mean', 'std'])
    print(f"\n💰 온도별 평균 매출액:")
    for idx, row in temp_stats.iterrows():
        print(f"{idx}: {row['mean']:,.0f}원 (n={row['count']})")
    
    # ANOVA 실행
    model = ols('AMT ~ C(ta_gubun)', data=data).fit()
    anova_result = anova_lm(model, type=2)
    
    print(f"\n📊 ANOVA 결과:")
    print(anova_result)
    
    # 효과크기 계산
    effect_sizes = calculate_effect_sizes(anova_result)
    
    print(f"\n🎯 효과크기:")
    print(f"η² = {effect_sizes['eta_squared']:.4f}")
    
    # 비즈니스 해석
    if effect_sizes['eta_squared'] >= 0.14:
        print("✅ 온도가 매출에 매우 큰 영향 - 계절별 마케팅 전략 필수!")
    elif effect_sizes['eta_squared'] >= 0.06:
        print("⚠️ 온도가 매출에 중간 정도 영향 - 온도 대응 전략 고려")
    else:
        print("❌ 온도의 매출 영향은 제한적")
        
    # 사후검정
    tukey_result = pairwise_tukeyhsd(endog=data['AMT'], groups=data['ta_gubun'])
    print(f"\n📈 사후검정 (Tukey HSD):")
    print(tukey_result)
    
    return data, anova_result, effect_sizes

# 실행
temp_data, temp_anova, temp_effects = analyze_temperature_sales()
```

---

## 🏥 이원분산분석 효과크기 (독과 처치법 사례)

### 📊 복합 효과크기 분석

```python
def analyze_poison_treatment():
    """독-처치법 이원분산분석 효과크기 분석"""
    
    print("☠️ 독 종류와 처치법의 복합 효과 분석")
    print("=" * 50)
    
    # 데이터 로딩
    data = pd.read_csv('https://raw.githubusercontent.com/pykwon/python/refs/heads/master/testdata_utf8/poison_treat.csv', 
                      index_col=0)
    
    print(f"📊 데이터: {len(data)}개 관측치")
    print(f"독 종류: {data.poison.unique()}")
    print(f"처치법: {data.treat.unique()}")
    
    # 이원분산분석 실행
    model = ols('time ~ C(poison) * C(treat)', data=data).fit()
    anova_result = anova_lm(model, type=2)
    
    print(f"\n📊 이원분산분석 결과:")
    print(anova_result)
    
    # 각 효과별 효과크기 계산
    ss_poison = anova_result.iloc[0, 1]
    ss_treat = anova_result.iloc[1, 1] 
    ss_interaction = anova_result.iloc[2, 1]
    ss_error = anova_result.iloc[3, 1]
    ss_total = ss_poison + ss_treat + ss_interaction + ss_error
    
    effects = {
        'poison_eta2': ss_poison / ss_total,
        'treat_eta2': ss_treat / ss_total,
        'interaction_eta2': ss_interaction / ss_total
    }
    
    print(f"\n🎯 효과크기 분석:")
    print(f"독 종류 η² = {effects['poison_eta2']:.4f} ({effects['poison_eta2']*100:.1f}% 설명)")
    print(f"처치법 η² = {effects['treat_eta2']:.4f} ({effects['treat_eta2']*100:.1f}% 설명)")
    print(f"상호작용 η² = {effects['interaction_eta2']:.4f} ({effects['interaction_eta2']*100:.1f}% 설명)")
    
    # 실무적 해석
    print(f"\n💡 실무적 해석:")
    
    if effects['poison_eta2'] >= 0.14:
        print("✅ 독 종류가 퍼짐 시간에 매우 큰 영향")
    elif effects['poison_eta2'] >= 0.06:
        print("⚠️ 독 종류가 퍼짐 시간에 중간 영향")
        
    if effects['treat_eta2'] >= 0.14:
        print("✅ 처치법이 퍼짐 시간에 매우 큰 영향")
    elif effects['treat_eta2'] >= 0.06:
        print("⚠️ 처치법이 퍼짐 시간에 중간 영향")
        
    if effects['interaction_eta2'] >= 0.06:
        print("🔄 상호작용 효과 존재 - 독에 따라 최적 처치법이 다름")
    else:
        print("🎯 상호작용 효과 미미 - 일관된 처치법 적용 가능")
    
    return data, anova_result, effects

# 실행
poison_data, poison_anova, poison_effects = analyze_poison_treatment()
```

---

## 📊 효과크기 시각화

### 🎨 직관적인 효과크기 이해

```python
def visualize_effect_sizes():
    """효과크기 시각화 함수"""
    
    plt.figure(figsize=(15, 10))
    
    # 1. 효과크기 막대그래프
    plt.subplot(2, 3, 1)
    effect_categories = ['작은 효과\n(η²=0.01)', '중간 효과\n(η²=0.06)', '큰 효과\n(η²=0.14)']
    effect_values = [0.01, 0.06, 0.14]
    colors = ['lightblue', 'orange', 'red']
    
    bars = plt.bar(effect_categories, effect_values, color=colors, alpha=0.7)
    plt.title('Cohen의 효과크기 기준')
    plt.ylabel('η² 값')
    
    # 값 표시
    for bar, val in zip(bars, effect_values):
        plt.text(bar.get_x() + bar.get_width()/2, bar.get_height() + 0.005,
                f'{val*100:.0f}%', ha='center', va='bottom')
    
    # 2. 실제 예제 비교
    plt.subplot(2, 3, 2)
    examples = ['편의점\n급여', '온도-매출', '독-처치법']
    example_effects = [0.28, 0.45, 0.35]  # 가상의 값들
    
    plt.bar(examples, example_effects, color=['skyblue', 'lightgreen', 'salmon'], alpha=0.8)
    plt.title('실제 분석 사례 효과크기')
    plt.ylabel('η² 값')
    plt.ylim(0, 0.5)
    
    # 3. 분산 설명 파이차트
    plt.subplot(2, 3, 3)
    eta_squared = 0.25  # 예시
    explained = eta_squared * 100
    unexplained = (1 - eta_squared) * 100
    
    plt.pie([explained, unexplained], 
            labels=[f'설명된 분산\n{explained:.1f}%', f'설명되지 않은 분산\n{unexplained:.1f}%'],
            colors=['lightcoral', 'lightgray'], autopct='%1.1f%%')
    plt.title('분산 분해 (η²=0.25인 경우)')
    
    # 4. p-value vs 효과크기 산점도
    plt.subplot(2, 3, 4)
    
    # 가상의 연구 결과들
    p_values = [0.001, 0.01, 0.03, 0.001, 0.02, 0.04, 0.001, 0.005]
    effect_sizes = [0.02, 0.15, 0.08, 0.35, 0.12, 0.05, 0.01, 0.25]
    
    scatter = plt.scatter(p_values, effect_sizes, c=effect_sizes, 
                         cmap='viridis', s=100, alpha=0.7)
    plt.xlabel('p-value')
    plt.ylabel('η² (효과크기)')
    plt.title('통계적 유의성 vs 효과크기')
    
    # 기준선 추가
    plt.axhline(y=0.06, color='orange', linestyle='--', alpha=0.7, label='중간 효과')
    plt.axhline(y=0.14, color='red', linestyle='--', alpha=0.7, label='큰 효과')
    plt.axvline(x=0.05, color='blue', linestyle='--', alpha=0.7, label='유의수준')
    plt.legend()
    
    # 5. 표본 크기와 검정력
    plt.subplot(2, 3, 5)
    sample_sizes = np.arange(10, 101, 10)
    power_small = [0.1, 0.15, 0.2, 0.25, 0.3, 0.35, 0.4, 0.45, 0.5, 0.55]  # 작은 효과
    power_medium = [0.3, 0.5, 0.65, 0.75, 0.85, 0.9, 0.95, 0.97, 0.99, 0.99]  # 중간 효과
    
    plt.plot(sample_sizes, power_small, 'o-', label='작은 효과 (η²=0.01)', color='lightblue')
    plt.plot(sample_sizes, power_medium, 's-', label='중간 효과 (η²=0.06)', color='orange')
    plt.xlabel('표본 크기')
    plt.ylabel('검정력 (Power)')
    plt.title('표본 크기별 검정력')
    plt.axhline(y=0.8, color='red', linestyle='--', alpha=0.7, label='권장 검정력')
    plt.legend()
    plt.grid(True, alpha=0.3)
    
    # 6. 실무적 의사결정 가이드
    plt.subplot(2, 3, 6)
    decisions = ['무시', '모니터링', '검토 필요', '즉시 대응']
    thresholds = [0.01, 0.06, 0.14, 0.25]
    colors_decision = ['gray', 'yellow', 'orange', 'red']
    
    bars = plt.bar(decisions, thresholds, color=colors_decision, alpha=0.7)
    plt.title('효과크기별 실무 대응 가이드')
    plt.ylabel('η² 임계값')
    
    plt.tight_layout()
    plt.show()

# 시각화 실행
visualize_effect_sizes()
```

---

## 💼 실무 의사결정 프레임워크

### 🎯 4단계 해석 체계

#### 📊 1단계: 통계적 유의성 확인
```python
def statistical_significance_check(p_value, alpha=0.05):
    """통계적 유의성 확인"""
    
    if p_value < alpha:
        return "통계적으로 유의함", f"p = {p_value:.4f} < {alpha}"
    else:
        return "통계적으로 유의하지 않음", f"p = {p_value:.4f} ≥ {alpha}"
```

#### 📈 2단계: 효과크기 평가
```python
def practical_significance_check(eta_squared):
    """실무적 중요성 평가"""
    
    if eta_squared >= 0.14:
        return "매우 중요", "즉시 행동 필요", "큰 효과"
    elif eta_squared >= 0.06:
        return "중요", "정책 검토 필요", "중간 효과"
    elif eta_squared >= 0.01:
        return "약간 중요", "모니터링 필요", "작은 효과"
    else:
        return "거의 무의미", "무시 가능", "무시할 수 있는 효과"
```

#### 💰 3단계: 비용-편익 분석
```python
def cost_benefit_analysis(effect_size, implementation_cost, expected_benefit):
    """비용-편익 관점에서 의사결정"""
    
    # ROI 계산 (매우 간단한 예시)
    adjusted_benefit = expected_benefit * effect_size
    roi = (adjusted_benefit - implementation_cost) / implementation_cost * 100
    
    if roi > 50:
        return "강력 추천", f"ROI: {roi:.1f}%"
    elif roi > 20:
        return "추천", f"ROI: {roi:.1f}%"
    elif roi > 0:
        return "신중한 검토", f"ROI: {roi:.1f}%"
    else:
        return "비추천", f"ROI: {roi:.1f}%"
```

#### 🎯 4단계: 종합 의사결정
```python
def comprehensive_decision(p_value, eta_squared, business_context):
    """종합적 의사결정 프레임워크"""
    
    # 1단계: 통계적 유의성
    stat_sig, stat_msg = statistical_significance_check(p_value)
    
    # 2단계: 실무적 중요성  
    prac_importance, action_needed, effect_level = practical_significance_check(eta_squared)
    
    # 종합 판단
    if p_value < 0.05 and eta_squared >= 0.06:
        decision = "✅ 실행 추천"
        reason = "통계적으로 유의하고 실무적으로도 의미있음"
    elif p_value < 0.05 and eta_squared < 0.06:
        decision = "⚠️ 신중한 검토"
        reason = "통계적으로는 유의하나 효과크기가 작음"
    elif p_value >= 0.05 and eta_squared >= 0.06:
        decision = "🤔 추가 데이터 수집"
        reason = "효과크기는 크나 통계적 유의성 부족"
    else:
        decision = "❌ 실행 불필요"
        reason = "통계적으로 유의하지 않고 효과크기도 작음"
    
    return {
        'decision': decision,
        'reason': reason,
        'statistical_significance': stat_msg,
        'effect_level': effect_level,
        'practical_importance': prac_importance,
        'recommended_action': action_needed
    }

# 사용 예시
example_decision = comprehensive_decision(p_value=0.02, eta_squared=0.08, 
                                        business_context="매출 증대 전략")
print("🎯 종합 의사결정 결과:")
for key, value in example_decision.items():
    print(f"{key}: {value}")
```

---

## 📋 실무 체크리스트

### ✅ ANOVA 분석 완료 체크리스트

#### 📊 분석 전 단계
- [ ] **표본 크기 충분한가?** (각 집단 최소 15개)
- [ ] **가정 검토 완료?** (정규성, 등분산성, 독립성)
- [ ] **결측치 처리 완료?** (제거 vs 대체)
- [ ] **이상치 확인?** (박스플롯, Z-score)

#### 📈 분석 단계
- [ ] **ANOVA 실행** (일원/이원)
- [ ] **p-value 해석** (< 0.05)
- [ ] **효과크기 계산** (η², ω²)
- [ ] **사후검정** (유의한 경우)

#### 💼 해석 및 보고 단계
- [ ] **통계적 유의성 확인**
- [ ] **효과크기 해석** (Cohen 기준)
- [ ] **실무적 중요성 평가**
- [ ] **비즈니스 맥락 고려**
- [ ] **한계점 및 주의사항 명시**

### 🚨 자주 하는 실수들

#### ❌ **피해야 할 것들**
1. **p-value만 보고 판단**: "p=0.03이니까 중요하다!"
2. **효과크기 무시**: "유의하니까 실행하자!"
3. **표본 크기 무시**: "n=5인데 유의하네?"
4. **맥락 고려 안함**: "통계 결과가 전부다!"

#### ✅ **해야 할 것들**
1. **p-value + 효과크기 함께 보기**
2. **비즈니스 맥락에서 해석**
3. **비용-편익 고려**
4. **추가 연구 필요성 검토**

---

## 🎓 실무 사례 종합

### 🏪 편의점 급여 사례 최종 결론

```python
# 가상의 최종 분석 결과
print("🏪 GS편의점 알바 급여 분석 최종 결론")
print("=" * 50)
print("📊 통계 결과:")
print("   • F-statistic: 3.711, p-value: 0.044")
print("   • η²: 0.281 (28.1% 분산 설명)")
print("   • 효과크기: 큰 효과")
print("\n💼 실무적 해석:")
print("   • 지역별 급여 차이 확실히 존재")
print("   • 지역 1 > 지역 3 > 지역 2 순")
print("   • 최대 60만원 차이 발생")
print("\n🎯 권고사항:")
print("   ✅ 지역별 급여 체계 재검토 필요")
print("   ✅ 지역 2 급여 수준 개선 검토")
print("   ✅ 생활비 지수 반영 급여 정책 수립")
```

### 🌡️ 온도-매출 사례 최종 결론

```python
print("\n🌡️ 온도별 음식점 매출 분석 최종 결론")
print("=" * 50)
print("📊 통계 결과:")
print("   • F-statistic: 99.19, p-value: 2.36e-34")
print("   • η²: 0.379 (37.9% 분산 설명)")
print("   • 효과크기: 매우 큰 효과")
print("\n💼 실무적 해석:")
print("   • 온도가 매출에 매우 강한 영향")
print("   • 더위 > 적정 > 추위 순 매출")
print("   • 최대 47만원 매출 차이")
print("\n🎯 권고사항:")
print("   ✅ 계절별 차별화 메뉴 전략")
print("   ✅ 여름철 마케팅 집중 투자")
print("   ✅ 겨울철 프로모션 강화")
```

---

## 🚀 다음 단계

### 📈 고급 분석 기법

1. **메타분석**: 여러 연구의 효과크기 통합
2. **베이지안 ANOVA**: 사전 정보 활용
3. **기계학습과 결합**: 예측 모델링
4. **실시간 A/B 테스트**: 동적 효과크기 모니터링

### 💡 실무 발전 방향

- **자동화 대시보드**: 효과크기 실시간 모니터링
- **의사결정 시스템**: 규칙 기반 자동 판단
- **ROI 계산기**: 통계적 결과의 재정적 가치 산정

---

## 🎯 핵심 요약

> **"통계적 유의성은 시작일 뿐, 효과크기가 진짜 답을 알려준다"**

### 📊 황금 공식

```
실무적 가치 = 통계적 유의성 × 효과크기 × 비즈니스 맥락
```

### 🎓 기억할 3가지

1. **p < 0.05**는 시작점, **η² ≥ 0.06**이 실행점
2. **효과크기가 작아도 큰 표본에서는 유의**할 수 있음
3. **비즈니스 맥락**이 최종 의사결정을 좌우함

### 💫 실무자를 위한 마지막 조언

- 📊 **항상 효과크기를 함께 보고하세요**
- 🎯 **Cohen의 기준은 참고일 뿐, 업계 특성을 고려하세요**
- 💼 **통계 결과를 비즈니스 언어로 번역하세요**
- 🚀 **지속적인 모니터링과 업데이트를 잊지 마세요**

---

**이제 ANOVA 시리즈 22.07이 완성되었습니다! 기초부터 실무 활용까지 모든 과정을 마스터하셨습니다!** 🎉
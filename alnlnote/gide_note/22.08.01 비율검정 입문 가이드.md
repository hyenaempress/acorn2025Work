# 22.8 비율검정 입문 가이드
*성공률과 실패율로 세상을 이해하는 통계의 핵심 도구*

---

## 🎯 비율검정(Proportion Test)이란?

**비율검정**은 집단의 **성공률, 합격률, 만족률** 등이 특정 기준과 같은지, 또는 서로 다른 집단 간 비율이 같은지를 통계적으로 검증하는 방법입니다.

### 🔍 언제 비율검정을 사용하나요?

데이터가 **이항(Binary) 형태**일 때 사용합니다:
- ✅ 성공/실패
- ✅ 합격/불합격  
- ✅ 만족/불만족
- ✅ 찬성/반대
- ✅ 남성/여성

> 💡 **핵심**: ANOVA가 **평균의 차이**를 검정했다면, 비율검정은 **성공률의 차이**를 검정합니다!

---

## 📚 비율검정의 두 가지 유형

### 🎯 1. 일원 비율검정 (One-sample Proportion Test)

**상황**: 한 집단의 비율이 특정 기준값과 다른지 검정

**예시**:
- 신제품 만족도가 70%를 넘는지 확인
- 우리 회사 직원 흡연율이 국가 평균과 다른지 확인
- 새로운 치료법의 성공률이 기존 80%보다 높은지 확인

### 🎯 2. 이원 비율검정 (Two-sample Proportion Test)

**상황**: 두 집단의 비율이 서로 다른지 비교

**예시**:
- 남성과 여성의 합격률 차이
- A회사와 B회사의 직원 만족도 차이
- 기존 치료법과 신약의 치료 성공률 비교

---

## 💻 실습 1: 일원 비율검정 - 회사 흡연율 분석

### 🎯 연구 상황

**문제**: A회사 직원 100명 중 45명이 흡연한다. 국가 통계에 따르면 국민 흡연율은 35%이다. A회사 직원들의 흡연율이 국가 평균과 통계적으로 다른가?

**가설 설정**:
- **귀무가설(H₀)**: A회사 직원 흡연율 = 국민 흡연율 (35%)
- **대립가설(H₁)**: A회사 직원 흡연율 ≠ 국민 흡연율 (35%)

### 💻 Python 코드 구현

```python
import numpy as np
from statsmodels.stats.proportion import proportions_ztest
import matplotlib.pyplot as plt

print("🚬 A회사 직원 흡연율 vs 국가 평균 비교")
print("=" * 50)

# 데이터 설정
count = np.array([45])    # 흡연자 수
nobs = np.array([100])    # 전체 직원 수  
national_rate = 0.35      # 국가 흡연율 (35%)

# 일원 비율검정 실시
z_stat, p_value = proportions_ztest(count=count, nobs=nobs, value=national_rate)

# 결과 출력
company_rate = count[0] / nobs[0]
print(f"📊 기본 정보:")
print(f"   • A회사 흡연율: {company_rate:.1%} ({count[0]}명/{nobs[0]}명)")
print(f"   • 국가 흡연율: {national_rate:.1%}")
print(f"   • 차이: {company_rate - national_rate:+.1%}")

print(f"\n🔬 검정 결과:")
print(f"   • Z-통계량: {z_stat:.4f}")
print(f"   • p-value: {p_value:.6f}")
print(f"   • 유의수준: 0.05")

# 결론
if p_value < 0.05:
    print(f"   • 결론: 귀무가설 기각 ❌")
    print(f"   • 해석: A회사 흡연율이 국가 평균과 통계적으로 유의하게 다름")
else:
    print(f"   • 결론: 귀무가설 채택 ✅")
    print(f"   • 해석: A회사 흡연율이 국가 평균과 통계적으로 유의한 차이 없음")
```

**실행 결과**:
```
🚬 A회사 직원 흡연율 vs 국가 평균 비교
==================================================
📊 기본 정보:
   • A회사 흡연율: 45.0% (45명/100명)
   • 국가 흡연율: 35.0%
   • 차이: +10.0%

🔬 검정 결과:
   • Z-통계량: 2.0101
   • p-value: 0.044423
   • 유의수준: 0.05
   • 결론: 귀무가설 기각 ❌
   • 해석: A회사 흡연율이 국가 평균과 통계적으로 유의하게 다름
```

---

## 💻 실습 2: 이원 비율검정 - 회사별 커피 소비 비교

### 🎯 연구 상황

**문제**: A회사 직원 300명 중 100명이 커피를 마시고, B회사 직원 400명 중 170명이 커피를 마신다. 두 회사의 커피 소비율이 통계적으로 다른가?

**가설 설정**:
- **귀무가설(H₀)**: A회사 커피 소비율 = B회사 커피 소비율
- **대립가설(H₁)**: A회사 커피 소비율 ≠ B회사 커피 소비율

### 💻 Python 코드 구현

```python
print("☕ A회사 vs B회사 커피 소비율 비교")
print("=" * 50)

# 데이터 설정
count = np.array([100, 170])    # 각 회사 커피 소비자 수
nobs = np.array([300, 400])     # 각 회사 전체 직원 수

# 이원 비율검정 실시  
z_stat, p_value = proportions_ztest(count=count, nobs=nobs)

# 각 회사별 소비율 계산
rate_A = count[0] / nobs[0]
rate_B = count[1] / nobs[1]

print(f"📊 기본 정보:")
print(f"   • A회사 커피 소비율: {rate_A:.1%} ({count[0]}명/{nobs[0]}명)")
print(f"   • B회사 커피 소비율: {rate_B:.1%} ({count[1]}명/{nobs[1]}명)")
print(f"   • 차이: {rate_A - rate_B:+.1%}")

print(f"\n🔬 검정 결과:")
print(f"   • Z-통계량: {z_stat:.4f}")
print(f"   • p-value: {p_value:.2e}")
print(f"   • 유의수준: 0.05")

# 결론
if p_value < 0.05:
    print(f"   • 결론: 귀무가설 기각 ❌")
    print(f"   • 해석: 두 회사의 커피 소비율이 통계적으로 유의하게 다름")
    if rate_A > rate_B:
        print(f"   • 세부: A회사가 B회사보다 커피를 더 많이 마심")
    else:
        print(f"   • 세부: B회사가 A회사보다 커피를 더 많이 마심")
else:
    print(f"   • 결론: 귀무가설 채택 ✅")
    print(f"   • 해석: 두 회사의 커피 소비율에 통계적으로 유의한 차이 없음")

# 시각화
plt.figure(figsize=(10, 6))
companies = ['A회사', 'B회사']
rates = [rate_A, rate_B]
colors = ['skyblue', 'lightgreen']

plt.bar(companies, rates, color=colors, alpha=0.7, width=0.6)
plt.ylabel('커피 소비율')
plt.title('회사별 커피 소비율 비교')
plt.ylim(0, max(rates) * 1.2)

# 비율을 막대 위에 표시
for i, (company, rate) in enumerate(zip(companies, rates)):
    plt.text(i, rate + 0.01, f'{rate:.1%}', ha='center', fontsize=12, fontweight='bold')

plt.grid(axis='y', alpha=0.3)
plt.tight_layout()
plt.show()
```

---

## 💻 실습 3: 이항검정 - 고객 만족도 분석

### 🎯 연구 상황

**문제**: 직원 대상 고객 대응 교육 후, 150명의 고객 중 136명이 서비스에 만족했다. 목표 만족률 80%에 도달했는가?

**가설 설정**:
- **귀무가설(H₀)**: 고객 만족률 = 80%
- **대립가설(H₁)**: 고객 만족률 > 80% (단측검정)

### 💻 Python 코드 구현

```python
import pandas as pd
import scipy.stats as stats
import matplotlib.pyplot as plt

print("😊 고객 만족도 교육 효과 분석")
print("=" * 50)

# 데이터 로딩 및 전처리
data = pd.read_csv('https://raw.githubusercontent.com/pykwon/python/refs/heads/master/testdata_utf8/one_sample.csv')
print(f"📊 원본 데이터:")
print(data.head(3))

# 교차표 생성
ctab = pd.crosstab(index=data['survey'], columns='count')
ctab.index = ['불만족', '만족']
print(f"\n📊 고객 만족도 현황:")
print(ctab)

# 기본 정보
n_total = 150        # 전체 응답자
n_satisfied = 136    # 만족 고객
target_rate = 0.8    # 목표 만족률

actual_rate = n_satisfied / n_total
print(f"\n📊 기본 정보:")
print(f"   • 실제 만족률: {actual_rate:.1%} ({n_satisfied}명/{n_total}명)")
print(f"   • 목표 만족률: {target_rate:.1%}")
print(f"   • 차이: {actual_rate - target_rate:+.1%}")

# 양측검정 (만족률이 80%와 다른가?)
print(f"\n🔬 양측검정 결과:")
result_two = stats.binomtest(k=n_satisfied, n=n_total, p=target_rate, alternative='two-sided')
print(f"   • p-value: {result_two.pvalue:.6f}")
if result_two.pvalue < 0.05:
    print(f"   • 결론: 만족률이 80%와 통계적으로 유의하게 다름")
else:
    print(f"   • 결론: 만족률이 80%와 통계적으로 유의한 차이 없음")

# 단측검정 (만족률이 80%보다 높은가?)
print(f"\n🔬 단측검정 결과 (80%보다 높은지):")
result_one = stats.binomtest(k=n_satisfied, n=n_total, p=target_rate, alternative='greater')
print(f"   • p-value: {result_one.pvalue:.6f}")
if result_one.pvalue < 0.05:
    print(f"   • 결론: 만족률이 80%보다 통계적으로 유의하게 높음 🎉")
    print(f"   • 해석: 고객 대응 교육이 효과적이었음!")
else:
    print(f"   • 결론: 만족률이 80%보다 통계적으로 유의하게 높다고 할 수 없음")

# 시각화
fig, (ax1, ax2) = plt.subplots(1, 2, figsize=(12, 5))

# 만족도 파이차트
labels = ['만족', '불만족']  
sizes = [n_satisfied, n_total - n_satisfied]
colors = ['lightgreen', 'lightcoral']
explode = (0.1, 0)  # 만족 부분 강조

ax1.pie(sizes, labels=labels, colors=colors, explode=explode, autopct='%1.1f%%', 
        shadow=True, startangle=90)
ax1.set_title('고객 만족도 분포')

# 목표 vs 실제 비교
categories = ['목표 만족률', '실제 만족률']
rates = [target_rate, actual_rate]
colors = ['lightblue', 'lightgreen']

bars = ax2.bar(categories, rates, color=colors, alpha=0.7, width=0.6)
ax2.set_ylabel('만족률')
ax2.set_title('목표 vs 실제 만족률 비교')
ax2.set_ylim(0, 1)

# 수치를 막대 위에 표시
for bar, rate in zip(bars, rates):
    height = bar.get_height()
    ax2.text(bar.get_x() + bar.get_width()/2., height + 0.01,
             f'{rate:.1%}', ha='center', va='bottom', fontweight='bold')

plt.tight_layout()
plt.show()
```

---

## 🔍 비율검정 vs 다른 검정 방법 비교

### 📊 검정 방법 선택 가이드

| 데이터 유형 | 검정 목적 | 사용 검정 | 예시 |
|------------|----------|----------|------|
| **비율 (이항)** | 한 집단 vs 기준값 | **일원 비율검정** | 합격률이 70%인가? |
| **비율 (이항)** | 두 집단 비교 | **이원 비율검정** | 남녀 합격률 차이는? |
| **평균 (연속)** | 한 집단 vs 기준값 | t검정 | 평균키가 170cm인가? |
| **평균 (연속)** | 두 집단 비교 | 독립 t검정 | 남녀 평균키 차이는? |
| **평균 (연속)** | 3개 이상 집단 | ANOVA | 지역별 평균 소득 차이? |

### 🎯 핵심 포인트

```python
def 검정방법_선택가이드():
    """상황별 적절한 검정 방법 선택"""
    
    가이드 = {
        "데이터가 성공/실패 형태": "→ 비율검정 사용",
        "데이터가 연속적 수치": "→ t검정 또는 ANOVA 사용",
        "한 집단과 기준값 비교": "→ 일원 검정",
        "두 집단 간 비교": "→ 이원 검정",  
        "3개 이상 집단 비교": "→ ANOVA"
    }
    
    return 가이드

# 실행
선택가이드 = 검정방법_선택가이드()
for 상황, 방법 in 선택가이드.items():
    print(f"{상황} {방법}")
```

---

## 🚨 비율검정 주의사항 및 가정

### ⚠️ 비율검정 사용 조건

1. **충분한 표본 크기**:
   - np ≥ 5 그리고 n(1-p) ≥ 5
   - n: 표본 크기, p: 기대 비율

2. **독립성**:
   - 각 관측값이 서로 독립적이어야 함
   - 복원추출 또는 모집단의 10% 미만 표본

3. **이항분포 가정**:
   - 각 시행은 성공 또는 실패
   - 성공 확률이 일정함

### 🔧 문제 해결 방법

```python
def 표본크기_확인(n, p):
    """비율검정 표본크기 조건 확인"""
    
    np_value = n * p
    n1_p_value = n * (1 - p)
    
    print(f"표본크기 조건 확인:")
    print(f"  np = {n} × {p} = {np_value:.1f}")
    print(f"  n(1-p) = {n} × {1-p} = {n1_p_value:.1f}")
    
    if np_value >= 5 and n1_p_value >= 5:
        print("  ✅ 조건 만족: 정규근사 가능")
        return True
    else:
        print("  ❌ 조건 불만족: 정확검정(Exact test) 사용 권장")
        return False

# 사용 예시
표본크기_확인(n=100, p=0.45)  # A회사 흡연율 예시
```

---

## 📊 실무 활용 시나리오

### 🎯 마케팅 분야

```python
def 마케팅_AB테스트():
    """A/B 테스트에서 비율검정 활용"""
    
    시나리오 = {
        "상황": "새로운 광고 디자인 효과 측정",
        "기존광고": "클릭률 3.2% (10,000명 중 320명 클릭)",
        "새광고": "클릭률 3.8% (10,000명 중 380명 클릭)",
        "질문": "새 광고의 클릭률이 통계적으로 유의하게 높은가?",
        "검정": "이원 비율검정 (단측)"
    }
    
    return 시나리오
```

### 🏥 의료 분야

```python
def 의료_치료효과():
    """신약 치료 효과 검증"""
    
    시나리오 = {
        "상황": "신약과 기존 치료법 비교",
        "기존치료": "완치율 65% (200명 중 130명)",  
        "신약치료": "완치율 72% (200명 중 144명)",
        "질문": "신약의 완치율이 통계적으로 유의하게 높은가?",
        "검정": "이원 비율검정 (단측)"
    }
    
    return 시나리오
```

### 🏭 품질관리 분야

```python
def 품질관리_불량률():
    """제품 불량률 개선 효과 측정"""
    
    시나리오 = {
        "상황": "공정 개선 후 불량률 변화",
        "개선전": "불량률 2.5% (기준값)",
        "개선후": "불량률 1.8% (5,000개 중 90개 불량)",
        "질문": "공정 개선이 불량률을 유의하게 낮췄는가?",
        "검정": "일원 비율검정 (단측)"
    }
    
    return 시나리오
```

---

## 🎓 핵심 정리 및 다음 단계

### ✅ **비율검정 마스터 체크리스트**

```python
def 비율검정_체크리스트():
    """비율검정 완전 이해 체크리스트"""
    
    체크리스트 = {
        "✅ 기본 개념": [
            "비율검정 vs t검정 vs ANOVA 구분",
            "일원 vs 이원 비율검정 선택",
            "양측 vs 단측 검정 판단",
            "이항분포와 정규근사 이해"
        ],
        "✅ 실무 적용": [
            "A/B 테스트 설계 및 분석",
            "품질관리 불량률 검정",
            "만족도 조사 결과 해석",
            "Python으로 검정 구현"
        ],
        "✅ 해석 능력": [
            "p-value 기반 의사결정",
            "통계적 vs 실무적 유의성 구분",
            "표본크기와 검정력의 관계 이해",
            "결과의 비즈니스 의미 파악"
        ]
    }
    
    return 체크리스트

# 체크리스트 출력
완료항목 = 비율검정_체크리스트()
for 영역, 항목들 in 완료항목.items():
    print(f"\n{영역}:")
    for 항목 in 항목들:
        print(f"   • {항목}")
```

### 🚀 **다음 학습 단계: 분산, 공분산, 상관계수**

```python
def 다음_학습_preview():
    """22.9 분산/공분산/상관계수 미리보기"""
    
    preview = {
        "22.9 학습목표": "두 변수 간의 관계 분석",
        "핵심질문": "키가 클수록 몸무게도 무거운가?",
        "학습내용": [
            "분산: 데이터의 흩어진 정도 측정",
            "공분산: 두 변수가 함께 움직이는 패턴",  
            "상관계수: 관계의 강도를 -1~1로 표준화",
            "실무활용: 변수 선택, 다중공선성 진단"
        ],
        "연결점": "회귀분석의 핵심 기초!"
    }
    
    return preview

다음단계 = 다음_학습_preview()
print("🔮 다음 학습 미리보기:")
for 항목, 내용 in 다음단계.items():
    if isinstance(내용, list):
        print(f"{항목}:")
        for 세부 in 내용:
            print(f"   • {세부}")
    else:
        print(f"{항목}: {내용}")
```

---

## 💡 최종 메시지

### 🏆 **축하합니다!**

**비율검정**을 완전히 마스터하셨습니다! 🎉

#### **🎯 핵심 성과**
- ✅ **일원 비율검정**: 한 집단과 기준값 비교 완벽 이해
- ✅ **이원 비율검정**: 두 집단 간 비율 차이 검정 마스터
- ✅ **이항검정**: 고객 만족도 등 실무 적용 능력 확보
- ✅ **Python 구현**: 실제 데이터 분석 및 시각화 완성

#### **🚀 다음 여정**

이제 **개별 집단의 특성**(비율, 평균)에서 **변수 간의 관계**로 시야를 넓혀보겠습니다:

**비율검정** → **분산/공분산/상관계수** → **최소제곱법** → **회귀분석** → **머신러닝**

**"통계는 세상의 패턴을 찾는 렌즈입니다. 비율검정으로 개별 현상을 이해했으니, 이제 변수들 사이의 숨겨진 관계를 발견해보겠습니다!"** 🔍✨
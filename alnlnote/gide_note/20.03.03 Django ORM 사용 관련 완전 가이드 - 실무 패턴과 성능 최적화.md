# 20.03.03 Django ORM ì‚¬ìš© ê´€ë ¨ ì™„ì „ ê°€ì´ë“œ - ì‹¤ë¬´ íŒ¨í„´ê³¼ ì„±ëŠ¥ ìµœì í™”

## ëª©ì°¨
1. [Django ORM vs Raw SQL ì„ íƒ ê¸°ì¤€](#django-orm-vs-raw-sql-ì„ íƒ-ê¸°ì¤€)
2. [Django ORM í•µì‹¬ ì›ì¹™ê³¼ íŒ¨í„´](#django-orm-í•µì‹¬-ì›ì¹™ê³¼-íŒ¨í„´)
3. [ORM ë·° í•¨ìˆ˜ êµ¬í˜„](#orm-ë·°-í•¨ìˆ˜-êµ¬í˜„)
4. [ORM ì „ìš© í…œí”Œë¦¿ êµ¬ì„±](#orm-ì „ìš©-í…œí”Œë¦¿-êµ¬ì„±)
5. [ëª¨ë¸ ì„¤ì • ë° ê´€ê³„ ì •ì˜](#ëª¨ë¸-ì„¤ì •-ë°-ê´€ê³„-ì •ì˜)
6. [ì„±ëŠ¥ ìµœì í™” ê¸°ë²•](#ì„±ëŠ¥-ìµœì í™”-ê¸°ë²•)
7. [ì‹¤ë¬´ í™œìš© íŒ¨í„´](#ì‹¤ë¬´-í™œìš©-íŒ¨í„´)
8. [íŠ¸ëŸ¬ë¸”ìŠˆíŒ…](#íŠ¸ëŸ¬ë¸”ìŠˆíŒ…)

---

## Django ORM vs Raw SQL ì„ íƒ ê¸°ì¤€

### ê°•ì‚¬ë‹˜ì˜ ì‹¤ë¬´ ì¡°ì–¸
> **"ì¥ê³  ORMì„ ì¨ë„ ë˜ê³  ê·¸ëƒ¥ Raw SQL ë¬¸ì¥ì„ ì¨ë„ ê´œì°®ì•„ìš”. í¸í•œ ê±¸ë¡œ í•˜ì‹œë©´ ë©ë‹ˆë‹¤."**

### ğŸ“Š ì„ íƒ ê¸°ì¤€í‘œ

| ìƒí™© | Django ORM | Raw SQL | ê¶Œì¥ |
|------|-----------|---------|------|
| ë‹¨ìˆœ CRUD | âœ… ë§¤ìš° ì í•© | âš ï¸ ê³¼ë„í•¨ | **ORM** |
| ë³µì¡í•œ JOIN | âš ï¸ ê°€ëŠ¥í•˜ì§€ë§Œ ë³µì¡ | âœ… ì§ê´€ì  | **ìƒí™©ë³„** |
| ì§‘ê³„ ì¿¼ë¦¬ | âœ… ì í•© | âœ… ì í•© | **ìƒí™©ë³„** |
| ì„±ëŠ¥ ìµœì í™” | âš ï¸ ì œí•œì  | âœ… ì™„ì „ ì œì–´ | **Raw SQL** |
| ë³´ì•ˆ ì¤‘ìš” | âœ… ìë™ ë°©ì§€ | âš ï¸ ì£¼ì˜ í•„ìš” | **ORM** |
| íŒ€ í˜‘ì—… | âœ… ê°€ë…ì„± ì¢‹ìŒ | âš ï¸ SQL ì§€ì‹ í•„ìš” | **ORM** |
| ë¹ ë¥¸ ê°œë°œ | âœ… ë§¤ìš° ë¹ ë¦„ | âš ï¸ ì‹œê°„ ì†Œìš” | **ORM** |
| DB ë…ë¦½ì„± | âœ… ì™„ì „ ë…ë¦½ | âŒ DB ì¢…ì† | **ORM** |

### ğŸ¯ ì‹¤ë¬´ ê¶Œì¥ íŒ¨í„´

#### 1. ORM ìš°ì„  ì‚¬ìš© ì¼€ì´ìŠ¤
```python
# âœ… ì´ëŸ° ê²½ìš°ëŠ” ORMì´ ë” ì¢‹ìŠµë‹ˆë‹¤
# ë‹¨ìˆœ ì¡°íšŒ
users = User.objects.filter(is_active=True)

# ê¸°ë³¸ ê´€ê³„ ì¡°íšŒ
posts = Post.objects.select_related('author').filter(published=True)

# ê°„ë‹¨í•œ ì§‘ê³„
user_count = User.objects.count()
avg_age = User.objects.aggregate(avg_age=Avg('age'))
```

#### 2. Raw SQL ê¶Œì¥ ì¼€ì´ìŠ¤
```python
# âœ… ì´ëŸ° ê²½ìš°ëŠ” Raw SQLì´ ë” íš¨ìœ¨ì ì…ë‹ˆë‹¤
# ë³µì¡í•œ ì§‘ê³„ ì¿¼ë¦¬
sql = """
SELECT 
    dept.name,
    COUNT(emp.id) as emp_count,
    AVG(emp.salary) as avg_salary,
    RANK() OVER (ORDER BY AVG(emp.salary) DESC) as salary_rank
FROM departments dept
LEFT JOIN employees emp ON dept.id = emp.dept_id
GROUP BY dept.id, dept.name
HAVING COUNT(emp.id) > 5
"""

# ì„±ëŠ¥ì´ ì¤‘ìš”í•œ ëŒ€ìš©ëŸ‰ ë°ì´í„° ì²˜ë¦¬
with connection.cursor() as cursor:
    cursor.execute(sql)
    results = cursor.fetchall()
```

#### 3. í˜¼ìš© íŒ¨í„´
```python
# ğŸ¯ ì‹¤ë¬´ì—ì„œëŠ” ì´ë ‡ê²Œ í˜¼ìš©í•©ë‹ˆë‹¤
def get_department_analysis(request):
    # ORMìœ¼ë¡œ ê¸°ë³¸ ì¡°íšŒ
    departments = Department.objects.filter(active=True)
    
    # Raw SQLë¡œ ë³µì¡í•œ ë¶„ì„
    analysis_sql = """
    SELECT dept_id, complex_calculation(...)
    FROM complex_analysis_view
    WHERE conditions...
    """
    
    # ê²°ê³¼ ì¡°í•©
    return combine_results(departments, analysis_sql)
```

---

## Django ORM í•µì‹¬ ì›ì¹™ê³¼ íŒ¨í„´

### ğŸ”¥ LAZY EVALUATION (ì§€ì—° í‰ê°€)
QuerySetì€ ì‹¤ì œë¡œ ë°ì´í„°ê°€ í•„ìš”í•  ë•Œê¹Œì§€ DBì— ì ‘ê·¼í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.

```python
# ì´ ì‹œì ì—ì„œëŠ” DBì— ì ‘ê·¼í•˜ì§€ ì•ŠìŒ
queryset = User.objects.filter(is_active=True)
queryset = queryset.order_by('username')
queryset = queryset.select_related('profile')

# ì´ ì‹œì ì—ì„œ ì‹¤ì œ DB ì¿¼ë¦¬ ì‹¤í–‰
users = list(queryset)  # ë˜ëŠ” for user in queryset:
```

### ğŸ“‹ ì£¼ìš” QuerySet ë©”ì„œë“œ

#### 1. ê¸°ë³¸ ì¡°íšŒ ë©”ì„œë“œ
```python
# ì „ì²´ ì¡°íšŒ
User.objects.all()

# ì¡°ê±´ í•„í„°ë§
User.objects.filter(is_active=True)          # WHERE is_active = True
User.objects.exclude(is_active=False)        # WHERE NOT is_active = False

# ë‹¨ì¼ ê°ì²´ ì¡°íšŒ
User.objects.get(id=1)                       # ì—†ìœ¼ë©´ DoesNotExist ì˜ˆì™¸
User.objects.filter(id=1).first()            # ì—†ìœ¼ë©´ None ë°˜í™˜

# ì¡´ì¬ ì—¬ë¶€ í™•ì¸
User.objects.filter(email='test@test.com').exists()
```

#### 2. ì •ë ¬ ë° ì œí•œ
```python
# ì •ë ¬
User.objects.order_by('username')            # ì˜¤ë¦„ì°¨ìˆœ
User.objects.order_by('-created_at')         # ë‚´ë¦¼ì°¨ìˆœ
User.objects.order_by('department', '-salary')  # ë‹¤ì¤‘ ì •ë ¬

# ì œí•œ
User.objects.all()[:10]                      # LIMIT 10
User.objects.all()[10:20]                    # OFFSET 10 LIMIT 10
```

#### 3. í•„ë“œ ë£©ì—… (Field Lookups)
```python
# ì •í™• ì¼ì¹˜
User.objects.filter(username__exact='admin')
User.objects.filter(username__iexact='ADMIN')  # ëŒ€ì†Œë¬¸ì ë¬´ì‹œ

# ë¶€ë¶„ ì¼ì¹˜
User.objects.filter(username__contains='admin')      # LIKE '%admin%'
User.objects.filter(username__icontains='ADMIN')     # ëŒ€ì†Œë¬¸ì ë¬´ì‹œ
User.objects.filter(username__startswith='ad')       # LIKE 'ad%'
User.objects.filter(username__endswith='min')        # LIKE '%min'

# ë²”ìœ„
User.objects.filter(age__gt=18)              # age > 18
User.objects.filter(age__gte=18)             # age >= 18
User.objects.filter(age__lt=65)              # age < 65
User.objects.filter(age__lte=65)             # age <= 65
User.objects.filter(age__range=(18, 65))     # BETWEEN 18 AND 65

# ë¦¬ìŠ¤íŠ¸ í¬í•¨
User.objects.filter(department__in=['IT', 'HR'])  # IN ('IT', 'HR')

# NULL ì²´í¬
User.objects.filter(phone__isnull=True)      # IS NULL
User.objects.filter(phone__isnull=False)     # IS NOT NULL

# ë‚ ì§œ
User.objects.filter(created_at__year=2024)
User.objects.filter(created_at__month=3)
User.objects.filter(created_at__day=15)
User.objects.filter(created_at__date='2024-03-15')
```

---

## ORM ë·° í•¨ìˆ˜ êµ¬í˜„

### ğŸ¢ ì™„ì „í•œ ORM ë·° í•¨ìˆ˜

```python
# myapp/views.py - ORM í™œìš© ë²„ì „

from django.shortcuts import render
from django.db.models import Count, Avg, Sum, Q, F, Max, Min, Case, When, IntegerField
from django.db.models import Exists, OuterRef
from django.utils.html import escape
from django.utils import timezone
from .models import Jikwon, Buser, Gogek
import pandas as pd

def ormAnalysisFunc(request):
    """Django ORMì„ í™œìš©í•œ ì§ì› ì •ë³´ ë¶„ì„"""
    
    # ì‚¬ìš©ì ì…ë ¥ ì²˜ë¦¬ (XSS ë°©ì§€)
    dept = (request.GET.get('dept') or "").strip()
    safe_dept = escape(dept)

    # =================================================================
    # 1. ê¸°ë³¸ ORM ì¡°íšŒ - SELECT_RELATEDë¡œ JOIN ìµœì í™”
    # =================================================================
    
    # Raw SQL: SELECT j.*, b.busername FROM jikwon j INNER JOIN buser b ON j.busernum = b.buserno
    # ORM ë²„ì „: select_related()ë¥¼ ì‚¬ìš©í•œ íš¨ìœ¨ì ì¸ JOIN
    jikwons_query = Jikwon.objects.select_related('busernum')
    
    # ë¶€ì„œ í•„í„°ë§ (SQL ì¸ì ì…˜ ìë™ ë°©ì§€)
    if dept:
        # Raw SQL: WHERE b.busername LIKE '%dept%'
        # ORM ë²„ì „: ì•ˆì „í•œ í•„í„°ë§
        jikwons_query = jikwons_query.filter(
            busernum__busername__icontains=dept  # ëŒ€ì†Œë¬¸ì ë¬´ì‹œ ë¶€ë¶„ ê²€ìƒ‰
        )
    
    # ì •ë ¬ (ORDER BY)
    jikwons = jikwons_query.order_by('jikwonno')
    
    # =================================================================
    # 2. ì§‘ê³„ í•¨ìˆ˜ í™œìš© - ë¶€ì„œë³„ ìƒì„¸ í†µê³„
    # =================================================================
    
    dept_stats = (
        Buser.objects
        .annotate(
            ì§ì›ìˆ˜=Count('jikwon'),                    # COUNT(*)
            í‰ê· ì—°ë´‰=Avg('jikwon__jikwonpay'),          # AVG(jikwonpay)
            ì´ì—°ë´‰=Sum('jikwon__jikwonpay'),           # SUM(jikwonpay)
            ìµœê³ ì—°ë´‰=Max('jikwon__jikwonpay'),          # MAX(jikwonpay)
            ìµœì €ì—°ë´‰=Min('jikwon__jikwonpay'),          # MIN(jikwonpay)
            ë‚¨ì„±ì§ì›ìˆ˜=Count(
                Case(When(jikwon__jikwongen='ë‚¨', then=1), 
                     output_field=IntegerField())
            ),
            ì—¬ì„±ì§ì›ìˆ˜=Count(
                Case(When(jikwon__jikwongen='ì—¬', then=1), 
                     output_field=IntegerField())
            )
        )
        .filter(ì§ì›ìˆ˜__gt=0)                         # HAVING COUNT(*) > 0
        .order_by('-í‰ê· ì—°ë´‰')                        # ORDER BY í‰ê· ì—°ë´‰ DESC
    )
    
    # =================================================================
    # 3. Q ê°ì²´ë¥¼ í™œìš©í•œ ë³µì¡í•œ ì¡°ê±´ ì¿¼ë¦¬
    # =================================================================
    
    # Raw SQL: WHERE (jikwonpay > 4000 AND jikwonjik = 'ë¶€ì¥') OR jikwongen = 'ë‚¨'
    high_performers = Jikwon.objects.filter(
        Q(jikwonpay__gt=4000, jikwonjik='ë¶€ì¥') |     # AND ì¡°ê±´
        Q(jikwongen='ë‚¨')                            # OR ì¡°ê±´
    ).select_related('busernum')
    
    # =================================================================
    # 4. F ê°ì²´ë¥¼ í™œìš©í•œ í•„ë“œ ê°„ ì—°ì‚°
    # =================================================================
    
    # ê·¼ì†ë…„ìˆ˜ ê³„ì‚° (ë°ì´í„°ë² ì´ìŠ¤ ë ˆë²¨ì—ì„œ ê³„ì‚°)
    current_year = timezone.now().year
    jikwons_with_years = Jikwon.objects.annotate(
        ê·¼ì†ë…„ìˆ˜=current_year - F('jikwonibsail__year'),
        ì—°ë´‰ëŒ€ë¹„íš¨ìœ¨ì„±=F('jikwonpay') / (current_year - F('jikwonibsail__year') + 1)
    ).select_related('busernum')
    
    # =================================================================
    # 5. EXISTSì™€ ì„œë¸Œì¿¼ë¦¬ í™œìš©
    # =================================================================
    
    # ê³ ê°ì„ ë‹´ë‹¹í•˜ëŠ” ì§ì›ë§Œ ì¡°íšŒ
    # Raw SQL: SELECT * FROM jikwon WHERE EXISTS (SELECT 1 FROM gogek WHERE gogekdamsano = jikwonno)
    has_customers = Gogek.objects.filter(gogekdamsano=OuterRef('jikwonno'))
    jikwons_with_customers = Jikwon.objects.filter(
        Exists(has_customers)
    ).select_related('busernum')
    
    # =================================================================
    # 6. ì§ê¸‰ë³„ ë¶„ì„ - VALUES()ì™€ ANNOTATE() ì¡°í•©
    # =================================================================
    
    position_analysis = (
        Jikwon.objects
        .values('jikwonjik')                         # GROUP BY jikwonjik
        .annotate(
            ì¸ì›ìˆ˜=Count('jikwonno'),
            í‰ê· ì—°ë´‰=Avg('jikwonpay'),
            ì—°ë´‰í•©ê³„=Sum('jikwonpay'),
            í‰ê· ê·¼ì†ë…„ìˆ˜=Avg(current_year - F('jikwonibsail__year'))
        )
        .order_by('-í‰ê· ì—°ë´‰')
    )
    
    # =================================================================
    # 7. ì¡°ê±´ë¶€ ì§‘ê³„ - CASE WHEN í™œìš©
    # =================================================================
    
    gender_stats = Jikwon.objects.aggregate(
        ë‚¨ì„±ì§ì›ìˆ˜=Count(
            Case(When(jikwongen='ë‚¨', then=1), output_field=IntegerField())
        ),
        ì—¬ì„±ì§ì›ìˆ˜=Count(
            Case(When(jikwongen='ì—¬', then=1), output_field=IntegerField())
        ),
        ë‚¨ì„±í‰ê· ì—°ë´‰=Avg(
            Case(When(jikwongen='ë‚¨', then='jikwonpay'), output_field=IntegerField())
        ),
        ì—¬ì„±í‰ê· ì—°ë´‰=Avg(
            Case(When(jikwongen='ì—¬', then='jikwonpay'), output_field=IntegerField())
        ),
        ê³ ì—°ë´‰ì§ì›ìˆ˜=Count(
            Case(When(jikwonpay__gte=5000, then=1), output_field=IntegerField())
        )
    )
    
    # =================================================================
    # 8. ë°ì´í„° ì²˜ë¦¬ ë° DataFrame ë³€í™˜
    # =================================================================
    
    # ì§ì› ëª©ë¡ ë°ì´í„° ì¤€ë¹„
    jikwon_data = []
    for j in jikwons:
        jikwon_data.append({
            'ì§ì›ë²ˆí˜¸': j.jikwonno,
            'ì§ì›ëª…': j.jikwonname,
            'ë¶€ì„œëª…': j.busernum.busername if j.busernum else 'ë¯¸ë°°ì •',
            'ë¶€ì„œì „í™”': j.busernum.busertel if j.busernum else '',
            'ì§ê¸‰': j.jikwonjik or 'ë¯¸ì§€ì •',
            'ì—°ë´‰': j.jikwonpay or 0,
            'ì„±ë³„': j.jikwongen or 'ë¯¸ì§€ì •',
            'ì…ì‚¬ì¼': j.jikwonibsail.strftime('%Y-%m-%d') if j.jikwonibsail else ''
        })
    
    # DataFrameìœ¼ë¡œ ë³€í™˜ ë° HTML í…Œì´ë¸” ìƒì„±
    if jikwon_data:
        df_jikwon = pd.DataFrame(jikwon_data)
        join_html = df_jikwon.to_html(
            index=False,
            classes='table table-striped table-hover'
        )
    else:
        join_html = "<p class='text-center text-muted'>ì¡°ê±´ì— ë§ëŠ” ì§ì›ì´ ì—†ìŠµë‹ˆë‹¤.</p>"
    
    # ë¶€ì„œë³„ í†µê³„ ë°ì´í„° ì¤€ë¹„
    dept_data = []
    for dept_stat in dept_stats:
        dept_data.append({
            'ë¶€ì„œëª…': dept_stat.busername,
            'ì§ì›ìˆ˜': dept_stat.ì§ì›ìˆ˜,
            'ë‚¨ì„±': dept_stat.ë‚¨ì„±ì§ì›ìˆ˜,
            'ì—¬ì„±': dept_stat.ì—¬ì„±ì§ì›ìˆ˜,
            'í‰ê· ì—°ë´‰': round(dept_stat.í‰ê· ì—°ë´‰ or 0),
            'ì´ì—°ë´‰': dept_stat.ì´ì—°ë´‰ or 0,
            'ìµœê³ ì—°ë´‰': dept_stat.ìµœê³ ì—°ë´‰ or 0,
            'ìµœì €ì—°ë´‰': dept_stat.ìµœì €ì—°ë´‰ or 0
        })
    
    # ë¶€ì„œ í†µê³„ HTML ìƒì„±
    if dept_data:
        df_dept = pd.DataFrame(dept_data)
        dept_html = df_dept.to_html(
            index=False,
            classes='table table-info table-striped'
        )
    else:
        dept_html = "<p class='text-center text-muted'>ë¶€ì„œ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</p>"
    
    # ì§ê¸‰ë³„ ë¶„ì„ ë°ì´í„° ì¤€ë¹„
    position_data = []
    for pos in position_analysis:
        position_data.append({
            'ì§ê¸‰': pos['jikwonjik'] or 'ë¯¸ì§€ì •',
            'ì¸ì›ìˆ˜': pos['ì¸ì›ìˆ˜'],
            'í‰ê· ì—°ë´‰': round(pos['í‰ê· ì—°ë´‰'] or 0),
            'ì—°ë´‰í•©ê³„': pos['ì—°ë´‰í•©ê³„'] or 0,
            'í‰ê· ê·¼ì†ë…„ìˆ˜': round(pos['í‰ê· ê·¼ì†ë…„ìˆ˜'] or 0, 1)
        })
    
    # ì§ê¸‰ë³„ ë¶„ì„ HTML ìƒì„±
    if position_data:
        df_position = pd.DataFrame(position_data)
        position_html = df_position.to_html(
            index=False,
            classes='table table-success table-striped'
        )
    else:
        position_html = "<p class='text-center text-muted'>ì§ê¸‰ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</p>"
    
    # =================================================================
    # 9. ì¶”ê°€ ë¶„ì„ - ì„±ê³¼ ì§€í‘œ
    # =================================================================
    
    # ë¶€ì„œë³„ ì„±ê³¼ ë¶„ì„
    performance_analysis = (
        Buser.objects
        .annotate(
            í‰ê· ì—°ë´‰=Avg('jikwon__jikwonpay'),
            í‰ê· ê·¼ì†ë…„ìˆ˜=Avg(current_year - F('jikwon__jikwonibsail__year')),
            ì§ì›ìˆ˜=Count('jikwon')
        )
        .filter(ì§ì›ìˆ˜__gt=0)
        .annotate(
            íš¨ìœ¨ì„±ì ìˆ˜=F('í‰ê· ì—°ë´‰') / F('í‰ê· ê·¼ì†ë…„ìˆ˜')  # ì—°ë´‰ ëŒ€ë¹„ ê·¼ì†ë…„ìˆ˜ íš¨ìœ¨ì„±
        )
        .order_by('-íš¨ìœ¨ì„±ì ìˆ˜')
    )
    
    # í…œí”Œë¦¿ìœ¼ë¡œ ì „ë‹¬í•  ì»¨í…ìŠ¤íŠ¸
    context = {
        'join_html': join_html,
        'dept_html': dept_html,
        'position_html': position_html,
        'dept': safe_dept,
        'total_count': len(jikwon_data),
        'dept_count': len(dept_data),
        'gender_stats': gender_stats,
        'high_performers_count': high_performers.count(),
        'customers_staff_count': jikwons_with_customers.count(),
        'performance_analysis': performance_analysis[:5],  # ìƒìœ„ 5ê°œ ë¶€ì„œ
        
        # ì¶”ê°€ í†µê³„
        'avg_salary': round(gender_stats.get('ë‚¨ì„±í‰ê· ì—°ë´‰', 0) or 0),
        'total_departments': dept_stats.count(),
        'active_positions': position_analysis.count(),
    }
    
    return render(request, 'orm_analysis.html', context)

# =================================================================
# ORM ê¸°ë³¸ íŒ¨í„´ ì˜ˆì œ ëª¨ìŒ
# =================================================================

def ormBasicExamples(request):
    """ORM ê¸°ë³¸ ì‚¬ìš©ë²• ì˜ˆì œ ëª¨ìŒ"""
    
    examples = {
        'basic_queries': {
            'ì „ì²´_ì¡°íšŒ': Jikwon.objects.all(),
            'ì¡°ê±´_í•„í„°ë§': Jikwon.objects.filter(jikwonjik='ë¶€ì¥'),
            'ë‹¤ì¤‘_ì¡°ê±´': Jikwon.objects.filter(jikwonjik='ë¶€ì¥', jikwongen='ë‚¨'),
            'ì œì™¸_ì¡°ê±´': Jikwon.objects.exclude(jikwonpay__lt=3000),
            'ì •ë ¬': Jikwon.objects.order_by('-jikwonpay'),
        },
        
        'advanced_queries': {
            'Q_ê°ì²´_í™œìš©': Jikwon.objects.filter(
                Q(jikwonpay__gte=5000) | Q(jikwonjik='ëŒ€í‘œ')
            ),
            'F_ê°ì²´_í™œìš©': Jikwon.objects.filter(
                jikwonpay__gt=F('busernum__id') * 1000
            ),
            'ì„œë¸Œì¿¼ë¦¬': Jikwon.objects.filter(
                jikwonno__in=Gogek.objects.values('gogekdamsano')
            ),
        },
        
        'aggregation': {
            'ì§‘ê³„í•¨ìˆ˜': Jikwon.objects.aggregate(
                í‰ê· ì—°ë´‰=Avg('jikwonpay'),
                ìµœê³ ì—°ë´‰=Max('jikwonpay'),
                ì§ì›ìˆ˜=Count('jikwonno')
            ),
            'ê·¸ë£¹ë³„_ì§‘ê³„': Jikwon.objects.values('jikwonjik').annotate(
                ì¸ì›ìˆ˜=Count('jikwonno'),
                í‰ê· ì—°ë´‰=Avg('jikwonpay')
            ),
        }
    }
    
    return render(request, 'orm_examples.html', {'examples': examples})
```

---

## ORM ì „ìš© í…œí”Œë¦¿ êµ¬ì„±

### ğŸ¨ ê³ ê¸‰ ORM ë¶„ì„ í…œí”Œë¦¿

```html
<!-- templates/orm_analysis.html -->
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Django ORM ê³ ê¸‰ ë¶„ì„ - ì§ì› ì •ë³´ ì‹œìŠ¤í…œ</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.2/font/bootstrap-icons.css" rel="stylesheet">
    <style>
        .orm-badge { 
            background: linear-gradient(45deg, #28a745, #20c997);
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 0.9em;
        }
        .method-tag {
            background-color: #f8f9fa;
            border: 1px solid #dee2e6;
            padding: 3px 8px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-size: 0.8em;
            color: #495057;
            margin: 2px;
            display: inline-block;
        }
        .sql-comparison {
            background-color: #f8f9fa;
            border-left: 4px solid #007bff;
            padding: 10px;
            margin: 10px 0;
        }
        .performance-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 5px;
        }
        .good { background-color: #28a745; }
        .warning { background-color: #ffc107; }
        .danger { background-color: #dc3545; }
    </style>
</head>
<body>
    <div class="container-fluid mt-4">
        <!-- í—¤ë” -->
        <div class="row mb-4">
            <div class="col-12">
                <h1 class="text-center mb-3">
                    <i class="bi bi-database-gear"></i> Django ORM ê³ ê¸‰ ë¶„ì„ ì‹œìŠ¤í…œ
                </h1>
                <div class="text-center mb-3">
                    <span class="orm-badge">
                        <i class="bi bi-shield-check"></i> Django ORM ë³´ì•ˆ + ì„±ëŠ¥ ìµœì í™”
                    </span>
                </div>
                <p class="text-center text-muted">
                    SQL ì¸ì ì…˜ ìë™ ë°©ì§€ â€¢ N+1 ë¬¸ì œ í•´ê²° â€¢ íƒ€ì… ì•ˆì „ì„± ë³´ì¥
                </p>
            </div>
        </div>

        <!-- ì„±ëŠ¥ ì§€í‘œ ëŒ€ì‹œë³´ë“œ -->
        <div class="row mb-4">
            <div class="col-md-3">
                <div class="card border-primary h-100">
                    <div class="card-body text-center">
                        <i class="bi bi-people-fill text-primary fs-1"></i>
                        <h5 class="card-title text-primary mt-2">ì´ ì§ì›</h5>
                        <h3 class="text-primary">{{ total_count }}ëª…</h3>
                        <small class="text-muted">
                            <span class="method-tag">count()</span>
                        </small>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card border-info h-100">
                    <div class="card-body text-center">
                        <i class="bi bi-building text-info fs-1"></i>
                        <h5 class="card-title text-info mt-2">í™œì„± ë¶€ì„œ</h5>
                        <h3 class="text-info">{{ total_departments }}ê°œ</h3>
                        <small class="text-muted">
                            <span class="method-tag">annotate()</span>
                        </small>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card border-success h-100">
                    <div class="card-body text-center">
                        <i class="bi bi-person-check text-success fs-1"></i>
                        <h5 class="card-title text-success mt-2">ê³ ê° ë‹´ë‹¹</h5>
                        <h3 class="text-success">{{ customers_staff_count }}ëª…</h3>
                        <small class="text-muted">
                            <span class="method-tag">Exists()</span>
                        </small>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card border-warning h-100">
                    <div class="card-body text-center">
                        <i class="bi bi-star-fill text-warning fs-1"></i>
                        <h5 class="card-title text-warning mt-2">ê³ ì„±ê³¼ì</h5>
                        <h3 class="text-warning">{{ high_performers_count }}ëª…</h3>
                        <small class="text-muted">
                            <span class="method-tag">Q()</span> ê°ì²´
                        </small>
                    </div>
                </div>
            </div>
        </div>

        <!-- ê²€ìƒ‰ í¼ -->
        <div class="card mb-4">
            <div class="card-header bg-primary text-white">
                <h5 class="mb-0">
                    <i class="bi bi-search"></i> ìŠ¤ë§ˆíŠ¸ ê²€ìƒ‰ (ORM í•„í„°ë§)
                </h5>
            </div>
            <div class="card-body">
                <form method="GET" class="row g-3">
                    <div class="col-md-10">
                        <input type="text" 
                               class="form-control" 
                               name="dept" 
                               value="{{ dept }}" 
                               placeholder="ë¶€ì„œëª… ì…ë ¥ (ì˜ˆ: ì´ë¬´ë¶€, ì˜ì—…ë¶€) - ëŒ€ì†Œë¬¸ì ë¬´ì‹œ ë¶€ë¶„ ê²€ìƒ‰">
                    </div>
                    <div class="col-md-2">
                        <button type="submit" class="btn btn-primary w-100">
                            <i class="bi bi-search"></i> ê²€ìƒ‰
                        </button>
                    </div>
                </form>
                <div class="sql-comparison mt-3">
                    <strong>ORM ì¿¼ë¦¬:</strong>
                    <code>filter(busernum__busername__icontains=dept)</code><br>
                    <strong>Raw SQL ë™ë“±:</strong>
                    <code>WHERE busername LIKE '%dept%'</code>
                    <span class="performance-indicator good"></span> SQL ì¸ì ì…˜ ìë™ ë°©ì§€
                </div>
            </div>
        </div>

        <!-- ì„±ë³„ í†µê³„ -->
        <div class="card mb-4">
            <div class="card-header bg-info text-white">
                <h5 class="mb-0">
                    <i class="bi bi-gender-ambiguous"></i> ì„±ë³„ í†µê³„ (Case/When í™œìš©)
                </h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-4">
                        <h6><i class="bi bi-person-fill text-primary"></i> ë‚¨ì„± ì§ì›</h6>
                        <p>ì¸ì›: <strong>{{ gender_stats.ë‚¨ì„±ì§ì›ìˆ˜ }}ëª…</strong></p>
                        <p>í‰ê· ì—°ë´‰: <strong>{{ gender_stats.ë‚¨ì„±í‰ê· ì—°ë´‰|floatformat:0 }}ë§Œì›</strong></p>
                    </div>
                    <div class="col-md-4">
                        <h6><i class="bi bi-person-fill text-danger"></i> ì—¬ì„± ì§ì›</h6>
                        <p>ì¸ì›: <strong>{{ gender_stats.ì—¬ì„±ì§ì›ìˆ˜ }}ëª…</strong></p>
                        <p>í‰ê· ì—°ë´‰: <strong>{{ gender_stats.ì—¬ì„±í‰ê· ì—°ë´‰|floatformat:0 }}ë§Œì›</strong></p>
                    </div>
                    <div class="col-md-4">
                        <h6><i class="bi bi-trophy text-warning"></i> ê³ ì—°ë´‰ì</h6>
                        <p>5000ë§Œì› ì´ìƒ: <strong>{{ gender_stats.ê³ ì—°ë´‰ì§ì›ìˆ˜ }}ëª…</strong></p>
                    </div>
                </div>
                <div class="sql-comparison">
                    <strong>ì‚¬ìš©ëœ ORM ë©”ì„œë“œ:</strong>
                    <span class="method-tag">aggregate()</span>
                    <span class="method-tag">Case</span>
                    <span class="method-tag">When</span>
                    <span class="method-tag">Count</span>
                    <span class="method-tag">Avg</span>
                </div>
            </div>
        </div>

        <!-- ì§ì› ëª©ë¡ -->
        <div class="card mb-4">
            <div class="card-header bg-success text-white">
                <h5 class="mb-0">
                    <i class="bi bi-table"></i> ì§ì› ëª©ë¡ (JOIN ìµœì í™”)
                </h5>
            </div>
            <div class="card-body">
                {% if total_count > 0 %}
                    <div class="table-responsive">
                        {{ join_html|safe }}
                    </div>
                    <div class="sql-comparison">
                        <strong>ORM ìµœì í™”:</strong>
                        <code>select_related('busernum')</code> - N+1 ë¬¸ì œ í•´ê²°<br>
                        <span class="performance-indicator good"></span> ë‹¨ì¼ ì¿¼ë¦¬ë¡œ JOIN ì²˜ë¦¬
                        <span class="performance-indicator good"></span> ë©”ëª¨ë¦¬ íš¨ìœ¨ì  ë¡œë”©
                    </div>
                {% else %}
                    <div class="alert alert-warning text-center">
                        <i class="bi bi-exclamation-triangle"></i>
                        <strong>ê²€ìƒ‰ ê²°ê³¼ ì—†ìŒ</strong><br>
                        ë‹¤ë¥¸ ê²€ìƒ‰ ì¡°ê±´ì„ ì‹œë„í•´ë³´ì„¸ìš”.
                    </div>
                {% endif %}
            </div>
        </div>

        <!-- ë¶€ì„œë³„ ìƒì„¸ í†µê³„ -->
        <div class="card mb-4">
            <div class="card-header bg-warning text-dark">
                <h5 class="mb-0">
                    <i class="bi bi-building"></i> ë¶€ì„œë³„ ìƒì„¸ í†µê³„
                </h5>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    {{ dept_html|safe }}
                </div>
                <div class="sql-comparison">
                    <strong>ë³µì¡í•œ ì§‘ê³„ ì¿¼ë¦¬:</strong>
                    <span class="method-tag">annotate()</span>
                    <span class="method-tag">Count</span>
                    <span class="method-tag">Avg</span>
                    <span class="method-tag">Sum</span>
                    <span class="method-tag">Max</span>
                    <span class="method-tag">Min</span><br>
                    <span class="performance-indicator good"></span> ë‹¨ì¼ ì¿¼ë¦¬ë¡œ ëª¨ë“  ì§‘ê³„ ì²˜ë¦¬
                </div>
            </div>
        </div>

        <!-- ì§ê¸‰ë³„ ë¶„ì„ -->
        <div class="card mb-4">
            <div class="card-header bg-danger text-white">
                <h5 class="mb-0">
                    <i class="bi bi-diagram-3"></i> ì§ê¸‰ë³„ ë¶„ì„ (GROUP BY)
                </h5>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    {{ position_html|safe }}
                </div>
                <div class="sql-comparison">
                    <strong>ê·¸ë£¹ë³„ ì§‘ê³„:</strong>
                    <code>values('jikwonjik').annotate(...)</code><br>
                    <span class="performance-indicator good"></span> íš¨ìœ¨ì ì¸ GROUP BY êµ¬í˜„
                </div>
            </div>
        </div>

        <!-- ë¶€ì„œ ì„±ê³¼ ìˆœìœ„ -->
        <div class="card mb-4">
            <div class="card-header bg-dark text-white">
                <h5 class="mb-0">
                    <i class="bi bi-trophy"></i> ë¶€ì„œ ì„±ê³¼ ìˆœìœ„ (F ê°ì²´ í™œìš©)
                </h5>
            </div>
            <div class="card-body">
                <div class="row">
                    {% for dept in performance_analysis %}
                    <div class="col-md-4 mb-3">
                        <div class="card border-primary">
                            <div class="card-body text-center">
                                <h6 class="card-title">{{ dept.busername }}</h6>
                                <p class="mb-1">ì§ì›ìˆ˜: {{ dept.ì§ì›ìˆ˜ }}ëª…</p>
                                <p class="mb-1">í‰ê· ì—°ë´‰: {{ dept.í‰ê· ì—°ë´‰|floatformat:0 }}ë§Œì›</p>
                                <p class="mb-0">íš¨ìœ¨ì„±: {{ dept.íš¨ìœ¨ì„±ì ìˆ˜|floatformat:1 }}</p>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
                <div class="sql-comparison">
                    <strong>F ê°ì²´ ì—°ì‚°:</strong>
                    <code>F('í‰ê· ì—°ë´‰') / F('í‰ê· ê·¼ì†ë…„ìˆ˜')</code><br>
                    <span class="performance-indicator good"></span> ë°ì´í„°ë² ì´ìŠ¤ ë ˆë²¨ ê³„ì‚°
                </div>
            </div>
        </div>

        <!-- ORM vs Raw SQL ë¹„êµ -->
        <div class="card mb-4">
            <div class="card-header bg-secondary text-white">
                <h5 class="mb-0">
                    <i class="bi bi-code-square"></i> ORM vs Raw SQL ì„±ëŠ¥ ë¹„êµ
                </h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6">
                        <h6><i class="bi bi-check-circle text-success"></i> ORM ì¥ì </h6>
                        <ul class="list-group list-group-flush">
                            <li class="list-group-item">
                                <span class="performance-indicator good"></span>
                                SQL ì¸ì ì…˜ ìë™ ë°©ì§€
                            </li>
                            <li class="list-group-item">
                                <span class="performance-indicator good"></span>
                                íƒ€ì… ì•ˆì „ì„± ë³´ì¥
                            </li>
                            <li class="list-group-item">
                                <span class="performance-indicator good"></span>
                                ë°ì´í„°ë² ì´ìŠ¤ ë…ë¦½ì„±
                            </li>
                            <li class="list-group-item">
                                <span class="performance-indicator good"></span>
                                ê°ì²´ì§€í–¥ì  ì ‘ê·¼
                            </li>
                            <li class="list-group-item">
                                <span class="performance-indicator good"></span>
                                IntelliSense ì§€ì›
                            </li>
                        </ul>
                    </div>
                    <div class="col-md-6">
                        <h6><i class="bi bi-exclamation-triangle text-warning"></i> ORM í•œê³„</h6>
                        <ul class="list-group list-group-flush">
                            <li class="list-group-item">
                                <span class="performance-indicator warning"></span>
                                ë³µì¡í•œ ì¿¼ë¦¬ í‘œí˜„ ì œí•œ
                            </li>
                            <li class="list-group-item">
                                <span class="performance-indicator warning"></span>
                                ì„±ëŠ¥ íŠœë‹ ì–´ë ¤ì›€
                            </li>
                            <li class="list-group-item">
                                <span class="performance-indicator warning"></span>
                                ëŸ¬ë‹ ì»¤ë¸Œ ì¡´ì¬
                            </li>
                            <li class="list-group-item">
                                <span class="performance-indicator danger"></span>
                                ëŒ€ìš©ëŸ‰ ë°ì´í„° ì²˜ë¦¬ í•œê³„
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>

        <!-- ì‚¬ìš©ëœ ORM ê¸°ë²• ìš”ì•½ -->
        <div class="card mb-4">
            <div class="card-header bg-info text-white">
                <h5 class="mb-0">
                    <i class="bi bi-list-check"></i> ì´ í˜ì´ì§€ì—ì„œ ì‚¬ìš©ëœ ORM ê¸°ë²•ë“¤
                </h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-3">
                        <h6>ê¸°ë³¸ ì¡°íšŒ</h6>
                        <span class="method-tag">objects.all()</span>
                        <span class="method-tag">filter()</span>
                        <span class="method-tag">exclude()</span>
                        <span class="method-tag">order_by()</span>
                        <span class="method-tag">count()</span>
                    </div>
                    <div class="col-md-3">
                        <h6>ê´€ê³„ & ì„±ëŠ¥</h6>
                        <span class="method-tag">select_related()</span>
                        <span class="method-tag">prefetch_related()</span>
                        <span class="method-tag">Exists()</span>
                        <span class="method-tag">OuterRef()</span>
                    </div>
                    <div class="col-md-3">
                        <h6>ì§‘ê³„ & ê·¸ë£¹</h6>
                        <span class="method-tag">aggregate()</span>
                        <span class="method-tag">annotate()</span>
                        <span class="method-tag">values()</span>
                        <span class="method-tag">Count/Avg/Sum</span>
                    </div>
                    <div class="col-md-3">
                        <h6>ê³ ê¸‰ ê¸°ë²•</h6>
                        <span class="method-tag">Q()</span>
                        <span class="method-tag">F()</span>
                        <span class="method-tag">Case/When</span>
                        <span class="method-tag">__icontains</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- ë„¤ë¹„ê²Œì´ì…˜ -->
        <div class="text-center mb-4">
            <div class="btn-group" role="group">
                <a href="/dbshow/" class="btn btn-outline-primary">
                    <i class="bi bi-code-slash"></i> Raw SQL ë²„ì „
                </a>
                <a href="/orm-examples/" class="btn btn-info">
                    <i class="bi bi-book"></i> ORM ê¸°ë³¸ ì˜ˆì œ
                </a>
                <a href="/advanced-analysis/" class="btn btn-warning">
                    <i class="bi bi-graph-up"></i> ê³ ê¸‰ ë¶„ì„
                </a>
                <a href="/" class="btn btn-primary">
                    <i class="bi bi-house"></i> ë©”ì¸ìœ¼ë¡œ
                </a>
            </div>
        </div>

        <!-- ê°•ì‚¬ë‹˜ ì¡°ì–¸ -->
        <div class="alert alert-info border-left-primary">
            <div class="row align-items-center">
                <div class="col-auto">
                    <i class="bi bi-lightbulb text-primary fs-1"></i>
                </div>
                <div class="col">
                    <h6 class="alert-heading">ğŸ’¡ ê°•ì‚¬ë‹˜ì˜ ì‹¤ë¬´ ì¡°ì–¸</h6>
                    <p class="mb-2">
                        <em>"ì¥ê³  ORMì„ ì¨ë„ ë˜ê³  ê·¸ëƒ¥ Raw SQL ë¬¸ì¥ì„ ì¨ë„ ê´œì°®ì•„ìš”. í¸í•œ ê±¸ë¡œ í•˜ì‹œë©´ ë©ë‹ˆë‹¤."</em>
                    </p>
                    <hr>
                    <p class="mb-0">
                        <strong>ì‹¤ë¬´ ê¶Œì¥:</strong> ê¸°ë³¸ì ìœ¼ë¡œ ORM ì‚¬ìš©, ë³µì¡í•œ ë¶„ì„ì´ë‚˜ ì„±ëŠ¥ì´ ì¤‘ìš”í•œ ê²½ìš° Raw SQL í˜¼ìš©
                    </p>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
```

---

## ëª¨ë¸ ì„¤ì • ë° ê´€ê³„ ì •ì˜

### ğŸ”§ ëª¨ë¸ ìµœì í™” ì„¤ì •

```python
# myapp/models.py - ORM ìµœì í™” ë²„ì „

from django.db import models
from django.core.validators import MinValueValidator, MaxValueValidator

class Buser(models.Model):
    """ë¶€ì„œ ëª¨ë¸"""
    buserno = models.IntegerField(
        primary_key=True,
        verbose_name="ë¶€ì„œë²ˆí˜¸"
    )
    busername = models.CharField(
        max_length=10,
        verbose_name="ë¶€ì„œëª…",
        help_text="ë¶€ì„œì˜ ì •ì‹ ëª…ì¹­"
    )
    buserloc = models.CharField(
        max_length=10, 
        blank=True, 
        null=True,
        verbose_name="ë¶€ì„œìœ„ì¹˜"
    )
    busertel = models.CharField(
        max_length=15, 
        blank=True, 
        null=True,
        verbose_name="ë¶€ì„œì „í™”ë²ˆí˜¸"
    )

    class Meta:
        managed = True  # Djangoê°€ í…Œì´ë¸” ê´€ë¦¬
        db_table = 'buser'
        verbose_name = "ë¶€ì„œ"
        verbose_name_plural = "ë¶€ì„œë“¤"
        ordering = ['buserno']  # ê¸°ë³¸ ì •ë ¬
        
    def __str__(self):
        return f"{self.busername} ({self.buserno})"
    
    @property
    def employee_count(self):
        """ë¶€ì„œ ì§ì› ìˆ˜ (Python í”„ë¡œí¼í‹°)"""
        return self.jikwon_set.count()
    
    def get_average_salary(self):
        """ë¶€ì„œ í‰ê·  ì—°ë´‰"""
        from django.db.models import Avg
        return self.jikwon_set.aggregate(
            avg_salary=Avg('jikwonpay')
        )['avg_salary'] or 0

class Jikwon(models.Model):
    """ì§ì› ëª¨ë¸"""
    
    # ì„±ë³„ ì„ íƒì§€
    GENDER_CHOICES = [
        ('ë‚¨', 'ë‚¨ì„±'),
        ('ì—¬', 'ì—¬ì„±'),
    ]
    
    # ì§ê¸‰ ì„ íƒì§€  
    POSITION_CHOICES = [
        ('ì‚¬ì›', 'ì‚¬ì›'),
        ('ëŒ€ë¦¬', 'ëŒ€ë¦¬'),
        ('ê³¼ì¥', 'ê³¼ì¥'),
        ('ì°¨ì¥', 'ì°¨ì¥'),
        ('ë¶€ì¥', 'ë¶€ì¥'),
        ('ëŒ€í‘œ', 'ëŒ€í‘œ'),
    ]
    
    jikwonno = models.IntegerField(
        primary_key=True,
        verbose_name="ì§ì›ë²ˆí˜¸"
    )
    jikwonname = models.CharField(
        max_length=10,
        verbose_name="ì§ì›ëª…"
    )
    # ForeignKeyë¡œ ê´€ê³„ ì„¤ì •
    busernum = models.ForeignKey(
        Buser,
        on_delete=models.PROTECT,  # ë¶€ì„œ ì‚­ì œ ë°©ì§€
        db_column='busernum',
        related_name='jikwon_set',  # ì—­ì°¸ì¡° ì´ë¦„
        verbose_name="ì†Œì†ë¶€ì„œ"
    )
    jikwonjik = models.CharField(
        max_length=10,
        choices=POSITION_CHOICES,
        blank=True,
        null=True,
        verbose_name="ì§ê¸‰"
    )
    jikwonpay = models.IntegerField(
        blank=True,
        null=True,
        validators=[MinValueValidator(1000), MaxValueValidator(20000)],
        verbose_name="ì—°ë´‰(ë§Œì›)"
    )
    jikwonibsail = models.DateField(
        blank=True,
        null=True,
        verbose_name="ì…ì‚¬ì¼"
    )
    jikwongen = models.CharField(
        max_length=4,
        choices=GENDER_CHOICES,
        blank=True,
        null=True,
        verbose_name="ì„±ë³„"
    )
    jikwonrating = models.CharField(
        max_length=3,
        blank=True,
        null=True,
        verbose_name="í‰ê°€ë“±ê¸‰"
    )

    class Meta:
        managed = True
        db_table = 'jikwon'
        verbose_name = "ì§ì›"
        verbose_name_plural = "ì§ì›ë“¤"
        ordering = ['jikwonno']
        # ë³µí•© ì¸ë±ìŠ¤ ì¶”ê°€
        indexes = [
            models.Index(fields=['busernum', 'jikwonjik']),
            models.Index(fields=['jikwonpay']),
            models.Index(fields=['jikwonibsail']),
        ]
        
    def __str__(self):
        return f"{self.jikwonname} ({self.jikwonjik or 'ë¯¸ì§€ì •'})"
    
    @property
    def years_of_service(self):
        """ê·¼ì†ë…„ìˆ˜ ê³„ì‚°"""
        if not self.jikwonibsail:
            return 0
        from datetime import date
        today = date.today()
        return today.year - self.jikwonibsail.year
    
    @property
    def customer_count(self):
        """ë‹´ë‹¹ ê³ ê° ìˆ˜"""
        return self.gogek_customers.count()
    
    def is_high_performer(self):
        """ê³ ì„±ê³¼ì ì—¬ë¶€ (ì—°ë´‰ 4000ë§Œì› ì´ìƒ ë˜ëŠ” ë¶€ì¥ê¸‰ ì´ìƒ)"""
        return (self.jikwonpay and self.jikwonpay >= 4000) or \
               self.jikwonjik in ['ë¶€ì¥', 'ëŒ€í‘œ']

class Gogek(models.Model):
    """ê³ ê° ëª¨ë¸"""
    gogekno = models.IntegerField(
        primary_key=True,
        verbose_name="ê³ ê°ë²ˆí˜¸"
    )
    gogekname = models.CharField(
        max_length=10,
        verbose_name="ê³ ê°ëª…"
    )
    gogektel = models.CharField(
        max_length=20,
        blank=True,
        null=True,
        verbose_name="ê³ ê°ì „í™”ë²ˆí˜¸"
    )
    gogekjumin = models.CharField(
        max_length=14,
        blank=True,
        null=True,
        verbose_name="ì£¼ë¯¼ë²ˆí˜¸"
    )
    # ë‹´ë‹¹ì ê´€ê³„ ì„¤ì •
    gogekdamsano = models.ForeignKey(
        Jikwon,
        on_delete=models.SET_NULL,  # ë‹´ë‹¹ì ì‚­ì œ ì‹œ NULL ì²˜ë¦¬
        db_column='gogekdamsano',
        blank=True,
        null=True,
        related_name='gogek_customers',
        verbose_name="ë‹´ë‹¹ì§ì›"
    )

    class Meta:
        managed = True
        db_table = 'gogek'
        verbose_name = "ê³ ê°"
        verbose_name_plural = "ê³ ê°ë“¤"
        ordering = ['gogekno']
        
    def __str__(self):
        ë‹´ë‹¹ì = self.gogekdamsano.jikwonname if self.gogekdamsano else 'ë¯¸ë°°ì •'
        return f"{self.gogekname} (ë‹´ë‹¹: {ë‹´ë‹¹ì})"

class Board(models.Model):
    """ê²Œì‹œíŒ ëª¨ë¸"""
    num = models.IntegerField(
        primary_key=True,
        verbose_name="ê²Œì‹œê¸€ë²ˆí˜¸"
    )
    author = models.CharField(
        max_length=10,
        blank=True,
        null=True,
        verbose_name="ì‘ì„±ì"
    )
    title = models.CharField(
        max_length=50,
        blank=True,
        null=True,
        verbose_name="ì œëª©"
    )
    content = models.TextField(  # CharFieldì—ì„œ TextFieldë¡œ ë³€ê²½
        blank=True,
        null=True,
        verbose_name="ë‚´ìš©"
    )
    bwrite = models.DateTimeField(  # DateFieldì—ì„œ DateTimeFieldë¡œ ë³€ê²½
        auto_now_add=True,
        verbose_name="ì‘ì„±ì¼ì‹œ"
    )
    readcnt = models.PositiveIntegerField(  # IntegerFieldì—ì„œ PositiveIntegerFieldë¡œ
        default=0,
        verbose_name="ì¡°íšŒìˆ˜"
    )

    class Meta:
        managed = True
        db_table = 'board'
        verbose_name = "ê²Œì‹œê¸€"
        verbose_name_plural = "ê²Œì‹œê¸€ë“¤"
        ordering = ['-bwrite']  # ìµœì‹ ìˆœ ì •ë ¬
        
    def __str__(self):
        return f"{self.title} - {self.author}"

class Sangdata(models.Model):
    """ìƒí’ˆ ë°ì´í„° ëª¨ë¸"""
    code = models.IntegerField(
        primary_key=True,
        verbose_name="ìƒí’ˆì½”ë“œ"
    )
    sang = models.CharField(
        max_length=20,
        blank=True,
        null=True,
        verbose_name="ìƒí’ˆëª…"
    )
    su = models.PositiveIntegerField(
        blank=True,
        null=True,
        verbose_name="ìˆ˜ëŸ‰"
    )
    dan = models.PositiveIntegerField(
        blank=True,
        null=True,
        verbose_name="ë‹¨ê°€"
    )

    class Meta:
        managed = True
        db_table = 'sangdata'
        verbose_name = "ìƒí’ˆ"
        verbose_name_plural = "ìƒí’ˆë“¤"
        ordering = ['code']
        
    def __str__(self):
        return f"{self.sang} ({self.code})"
    
    @property
    def total_price(self):
        """ì´ ê¸ˆì•¡ ê³„ì‚°"""
        if self.su and self.dan:
            return self.su * self.dan
        return 0
```

---

## ì„±ëŠ¥ ìµœì í™” ê¸°ë²•

### âš¡ N+1 ë¬¸ì œ í•´ê²°

#### 1. SELECT_RELATED (1:1, N:1 ê´€ê³„)
```python
# âŒ N+1 ë¬¸ì œ ë°œìƒ
jikwons = Jikwon.objects.all()
for jikwon in jikwons:
    print(jikwon.busernum.busername)  # ê°ê°ì— ëŒ€í•´ ë³„ë„ ì¿¼ë¦¬ ì‹¤í–‰

# âœ… SELECT_RELATEDë¡œ í•´ê²°
jikwons = Jikwon.objects.select_related('busernum').all()
for jikwon in jikwons:
    print(jikwon.busernum.busername)  # ë‹¨ì¼ JOIN ì¿¼ë¦¬ë¡œ í•´ê²°
```

#### 2. PREFETCH_RELATED (1:N, M:N ê´€ê³„)
```python
# âŒ N+1 ë¬¸ì œ ë°œìƒ
departments = Buser.objects.all()
for dept in departments:
    print(dept.jikwon_set.count())  # ê° ë¶€ì„œë§ˆë‹¤ ë³„ë„ ì¿¼ë¦¬

# âœ… PREFETCH_RELATEDë¡œ í•´ê²°
departments = Buser.objects.prefetch_related('jikwon_set').all()
for dept in departments:
    print(dept.jikwon_set.count())  # ë¯¸ë¦¬ ë¡œë“œëœ ë°ì´í„° ì‚¬ìš©
```

### ğŸ¯ ì¿¼ë¦¬ ìµœì í™” íŒ¨í„´

#### 1. ONLY/DEFER - í•„ìš”í•œ í•„ë“œë§Œ ì¡°íšŒ
```python
# í•„ìš”í•œ í•„ë“œë§Œ ì¡°íšŒ
jikwons = Jikwon.objects.only('jikwonname', 'jikwonpay')

# íŠ¹ì • í•„ë“œ ì œì™¸
jikwons = Jikwon.objects.defer('content', 'large_field')
```

#### 2. VALUES/VALUES_LIST - ë”•ì…”ë„ˆë¦¬/íŠœí”Œë¡œ ì¡°íšŒ
```python
# ë”•ì…”ë„ˆë¦¬ í˜•íƒœë¡œ ì¡°íšŒ
results = Jikwon.objects.values('jikwonname', 'jikwonpay')

# íŠœí”Œ í˜•íƒœë¡œ ì¡°íšŒ
results = Jikwon.objects.values_list('jikwonname', 'jikwonpay')

# í”Œë« ë¦¬ìŠ¤íŠ¸ë¡œ ì¡°íšŒ
names = Jikwon.objects.values_list('jikwonname', flat=True)
```

#### 3. BULK ì—°ì‚° - ëŒ€ëŸ‰ ë°ì´í„° ì²˜ë¦¬
```python
# ëŒ€ëŸ‰ ìƒì„±
jikwons = [
    Jikwon(jikwonname=f'ì§ì›{i}', jikwonpay=3000)
    for i in range(1000)
]
Jikwon.objects.bulk_create(jikwons, batch_size=100)

# ëŒ€ëŸ‰ ì—…ë°ì´íŠ¸
Jikwon.objects.filter(jikwonjik='ì‚¬ì›').update(jikwonpay=3500)

# ëŒ€ëŸ‰ ì‚­ì œ
Jikwon.objects.filter(jikwonpay__lt=2000).delete()
```

### ğŸ“Š ì¿¼ë¦¬ ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§

```python
from django.db import connection
from django.conf import settings

def monitor_queries(func):
    """ì¿¼ë¦¬ ëª¨ë‹ˆí„°ë§ ë°ì½”ë ˆì´í„°"""
    def wrapper(*args, **kwargs):
        queries_before = len(connection.queries)
        result = func(*args, **kwargs)
        queries_after = len(connection.queries)
        
        if settings.DEBUG:
            print(f"í•¨ìˆ˜ {func.__name__}: {queries_after - queries_before}ê°œ ì¿¼ë¦¬ ì‹¤í–‰")
            for query in connection.queries[queries_before:]:
                print(f"  {query['time']}s: {query['sql']}")
        
        return result
    return wrapper

@monitor_queries
def expensive_operation():
    """ë¹„ìš©ì´ ë§ì´ ë“œëŠ” ì‘ì—…"""
    return list(Jikwon.objects.select_related('busernum').all())
```

---

## ì‹¤ë¬´ í™œìš© íŒ¨í„´

### ğŸš€ ê³ ê¸‰ ORM íŒ¨í„´

#### 1. ë™ì  í•„í„°ë§
```python
def dynamic_filter_view(request):
    """ë™ì  í•„í„°ë§ êµ¬í˜„"""
    queryset = Jikwon.objects.select_related('busernum')
    
    # ì¡°ê±´ë¶€ í•„í„° ì ìš©
    if request.GET.get('department'):
        queryset = queryset.filter(
            busernum__busername__icontains=request.GET['department']
        )
    
    if request.GET.get('position'):
        queryset = queryset.filter(jikwonjik=request.GET['position'])
    
    if request.GET.get('min_salary'):
        queryset = queryset.filter(
            jikwonpay__gte=int(request.GET['min_salary'])
        )
    
    # ì •ë ¬ ì¡°ê±´
    sort_by = request.GET.get('sort', 'jikwonno')
    if sort_by in ['jikwonno', 'jikwonname', 'jikwonpay']:
        queryset = queryset.order_by(sort_by)
    
    return queryset
```

#### 2. ë³µì¡í•œ ì§‘ê³„ ì¿¼ë¦¬
```python
def complex_aggregation():
    """ë³µì¡í•œ ì§‘ê³„ ë¶„ì„"""
    from django.db.models import Case, When, Count, Avg, Q, F
    
    # ë¶€ì„œë³„, ì§ê¸‰ë³„, ì„±ë³„ êµì°¨ ë¶„ì„
    analysis = (
        Jikwon.objects
        .values('busernum__busername', 'jikwonjik', 'jikwongen')
        .annotate(
            ì¸ì›ìˆ˜=Count('jikwonno'),
            í‰ê· ì—°ë´‰=Avg('jikwonpay'),
            # ì¡°ê±´ë¶€ ì§‘ê³„
            ì‹ ì…ì‚¬ì›ìˆ˜=Count(
                Case(
                    When(
                        Q(jikwonibsail__year__gte=2020) & Q(jikwonjik='ì‚¬ì›'),
                        then=1
                    ),
                    output_field=IntegerField()
                )
            ),
            # ë¹„ìœ¨ ê³„ì‚°
            ê³ ì—°ë´‰ë¹„ìœ¨=Count(
                Case(When(jikwonpay__gte=5000, then=1), output_field=IntegerField())
            ) * 100.0 / Count('jikwonno')
        )
        .filter(ì¸ì›ìˆ˜__gt=0)
        .order_by('busernum__busername', 'jikwonjik')
    )
    
    return analysis
```

#### 3. ì„œë¸Œì¿¼ë¦¬ì™€ ìœˆë„ìš° í•¨ìˆ˜
```python
def advanced_subquery():
    """ê³ ê¸‰ ì„œë¸Œì¿¼ë¦¬ í™œìš©"""
    from django.db.models import Subquery, OuterRef, Window, F, Rank
    
    # ê° ë¶€ì„œë³„ ìµœê³  ì—°ë´‰ì ì¡°íšŒ
    highest_paid_per_dept = (
        Jikwon.objects
        .filter(busernum=OuterRef('busernum'))
        .order_by('-jikwonpay')
        .values('jikwonpay')[:1]
    )
    
    result = Jikwon.objects.annotate(
        dept_max_salary=Subquery(highest_paid_per_dept),
        is_highest_paid=Case(
            When(jikwonpay=F('dept_max_salary'), then=True),
            default=False,
            output_field=models.BooleanField()
        )
    ).filter(is_highest_paid=True)
    
    return result
```

### ğŸ”§ ì‹¤ë¬´ íŒê³¼ ì£¼ì˜ì‚¬í•­

#### 1. íŠ¸ëœì­ì…˜ ê´€ë¦¬
```python
from django.db import transaction

@transaction.atomic
def safe_bulk_operation():
    """ì•ˆì „í•œ ëŒ€ëŸ‰ ì‘ì—…"""
    try:
        # ì—¬ëŸ¬ ì‘ì—…ì„ í•˜ë‚˜ì˜ íŠ¸ëœì­ì…˜ìœ¼ë¡œ
        Jikwon.objects.filter(jikwonjik='ì‚¬ì›').update(jikwonpay=F('jikwonpay') + 500)
        
        # ê´€ë ¨ ë°ì´í„° ì—…ë°ì´íŠ¸
        for dept in Buser.objects.all():
            dept.last_updated = timezone.now()
            dept.save()
            
    except Exception as e:
        # ë¡¤ë°± ìë™ ì‹¤í–‰
        raise e

# ì„¸ì´ë¸Œí¬ì¸íŠ¸ ì‚¬ìš©
@transaction.atomic
def complex_operation_with_savepoint():
    """ë³µì¡í•œ ì‘ì—…ì—ì„œ ì„¸ì´ë¸Œí¬ì¸íŠ¸ í™œìš©"""
    
    # ì²« ë²ˆì§¸ ì‘ì—…
    Jikwon.objects.create(jikwonname='ì‹ ê·œì§ì›', jikwonpay=3000)
    
    # ì„¸ì´ë¸Œí¬ì¸íŠ¸ ìƒì„±
    savepoint = transaction.savepoint()
    
    try:
        # ìœ„í—˜í•œ ì‘ì—…
        risky_operation()
        transaction.savepoint_commit(savepoint)
    except Exception:
        # ì„¸ì´ë¸Œí¬ì¸íŠ¸ë¡œ ë¡¤ë°± (ì²« ë²ˆì§¸ ì‘ì—…ì€ ìœ ì§€)
        transaction.savepoint_rollback(savepoint)
```

#### 2. ìºì‹± ì „ëµ
```python
from django.core.cache import cache
from django.views.decorators.cache import cache_page

@cache_page(60 * 15)  # 15ë¶„ ìºì‹±
def cached_department_stats(request):
    """ë¶€ì„œ í†µê³„ ìºì‹±"""
    cache_key = 'department_stats'
    stats = cache.get(cache_key)
    
    if stats is None:
        stats = (
            Buser.objects
            .annotate(
                ì§ì›ìˆ˜=Count('jikwon_set'),
                í‰ê· ì—°ë´‰=Avg('jikwon_set__jikwonpay')
            )
            .filter(ì§ì›ìˆ˜__gt=0)
        )
        cache.set(cache_key, stats, 60 * 60)  # 1ì‹œê°„ ìºì‹±
    
    return render(request, 'department_stats.html', {'stats': stats})

# ì¿¼ë¦¬ì…‹ ìºì‹±
def get_active_employees():
    """í™œì„± ì§ì› ëª©ë¡ ìºì‹±"""
    cache_key = 'active_employees'
    employees = cache.get(cache_key)
    
    if employees is None:
        employees = list(
            Jikwon.objects
            .select_related('busernum')
            .filter(jikwonpay__isnull=False)
            .order_by('jikwonno')
        )
        cache.set(cache_key, employees, 60 * 30)  # 30ë¶„
    
    return employees
```

#### 3. ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° í’€ë§
```python
# settings.pyì—ì„œ ì—°ê²° ì„¤ì • ìµœì í™”
DATABASES = {
    'default': {
        'ENGINE': 'django.db.backends.mysql',
        'NAME': 'mydb',
        'USER': 'root',
        'PASSWORD': '970506',
        'HOST': '127.0.0.1',
        'PORT': '3306',
        'OPTIONS': {
            'charset': 'utf8mb4',
            'init_command': "SET sql_mode='STRICT_TRANS_TABLES'",
            # ì—°ê²° í’€ ì„¤ì •
            'CONN_MAX_AGE': 600,  # ì—°ê²° ìœ ì§€ ì‹œê°„ (ì´ˆ)
            'CONN_HEALTH_CHECKS': True,  # ì—°ê²° ìƒíƒœ ì²´í¬
            # ì„±ëŠ¥ ìµœì í™”
            'read_timeout': 20,
            'write_timeout': 20,
        },
    }
}

# ì½ê¸° ì „ìš© DB ì„¤ì • (ì„ íƒì‚¬í•­)
DATABASE_ROUTERS = ['myapp.routers.DatabaseRouter']

# myapp/routers.py
class DatabaseRouter:
    """ì½ê¸°/ì“°ê¸° DB ë¼ìš°í„°"""
    
    def db_for_read(self, model, **hints):
        """ì½ê¸° ì‘ì—…ì€ ì½ê¸° ì „ìš© DBë¡œ"""
        return 'replica'
    
    def db_for_write(self, model, **hints):
        """ì“°ê¸° ì‘ì—…ì€ ë§ˆìŠ¤í„° DBë¡œ"""
        return 'default'
```

---

## íŠ¸ëŸ¬ë¸”ìŠˆíŒ…

### ğŸš¨ ìì£¼ ë°œìƒí•˜ëŠ” ë¬¸ì œì™€ í•´ê²°ì±…

#### 1. ë§ˆì´ê·¸ë ˆì´ì…˜ ê´€ë ¨ ë¬¸ì œ

```bash
# ë¬¸ì œ: ê¸°ì¡´ í…Œì´ë¸”ê³¼ ì¶©ëŒ
# í•´ê²°: --fake-initial ì˜µì…˜ ì‚¬ìš©
python manage.py migrate --fake-initial

# ë¬¸ì œ: ë§ˆì´ê·¸ë ˆì´ì…˜ íŒŒì¼ ì¶©ëŒ
# í•´ê²°: ë§ˆì´ê·¸ë ˆì´ì…˜ ë¦¬ì…‹
python manage.py migrate myapp zero
python manage.py makemigrations myapp
python manage.py migrate myapp

# ë¬¸ì œ: ForeignKey ê´€ê³„ ì˜¤ë¥˜
# í•´ê²°: ë°ì´í„° ì •í•©ì„± í™•ì¸ í›„ ë§ˆì´ê·¸ë ˆì´ì…˜
python manage.py shell
>>> from myapp.models import *
>>> # ë°ì´í„° ì •í•©ì„± ì²´í¬
>>> invalid_relations = Jikwon.objects.filter(busernum__isnull=True)
>>> print(invalid_relations.count())
```

#### 2. ì„±ëŠ¥ ë¬¸ì œ í•´ê²°

```python
# ë¬¸ì œ: N+1 ì¿¼ë¦¬ ë¬¸ì œ
# í•´ê²° ì „ (ëŠë¦¼)
def slow_view():
    jikwons = Jikwon.objects.all()
    for j in jikwons:
        print(j.busernum.busername)  # ë§¤ë²ˆ DB ì ‘ê·¼

# í•´ê²° í›„ (ë¹ ë¦„)
def fast_view():
    jikwons = Jikwon.objects.select_related('busernum').all()
    for j in jikwons:
        print(j.busernum.busername)  # ë¯¸ë¦¬ ë¡œë“œëœ ë°ì´í„° ì‚¬ìš©

# ë¬¸ì œ: ë©”ëª¨ë¦¬ ë¶€ì¡± (ëŒ€ëŸ‰ ë°ì´í„°)
# í•´ê²°: iterator() ì‚¬ìš©
def memory_efficient_view():
    # í° QuerySetì„ ì²­í¬ ë‹¨ìœ„ë¡œ ì²˜ë¦¬
    for jikwon in Jikwon.objects.iterator(chunk_size=1000):
        process_jikwon(jikwon)
```

#### 3. ì¿¼ë¦¬ ìµœì í™” ë¬¸ì œ

```python
# ë¬¸ì œ: ë³µì¡í•œ ì§‘ê³„ ì¿¼ë¦¬ê°€ ëŠë¦¼
# í•´ê²°: Raw SQLê³¼ ORM í˜¼ìš©
def optimized_complex_query():
    # ORMìœ¼ë¡œ ê¸°ë³¸ í•„í„°ë§
    base_query = Jikwon.objects.filter(jikwonpay__isnull=False)
    
    # ë³µì¡í•œ ë¶€ë¶„ì€ Raw SQL
    raw_sql = """
    SELECT 
        b.busername,
        COUNT(*) as emp_count,
        AVG(j.jikwonpay) as avg_salary,
        RANK() OVER (ORDER BY AVG(j.jikwonpay) DESC) as salary_rank
    FROM jikwon j
    INNER JOIN buser b ON j.busernum = b.buserno
    WHERE j.jikwonpay IS NOT NULL
    GROUP BY b.buserno, b.busername
    HAVING COUNT(*) >= 2
    ORDER BY salary_rank
    """
    
    with connection.cursor() as cursor:
        cursor.execute(raw_sql)
        results = cursor.fetchall()
    
    return results

# ë¬¸ì œ: ë™ì¼í•œ ì¿¼ë¦¬ ë°˜ë³µ ì‹¤í–‰
# í•´ê²°: ë©”ëª¨ì´ì œì´ì…˜ ì ìš©
from functools import lru_cache

@lru_cache(maxsize=128)
def cached_department_list():
    """ë¶€ì„œ ëª©ë¡ ìºì‹±"""
    return list(Buser.objects.all().values('buserno', 'busername'))
```

#### 4. ë°ì´í„° ë¬´ê²°ì„± ë¬¸ì œ

```python
# ë¬¸ì œ: ì™¸ë˜í‚¤ ì œì•½ ì¡°ê±´ ìœ„ë°˜
# í•´ê²°: ë°ì´í„° ê²€ì¦ í›„ ì²˜ë¦¬
def safe_employee_creation(dept_id, employee_data):
    """ì•ˆì „í•œ ì§ì› ìƒì„±"""
    try:
        # ë¶€ì„œ ì¡´ì¬ í™•ì¸
        department = Buser.objects.get(buserno=dept_id)
        
        # ì§ì› ìƒì„±
        employee = Jikwon.objects.create(
            busernum=department,
            **employee_data
        )
        return employee
        
    except Buser.DoesNotExist:
        raise ValueError(f"ë¶€ì„œ ë²ˆí˜¸ {dept_id}ê°€ ì¡´ì¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.")
    except Exception as e:
        raise ValueError(f"ì§ì› ìƒì„± ì¤‘ ì˜¤ë¥˜: {str(e)}")

# ë¬¸ì œ: ì¤‘ë³µ ë°ì´í„° ì²˜ë¦¬
# í•´ê²°: get_or_create ì‚¬ìš©
def ensure_unique_employee(employee_data):
    """ì¤‘ë³µ ë°©ì§€ ì§ì› ìƒì„±"""
    employee, created = Jikwon.objects.get_or_create(
        jikwonno=employee_data['jikwonno'],
        defaults=employee_data
    )
    
    if not created:
        # ê¸°ì¡´ ë°ì´í„° ì—…ë°ì´íŠ¸
        for key, value in employee_data.items():
            setattr(employee, key, value)
        employee.save()
    
    return employee, created
```

---

## ì‹¤ë¬´ ê¶Œì¥ ì‚¬í•­

### ğŸ¯ ORM vs Raw SQL ì„ íƒ ê°€ì´ë“œ

#### ì–¸ì œ ORMì„ ì‚¬ìš©í• ê¹Œ?

**âœ… ORM ê¶Œì¥ ìƒí™©:**
1. **ê¸°ë³¸ CRUD ì‘ì—…**
   ```python
   # ìƒì„±, ì¡°íšŒ, ìˆ˜ì •, ì‚­ì œê°€ ê°„ë‹¨í•œ ê²½ìš°
   user = User.objects.create(name='í™ê¸¸ë™')
   users = User.objects.filter(active=True)
   user.email = 'new@email.com'
   user.save()
   ```

2. **ë³´ì•ˆì´ ì¤‘ìš”í•œ ê²½ìš°**
   ```python
   # SQL ì¸ì ì…˜ ìë™ ë°©ì§€
   search_term = request.GET.get('q')  # ì‚¬ìš©ì ì…ë ¥
   results = Post.objects.filter(title__icontains=search_term)  # ì•ˆì „
   ```

3. **íŒ€ í˜‘ì—…ì—ì„œ ì¼ê´€ì„±ì´ ì¤‘ìš”í•œ ê²½ìš°**
   ```python
   # ëª¨ë“  ê°œë°œìê°€ ë™ì¼í•œ ë°©ì‹ìœ¼ë¡œ ì‘ì„±
   active_employees = Employee.objects.filter(is_active=True)
   ```

4. **í”„ë¡œí† íƒ€ì´í•‘ ë° ë¹ ë¥¸ ê°œë°œ**
   ```python
   # ë¹ ë¥¸ ê°œë°œì´ í•„ìš”í•œ ì´ˆê¸° ë‹¨ê³„
   def quick_analysis():
       return Employee.objects.aggregate(
           avg_salary=Avg('salary'),
           count=Count('id')
       )
   ```

#### ì–¸ì œ Raw SQLì„ ì‚¬ìš©í• ê¹Œ?

**âš¡ Raw SQL ê¶Œì¥ ìƒí™©:**
1. **ë³µì¡í•œ ì§‘ê³„ ë° ë¶„ì„ ì¿¼ë¦¬**
   ```python
   # ë³µì¡í•œ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì´ í¬í•¨ëœ ê²½ìš°
   sql = """
   SELECT 
       d.name,
       COUNT(e.id) as emp_count,
       AVG(e.salary) as avg_salary,
       RANK() OVER (PARTITION BY d.region ORDER BY AVG(e.salary) DESC) as rank
   FROM departments d
   LEFT JOIN employees e ON d.id = e.dept_id
   GROUP BY d.id, d.name, d.region
   HAVING COUNT(e.id) > 5
   """
   ```

2. **ì„±ëŠ¥ì´ ì¤‘ìš”í•œ ëŒ€ìš©ëŸ‰ ì²˜ë¦¬**
   ```python
   # ìˆ˜ë°±ë§Œ ê±´ì˜ ë°ì´í„° ì²˜ë¦¬
   with connection.cursor() as cursor:
       cursor.execute("""
           UPDATE employees 
           SET salary = salary * 1.1 
           WHERE performance_rating = 'A'
           AND hire_date < %s
       """, [cutoff_date])
   ```

3. **ë°ì´í„°ë² ì´ìŠ¤ íŠ¹í™” ê¸°ëŠ¥ ì‚¬ìš©**
   ```python
   # íŠ¹ì • DBì˜ ê³ ê¸‰ ê¸°ëŠ¥ í™œìš©
   cursor.execute("""
       SELECT * FROM employees 
       WHERE MATCH(skills) AGAINST (%s IN BOOLEAN MODE)
   """, [search_term])
   ```

### ğŸ’¡ í˜¼ìš© íŒ¨í„´ (Best Practice)

```python
def hybrid_analysis_view(request):
    """ORMê³¼ Raw SQLì˜ íš¨ê³¼ì ì¸ í˜¼ìš©"""
    
    # 1. ORMìœ¼ë¡œ ê¸°ë³¸ í•„í„°ë§ (ì•ˆì „ì„±)
    base_employees = Employee.objects.filter(
        is_active=True,
        department__is_active=True
    ).select_related('department')
    
    # 2. ì‚¬ìš©ì ì¡°ê±´ ë™ì  ì¶”ê°€ (ORMì˜ ìœ ì—°ì„±)
    if request.GET.get('dept'):
        base_employees = base_employees.filter(
            department__name__icontains=request.GET['dept']
        )
    
    # 3. ë³µì¡í•œ ë¶„ì„ì€ Raw SQL (ì„±ëŠ¥)
    analysis_sql = """
    SELECT 
        dept_id,
        dept_name,
        employee_count,
        avg_salary,
        salary_std,
        performance_score
    FROM complex_analysis_view
    WHERE dept_id IN %s
    """
    
    dept_ids = list(base_employees.values_list('department_id', flat=True))
    
    with connection.cursor() as cursor:
        cursor.execute(analysis_sql, [tuple(dept_ids)])
        analysis_results = cursor.fetchall()
    
    # 4. ê²°ê³¼ ì¡°í•© ë° ë°˜í™˜
    return render(request, 'analysis.html', {
        'employees': base_employees,
        'analysis': analysis_results
    })
```

### ğŸ”¥ ì„±ëŠ¥ ìµœì í™” ì²´í¬ë¦¬ìŠ¤íŠ¸

#### ORM ì„±ëŠ¥ ìµœì í™”
- [ ] `select_related()` ì‚¬ìš©ìœ¼ë¡œ N+1 ë¬¸ì œ í•´ê²°
- [ ] `prefetch_related()` ë¡œ ì—­ë°©í–¥ ê´€ê³„ ìµœì í™”
- [ ] `only()`, `defer()` ë¡œ í•„ìš”í•œ í•„ë“œë§Œ ì¡°íšŒ
- [ ] `exists()` ë¡œ ë¶ˆí•„ìš”í•œ ë°ì´í„° ë¡œë”© ë°©ì§€
- [ ] `iterator()` ë¡œ ë©”ëª¨ë¦¬ íš¨ìœ¨ì  ëŒ€ìš©ëŸ‰ ì²˜ë¦¬
- [ ] `bulk_create()`, `bulk_update()` ë¡œ ëŒ€ëŸ‰ ì²˜ë¦¬ ìµœì í™”

#### ë°ì´í„°ë² ì´ìŠ¤ ì„¤ê³„ ìµœì í™”
- [ ] ì ì ˆí•œ ì¸ë±ìŠ¤ ìƒì„±
- [ ] ì™¸ë˜í‚¤ ì œì•½ ì¡°ê±´ ì„¤ì •
- [ ] íŒŒí‹°ì…”ë‹ ê³ ë ¤ (ëŒ€ìš©ëŸ‰ ë°ì´í„°)
- [ ] ì •ê·œí™”/ë¹„ì •ê·œí™” ê· í˜•

#### ìºì‹± ì „ëµ
- [ ] ì¿¼ë¦¬ ê²°ê³¼ ìºì‹±
- [ ] í…œí”Œë¦¿ í”„ë˜ê·¸ë¨¼íŠ¸ ìºì‹±
- [ ] Redis/Memcached í™œìš©

---

## ë§ˆë¬´ë¦¬: ê°•ì‚¬ë‹˜ì˜ ì‹¤ë¬´ ì² í•™

### ğŸ“ í•µì‹¬ ë©”ì‹œì§€
> **"íŒ¨í„´ì„ ì½ì–´ì•¼ ë¼ìš”. ëª…ë ¹ì„ ì™¸ìš°ë¼ëŠ” ì–˜ê¸°ê°€ ì•„ë‹ˆì•¼ íŒ¨í„´ì„ ì½ìœ¼ì„¸ìš”."**

> **"ì¥ê³  ORMì„ ì¨ë„ ë˜ê³  ê·¸ëƒ¥ Raw SQL ë¬¸ì¥ì„ ì¨ë„ ê´œì°®ì•„ìš”. í¸í•œ ê±¸ë¡œ í•˜ì‹œë©´ ë©ë‹ˆë‹¤."**

### ğŸš€ ì‹¤ë¬´ ê°œë°œìë¡œ ì„±ì¥í•˜ê¸°

1. **ë„êµ¬ì˜ ì¥ë‹¨ì  ì´í•´**: ORMê³¼ Raw SQL ê°ê°ì˜ íŠ¹ì„±ì„ íŒŒì•…í•˜ê³  ìƒí™©ì— ë§ê²Œ ì„ íƒ
2. **ì„±ëŠ¥ ê°ê° ê¸°ë¥´ê¸°**: ì¿¼ë¦¬ ì‹¤í–‰ ê³„íšì„ ë³´ê³  ë³‘ëª©ì ì„ ì°¾ëŠ” ëŠ¥ë ¥
3. **ë³´ì•ˆ ì˜ì‹**: SQL ì¸ì ì…˜, XSS ë“± ì›¹ ë³´ì•ˆ ìœ„í˜‘ì— ëŒ€í•œ ì´í•´
4. **í˜‘ì—… ê³ ë ¤**: íŒ€ì›ë“¤ì´ ì´í•´í•˜ê¸° ì‰¬ìš´ ì½”ë“œ ì‘ì„±
5. **ì§€ì†ì ì¸ í•™ìŠµ**: ìƒˆë¡œìš´ ORM ê¸°ëŠ¥ê³¼ ë°ì´í„°ë² ì´ìŠ¤ ê¸°ìˆ  ìŠµë“

### ğŸ† ìµœì¢… ê¶Œì¥ íŒ¨í„´

```python
# ì‹¤ë¬´ì—ì„œ ê¶Œì¥í•˜ëŠ” Django ë·° íŒ¨í„´
from django.shortcuts import render
from django.db.models import Count, Avg, Q, F
from django.db import connection
from django.core.cache import cache
from django.utils.html import escape

def production_ready_view(request):
    """ì‹¤ë¬´ì— ë°”ë¡œ ì ìš© ê°€ëŠ¥í•œ ë·° íŒ¨í„´"""
    
    # 1. ì•ˆì „í•œ ì‚¬ìš©ì ì…ë ¥ ì²˜ë¦¬
    search_term = escape(request.GET.get('search', '').strip())
    dept_filter = escape(request.GET.get('dept', '').strip())
    
    # 2. ê¸°ë³¸ì€ ORM ì‚¬ìš© (ì•ˆì „ì„±, ê°€ë…ì„±)
    employees = Employee.objects.select_related('department')
    
    # 3. ë™ì  í•„í„°ë§ (ìœ ì—°ì„±)
    if search_term:
        employees = employees.filter(
            Q(name__icontains=search_term) |
            Q(email__icontains=search_term)
        )
    
    if dept_filter:
        employees = employees.filter(
            department__name__icontains=dept_filter
        )
    
    # 4. ìºì‹± í™œìš© (ì„±ëŠ¥)
    cache_key = f"dept_stats_{dept_filter}"
    dept_stats = cache.get(cache_key)
    
    if dept_stats is None:
        # 5. ë³µì¡í•œ ë¶„ì„ì€ ìƒí™©ì— ë”°ë¼ Raw SQL ê³ ë ¤
        if len(employees) > 10000:  # ëŒ€ìš©ëŸ‰ ë°ì´í„°
            # Raw SQL ì‚¬ìš©
            with connection.cursor() as cursor:
                cursor.execute(complex_analysis_sql, params)
                dept_stats = cursor.fetchall()
        else:
            # ORM ì‚¬ìš©
            dept_stats = employees.values('department__name').annotate(
                count=Count('id'),
                avg_salary=Avg('salary')
            )
        
        cache.set(cache_key, dept_stats, 300)  # 5ë¶„ ìºì‹±
    
    # 6. ëª…í™•í•œ ì»¨í…ìŠ¤íŠ¸ ë°˜í™˜
    context = {
        'employees': employees[:100],  # í˜ì´ì§• ê³ ë ¤
        'dept_stats': dept_stats,
        'search_term': search_term,
        'total_count': employees.count(),
    }
    
    return render(request, 'employees.html', context)
```

Django ORMì€ ê°•ë ¥í•œ ë„êµ¬ì´ì§€ë§Œ, **ìƒí™©ì— ë§ëŠ” ì„ íƒ**ì´ ê°€ì¥ ì¤‘ìš”í•©ë‹ˆë‹¤. ê¸°ë³¸ì ìœ¼ë¡œëŠ” ORMì˜ ì•ˆì „ì„±ê³¼ í¸ì˜ì„±ì„ í™œìš©í•˜ë˜, ì„±ëŠ¥ì´ë‚˜ ë³µì¡ì„± ë•Œë¬¸ì— í•„ìš”í•˜ë‹¤ë©´ Raw SQLì„ ì£¼ì €í•˜ì§€ ë§ê³  ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ì‹¤ë¬´ì˜ ì§€í˜œì…ë‹ˆë‹¤.

**"í¸í•œ ê±¸ë¡œ í•˜ë˜, ê·¸ ì„ íƒì˜ ì´ìœ ë¥¼ ëª…í™•íˆ ì•„ëŠ” ê°œë°œì"**ê°€ ë˜ì‹œê¸¸ ë°”ëë‹ˆë‹¤! ğŸ¯
# 19ë²ˆ - SQLiteì™€ Pandasë¥¼ í™œìš©í•œ ë°ì´í„° ë¶„ì„

## ğŸ“‹ ëª©ì°¨
1. [Local Database ì—°ë™](#local-database-ì—°ë™)
2. [í…Œì´ë¸” ìƒì„± ë° ë°ì´í„° ì‚½ì…](#í…Œì´ë¸”-ìƒì„±-ë°-ë°ì´í„°-ì‚½ì…)
3. [Pandas DataFrameê³¼ SQL ì—°ë™](#pandas-dataframeê³¼-sql-ì—°ë™)
4. [ì‹¤ìŠµ ì˜ˆì œ](#ì‹¤ìŠµ-ì˜ˆì œ)
5. [ë³´ì•ˆ ê³ ë ¤ì‚¬í•­](#ë³´ì•ˆ-ê³ ë ¤ì‚¬í•­)

---

## Local Database ì—°ë™

SQLiteëŠ” íŒŒì¼ ê¸°ë°˜ì˜ ê²½ëŸ‰ ë°ì´í„°ë² ì´ìŠ¤ë¡œ, Pythonì—ì„œ ê¸°ë³¸ì ìœ¼ë¡œ ì§€ì›ë©ë‹ˆë‹¤.

```python
import sqlite3
import pandas as pd

# ë©”ëª¨ë¦¬ DB ì—°ê²° (ì„ì‹œ ì €ì¥)
conn = sqlite3.connect(':memory:')

# íŒŒì¼ DB ì—°ê²° (ì˜êµ¬ ì €ì¥)
# conn = sqlite3.connect('test.db')
```

### ì—°ê²° ë°©ì‹ì˜ ì°¨ì´ì 
- **`:memory:`**: ë©”ëª¨ë¦¬ì— ì„ì‹œ ì €ì¥, í”„ë¡œê·¸ë¨ ì¢…ë£Œ ì‹œ ë°ì´í„° ì‚­ì œ
- **`íŒŒì¼ëª….db`**: íŒŒì¼ë¡œ ì˜êµ¬ ì €ì¥, ì¬ì‹¤í–‰ ì‹œì—ë„ ë°ì´í„° ìœ ì§€

---

## í…Œì´ë¸” ìƒì„± ë° ë°ì´í„° ì‚½ì…

### 1. í…Œì´ë¸” ìƒì„±

```python
# í…Œì´ë¸” ìƒì„± SQL (ì‹¤í—˜ìš© 4ê°œ ì»¬ëŸ¼)
sql = """
CREATE TABLE IF NOT EXISTS test(
    product VARCHAR(10), 
    maker VARCHAR(10), 
    weight REAL, 
    price INTEGER
);
"""

conn.execute(sql)
conn.commit()
```

### 2. ë‹¨ì¼ ë°ì´í„° ì‚½ì…

```python
# ğŸ”’ ë³´ì•ˆì„ ìœ„í•œ ë§¤ê°œë³€ìˆ˜í™” ì¿¼ë¦¬ ì‚¬ìš©
stmt = "INSERT INTO test VALUES(?, ?, ?, ?)"

# ë°ì´í„° ì¤€ë¹„ (íŠœí”Œ í˜•íƒœ)
data1 = ('mouse', 'samsung', 12.5, 5000)
data2 = ('mouse2', 'samsung', 15, 5000)

# ë°ì´í„° ì‚½ì…
conn.execute(stmt, data1)
conn.execute(stmt, data2)
```

### 3. ë‹¤ì¤‘ ë°ì´í„° ì‚½ì…

```python
# ì—¬ëŸ¬ ë°ì´í„°ë¥¼ ë¦¬ìŠ¤íŠ¸ë¡œ ì¤€ë¹„
datas = [
    ('mouse3', 'lg', 22.5, 5000), 
    ('mouse4', 'lg', 18.5, 5000)
]

# í•œ ë²ˆì— ì—¬ëŸ¬ ë°ì´í„° ì‚½ì…
conn.executemany(stmt, datas)
```

---

## Pandas DataFrameê³¼ SQL ì—°ë™

### 1. SQL â†’ DataFrame

#### ë°©ë²• 1: ì§ì ‘ ë³€í™˜
```python
# ë°ì´í„° ì¡°íšŒ
cursor = conn.cursor()
cursor.execute("SELECT * FROM test")
rows = cursor.fetchall()

# DataFrameìœ¼ë¡œ ë³€í™˜
df = pd.DataFrame(rows, columns=['product', 'maker', 'weight', 'price'])
print(df)
```

#### ë°©ë²• 2: pandas.read_sql ì‚¬ìš© â­
```python
# í•œ ë²ˆì— DataFrameìœ¼ë¡œ ì½ê¸°
df2 = pd.read_sql("SELECT * FROM test", conn)
print(df2)
```

### 2. DataFrame â†’ SQL

```python
# ìƒˆë¡œìš´ ë°ì´í„° ìƒì„±
pdata = {
    'product': ['ì—°í•„', 'ë³¼íœ', 'ì§€ìš°ê°œ'],
    'maker': ['ëª¨ë‚˜ë¯¸', 'ëª¨ë‚˜ë¯¸', 'ëª¨ë‚˜ë¯¸'],
    'weight': [10, 20, 30],
    'price': [1000, 2000, 3000]
}

frame = pd.DataFrame(pdata)

# DataFrameì„ í…Œì´ë¸”ì— ì‚½ì…
frame.to_sql('test', conn, if_exists='append', index=False)
```

### to_sql ì˜µì…˜
- **`if_exists='append'`**: ê¸°ì¡´ í…Œì´ë¸”ì— ì¶”ê°€
- **`if_exists='replace'`**: í…Œì´ë¸”ì„ ìƒˆë¡œ ìƒì„±
- **`if_exists='fail'`**: í…Œì´ë¸”ì´ ì¡´ì¬í•˜ë©´ ì˜¤ë¥˜ ë°œìƒ
- **`index=False`**: DataFrameì˜ ì¸ë±ìŠ¤ë¥¼ í…Œì´ë¸”ì— í¬í•¨í•˜ì§€ ì•ŠìŒ

---

## ì‹¤ìŠµ ì˜ˆì œ

### ì „ì²´ ì½”ë“œ

```python
import sqlite3
import pandas as pd

# 1. ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²°
conn = sqlite3.connect(':memory:')

# 2. í…Œì´ë¸” ìƒì„±
sql = "CREATE TABLE IF NOT EXISTS test(product VARCHAR(10), maker VARCHAR(10), weight REAL, price INTEGER);"
conn.execute(sql)
conn.commit()

# 3. ë°ì´í„° ì‚½ì…
stmt = "INSERT INTO test VALUES(?, ?, ?, ?)"

# ë‹¨ì¼ ë°ì´í„°
data1 = ('mouse', 'samsung', 12.5, 5000)
data2 = ('mouse2', 'samsung', 15, 5000)
conn.execute(stmt, data1)
conn.execute(stmt, data2)

# ë‹¤ì¤‘ ë°ì´í„°
datas = [('mouse3', 'lg', 22.5, 5000), ('mouse4', 'lg', 18.5, 5000)]
conn.executemany(stmt, datas)

# 4. ë°ì´í„° ì¡°íšŒ ë° DataFrame ë³€í™˜
cursor = conn.cursor()
cursor.execute("SELECT * FROM test")
rows = cursor.fetchall()

# ì§ì ‘ ë³€í™˜
df = pd.DataFrame(rows, columns=['product', 'maker', 'weight', 'price'])
print("ğŸ“Š ì§ì ‘ ë³€í™˜í•œ DataFrame:")
print(df)

# pandas.read_sql ì‚¬ìš©
df2 = pd.read_sql("SELECT * FROM test", conn)
print("\nğŸ“Š read_sqlë¡œ ì½ì€ DataFrame:")
print(df2)

# 5. DataFrameì„ í…Œì´ë¸”ì— ì €ì¥
pdata = {
    'product': ['ì—°í•„', 'ë³¼íœ', 'ì§€ìš°ê°œ'],
    'maker': ['ëª¨ë‚˜ë¯¸', 'ëª¨ë‚˜ë¯¸', 'ëª¨ë‚˜ë¯¸'],
    'weight': [10, 20, 30],
    'price': [1000, 2000, 3000]
}

frame = pd.DataFrame(pdata)
frame.to_sql('test', conn, if_exists='append', index=False)

# 6. ìµœì¢… ê²°ê³¼ í™•ì¸
df3 = pd.read_sql("SELECT * FROM test", conn)
print("\nğŸ’¾ test í…Œì´ë¸”ì˜ ì „ì²´ ë‚´ìš©:")
print(df3)

# 7. ë¦¬ì†ŒìŠ¤ ì •ë¦¬
cursor.close()
conn.close()
```

### ì‹¤í–‰ ê²°ê³¼ ì˜ˆì‹œ

```
ğŸ“Š ì§ì ‘ ë³€í™˜í•œ DataFrame:
  product    maker  weight  price
0   mouse  samsung    12.5   5000
1  mouse2  samsung    15.0   5000
2  mouse3       lg    22.5   5000
3  mouse4       lg    18.5   5000

ğŸ“Š read_sqlë¡œ ì½ì€ DataFrame:
  product    maker  weight  price
0   mouse  samsung    12.5   5000
1  mouse2  samsung    15.0   5000
2  mouse3       lg    22.5   5000
3  mouse4       lg    18.5   5000

ğŸ’¾ test í…Œì´ë¸”ì˜ ì „ì²´ ë‚´ìš©:
  product    maker  weight  price
0   mouse  samsung    12.5   5000
1  mouse2  samsung    15.0   5000
2  mouse3       lg    22.5   5000
3  mouse4       lg    18.5   5000
4      ì—°í•„      ëª¨ë‚˜ë¯¸    10.0   1000
5      ë³¼íœ      ëª¨ë‚˜ë¯¸    20.0   2000
6     ì§€ìš°ê°œ      ëª¨ë‚˜ë¯¸    30.0   3000
```

---

## ë³´ì•ˆ ê³ ë ¤ì‚¬í•­

### âš ï¸ SQL Injection ë°©ì§€

**âŒ ì˜ëª»ëœ ë°©ë²•**
```python
# ì§ì ‘ ë¬¸ìì—´ ì‚½ì… (ë³´ì•ˆ ìœ„í—˜!)
query = f"INSERT INTO test VALUES('{product}', '{maker}', {weight}, {price})"
```

**âœ… ì˜¬ë°”ë¥¸ ë°©ë²•**
```python
# ë§¤ê°œë³€ìˆ˜í™” ì¿¼ë¦¬ ì‚¬ìš©
stmt = "INSERT INTO test VALUES(?, ?, ?, ?)"
conn.execute(stmt, (product, maker, weight, price))
```

### ì¤‘ìš” í¬ì¸íŠ¸
- **ë¬¼ìŒí‘œ(?) í”Œë ˆì´ìŠ¤í™€ë”** ì‚¬ìš©ìœ¼ë¡œ SQL Injection ë°©ì§€
- **ì‹œíì–´ ì½”ë”© ê°€ì´ë“œë¼ì¸** ì¤€ìˆ˜
- **ë§¤ê°œë³€ìˆ˜ ë°”ì¸ë”©**ì„ í†µí•œ ì•ˆì „í•œ ë°ì´í„° ì²˜ë¦¬

---

## ì¶”ê°€ í™œìš© ë°©ì•ˆ

### 1. HTML ì¶œë ¥
```python
# DataFrameì„ HTMLë¡œ ë³€í™˜ (Django ë“±ì—ì„œ í™œìš©)
html_output = df.to_html()
print(html_output)
```

### 2. ì¡°ê±´ë¶€ ì¿¼ë¦¬
```python
# íŠ¹ì • ì¡°ê±´ìœ¼ë¡œ ë°ì´í„° í•„í„°ë§
filtered_df = pd.read_sql(
    "SELECT * FROM test WHERE maker = 'samsung'", 
    conn
)
```

### 3. ì§‘ê³„ í•¨ìˆ˜ í™œìš©
```python
# ì œì¡°ì‚¬ë³„ í‰ê·  ê°€ê²©
avg_price = pd.read_sql(
    "SELECT maker, AVG(price) as avg_price FROM test GROUP BY maker", 
    conn
)
```

---

## ğŸš¨ ê°•ì˜ì—ì„œ ê°•ì¡°í•œ ì¤‘ìš” ì²´í¬ í¬ì¸íŠ¸

### 1. **íŠœí”Œ ë°ì´í„° ì‘ì„± ì‹œ ì£¼ì˜ì‚¬í•­** âš ï¸
```python
# âŒ ì˜ëª»ëœ ë°©ë²• - íŠœí”Œì´ ì•„ë‹˜!
data = (4)  # ì´ê±´ ê·¸ëƒ¥ ìˆ«ì 4

# âœ… ì˜¬ë°”ë¥¸ ë°©ë²• - ê¼­ ì‰¼í‘œë¥¼ ì°ì–´ì•¼ í•¨!
data = (4,)  # ì´ì œì•¼ íŠœí”Œ!

# ì‹¤ì œ ì‚¬ìš©
data1 = ('mouse', 'samsung', 12.5, 5000)  # ì˜¬ë°”ë¥¸ íŠœí”Œ
```

**ğŸ’¡ í•µì‹¬**: "ë°ì´í„°ê°€ í•˜ë‚˜ì¼ ë•ŒëŠ” ê¼­ ì½¤ë§ˆë¥¼ ì°ì–´ ì¤˜ì•¼ ë¼. íŒŒì´ì¬ì—ì„œ ì‹¤ìˆ˜í•˜ëŠ” ê²½ìš°ê°€ ë˜ê²Œ ë§ë‹¤"

### 2. **ë³´ì•ˆ ì½”ë”© - ë§¤ê°œë³€ìˆ˜í™” ì¿¼ë¦¬ í•„ìˆ˜** ğŸ”’
```python
# âŒ ìœ„í—˜í•œ ë°©ë²• (SQL Injection ì·¨ì•½)
query = f"INSERT INTO test VALUES('{product}', '{maker}', {weight}, {price})"

# âœ… ì•ˆì „í•œ ë°©ë²• (ë§¤ê°œë³€ìˆ˜í™” ì¿¼ë¦¬)
stmt = "INSERT INTO test VALUES(?, ?, ?, ?)"
conn.execute(stmt, data)
```

**ğŸ’¡ í•µì‹¬**: "ë¬¼ìŒí‘œë¥¼ ì¨ì„œ ë§¤í•‘ì„ í•´ì•¼ì§€. ë¬¸ìì—´ ë”í•˜ê¸°ë¡œ ì§‘ì–´ë„£ìœ¼ë©´ ì‹œíì–´ ì½”ë”©ì— ìœ„ë°°ë˜ëŠ” ê±°ì•¼. ê°€ì´ë“œë¼ì¸ì— ê±¸ë¦°ë‹¤."

### 3. **ë©”ëª¨ë¦¬ DB vs íŒŒì¼ DB êµ¬ë¶„** ğŸ’¾
```python
# ì‹¤í—˜ìš© - ë©”ëª¨ë¦¬ì—ë§Œ ì¡´ì¬ (í”„ë¡œê·¸ë¨ ì¢…ë£Œì‹œ ì‚­ì œ)
conn = sqlite3.connect(':memory:')

# ì˜êµ¬ ì €ì¥ìš© - íŒŒì¼ë¡œ ì €ì¥
conn = sqlite3.connect('test.db')  # test.db íŒŒì¼ì´ ìƒì„±ë¨
```

**ğŸ’¡ í•µì‹¬**: "ë©”ëª¨ë¦¬ëŠ” ì‹¤í—˜ìš©ì´ë‹¤. ë§¤ë²ˆ ì‹¤í–‰í•  ë•Œë§ˆë‹¤ í…Œì´ë¸”ì´ ë‹¤ì‹œ ë§Œë“¤ì–´ì§€ë©´ì„œ ë¨ì—ì„œë§Œ ì¡´ì¬"

### 4. **pandas.read_sql()ì˜ ê°•ë ¥í•¨** â­
```python
# ì§ì ‘ ë³€í™˜ (ë²ˆê±°ë¡œìš´ ë°©ë²•)
cursor = conn.cursor()
cursor.execute("SELECT * FROM test")
rows = cursor.fetchall()
df = pd.DataFrame(rows, columns=['product', 'maker', 'weight', 'price'])

# pandasë¡œ í•œ ë²ˆì—! (ê¶Œì¥ ë°©ë²•)
df2 = pd.read_sql("SELECT * FROM test", conn)
```

**ğŸ’¡ í•µì‹¬**: "êµ³ì´ íŒ¨ì¹˜ì˜¬ê¹Œì§€ í•  í•„ìš”ê°€ ì—†ì–´ìš”. íŒë‹¤ìŠ¤ëŠ” ì •ë§ í›Œë¥­í•˜ì£ . ë°”ë¡œ ë°ì´í„° í”„ë ˆì„ìœ¼ë¡œ ë§Œë“¤ì–´ì§€ëŠ” ê±°ì£ !"

### 5. **DataFrame.to_sql() í™œìš©** ğŸ”„
```python
# DataFrameì„ ë°ì´í„°ë² ì´ìŠ¤ë¡œ!
frame.to_sql('test', conn, if_exists='append', index=False)
```

**to_sql ì¤‘ìš” ì˜µì…˜ë“¤**:
- **`if_exists='append'`**: ê¸°ì¡´ í…Œì´ë¸”ì— ì¶”ê°€
- **`index=False`**: DataFrame ì¸ë±ìŠ¤ëŠ” ì œì™¸í•˜ê³  ì €ì¥

**ğŸ’¡ í•µì‹¬**: "êº¼ê¾¸ë¡œ ë°ì´í„° í”„ë ˆì„ì— ìˆëŠ” ë‚´ìš©ì„ DBì— ì €ì¥í•  ìˆ˜ ìˆì–´ì•¼ ë˜ê² ì£ ?"

### 6. **try-except ì˜ˆì™¸ ì²˜ë¦¬ì˜ ì¤‘ìš”ì„±** ğŸ›¡ï¸
```python
# ì‹¤ë¬´ì—ì„œëŠ” ë°˜ë“œì‹œ í•„ìš”!
try:
    conn.execute(stmt, data)
    conn.commit()
except sqlite3.Error as e:
    print(f"ë°ì´í„°ë² ì´ìŠ¤ ì˜¤ë¥˜: {e}")
    conn.rollback()
finally:
    cursor.close()
    conn.close()
```

**ğŸ’¡ í•µì‹¬**: "DB ì²˜ë¦¬, ë„¤íŠ¸ì›Œí¬ ì²˜ë¦¬, íŒŒì¼ ì²˜ë¦¬ ì´ëŸ° ê²ƒë“¤ì€ ê¼­ try-except ë¬¸ì¥ì„ ì¨ ì¤˜ì•¼ ë¼ìš”"

### 7. **HTML ì¶œë ¥ìœ¼ë¡œ ì›¹ ì—°ë™** ğŸŒ
```python
# Django ë“± ì›¹ í”„ë ˆì„ì›Œí¬ì—ì„œ í™œìš©
html_output = df.to_html()
print(html_output)  # HTML í…Œì´ë¸”ë¡œ ë³€í™˜
```

**ğŸ’¡ í•µì‹¬**: "HTMLë¡œ ë³´ë‚¼ ìˆ˜ ìˆìŒ. ì¥ê³  ì´ëŸ°ë°ì„œ ì‚¬ìš©"

---

## ğŸ’¡ í•µì‹¬ ì •ë¦¬

1. **SQLite**ëŠ” Pythonì—ì„œ ê¸°ë³¸ ì§€ì›í•˜ëŠ” ê²½ëŸ‰ ë°ì´í„°ë² ì´ìŠ¤
2. **ë©”ëª¨ë¦¬ DB**ëŠ” ì„ì‹œ ì‹¤í—˜ìš©, **íŒŒì¼ DB**ëŠ” ì˜êµ¬ ì €ì¥ìš©
3. **ë§¤ê°œë³€ìˆ˜í™” ì¿¼ë¦¬(?)**ë¡œ ë³´ì•ˆ ê°•í™” - **ì‹œíì–´ ì½”ë”© í•„ìˆ˜!**
4. **íŠœí”Œ ì‘ì„±ì‹œ ì‰¼í‘œ(,) ì£¼ì˜** - íŒŒì´ì¬ ì‹¤ìˆ˜ ë¹ˆë°œ ì§€ì 
5. **pandas.read_sql()**ë¡œ ê°„í¸í•œ DataFrame ë³€í™˜
6. **DataFrame.to_sql()**ë¡œ ì—­ë°©í–¥ ë°ì´í„° ì €ì¥
7. ì‹¤ë¬´ì—ì„œëŠ” **try-except** ë¬¸ìœ¼ë¡œ ì˜ˆì™¸ ì²˜ë¦¬ í•„ìˆ˜
8. **HTML ë³€í™˜**ìœ¼ë¡œ ì›¹ ì„œë¹„ìŠ¤ ì—°ë™ ê°€ëŠ¥

ì´ ë°©ë²•ì„ í†µí•´ SQLê³¼ Pandasë¥¼ íš¨ê³¼ì ìœ¼ë¡œ ì—°ë™í•˜ì—¬ ë°ì´í„° ë¶„ì„ ì‘ì—…ì„ ìˆ˜í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤!
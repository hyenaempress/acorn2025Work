<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Django ORM ë¶„ì„ - ì§ì› ì •ë³´ ì‹œìŠ¤í…œ</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .card-header { font-weight: bold; }
        .stats-badge { font-size: 1.1em; }
        .orm-indicator { 
            background: linear-gradient(45deg, #28a745, #20c997);
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 0.9em;
        }
        .method-tag {
            background-color: #f8f9fa;
            border: 1px solid #dee2e6;
            padding: 2px 6px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-size: 0.85em;
            color: #495057;
        }
    </style>
</head>
<body>
    <div class="container mt-4">
        <!-- í—¤ë” -->
        <div class="row mb-4">
            <div class="col-12">
                <h1 class="text-center mb-3">
                    ğŸ¢ Django ORM í™œìš© ì§ì› ë¶„ì„ ì‹œìŠ¤í…œ
                </h1>
                <div class="text-center mb-3">
                    <span class="orm-indicator">ğŸ”§ Django ORM ì‚¬ìš©</span>
                </div>
                <p class="text-center text-muted">
                    Raw SQL ëŒ€ì‹  Django ORMì˜ QuerySet APIë¥¼ í™œìš©í•œ ì•ˆì „í•˜ê³  íš¨ìœ¨ì ì¸ ë°ì´í„° ë¶„ì„
                </p>
            </div>
        </div>

        <!-- ê²€ìƒ‰ í¼ -->
        <div class="card mb-4">
            <div class="card-header bg-primary text-white">
                <h5 class="mb-0">ğŸ” ë¶€ì„œë³„ ê²€ìƒ‰</h5>
            </div>
            <div class="card-body">
                <form method="GET" class="row g-3">
                    <div class="col-md-8">
                        <input type="text" 
                               class="form-control" 
                               name="dept" 
                               value="{{ dept }}" 
                               placeholder="ë¶€ì„œëª…ì„ ì…ë ¥í•˜ì„¸ìš” (ì˜ˆ: ì´ë¬´ë¶€, ì˜ì—…ë¶€)">
                    </div>
                    <div class="col-md-4">
                        <button type="submit" class="btn btn-primary w-100">
                            <i class="bi bi-search"></i> ê²€ìƒ‰
                        </button>
                    </div>
                </form>
                <small class="text-muted mt-2 d-block">
                    <span class="method-tag">filter()</span> + 
                    <span class="method-tag">icontains</span> ë£©ì—… ì‚¬ìš©ìœ¼ë¡œ ëŒ€ì†Œë¬¸ì ë¬´ì‹œ ë¶€ë¶„ ê²€ìƒ‰
                </small>
            </div>
        </div>

        <!-- í†µê³„ ìš”ì•½ -->
        <div class="row mb-4">
            <div class="col-lg-3 col-md-6 mb-3">
                <div class="card border-primary">
                    <div class="card-body text-center">
                        <h5 class="card-title text-primary">ì´ ì§ì› ìˆ˜</h5>
                        <h3 class="stats-badge text-primary">{{ total_count }}ëª…</h3>
                        <small class="text-muted"><span class="method-tag">count()</span></small>
                    </div>
                </div>
            </div>
            <div class="col-lg-3 col-md-6 mb-3">
                <div class="card border-info">
                    <div class="card-body text-center">
                        <h5 class="card-title text-info">í™œì„± ë¶€ì„œ</h5>
                        <h3 class="stats-badge text-info">{{ dept_count }}ê°œ</h3>
                        <small class="text-muted"><span class="method-tag">annotate()</span></small>
                    </div>
                </div>
            </div>
            <div class="col-lg-3 col-md-6 mb-3">
                <div class="card border-success">
                    <div class="card-body text-center">
                        <h5 class="card-title text-success">ê³ ê° ë‹´ë‹¹ì</h5>
                        <h3 class="stats-badge text-success">{{ customers_staff_count }}ëª…</h3>
                        <small class="text-muted"><span class="method-tag">Exists()</span></small>
                    </div>
                </div>
            </div>
            <div class="col-lg-3 col-md-6 mb-3">
                <div class="card border-warning">
                    <div class="card-body text-center">
                        <h5 class="card-title text-warning">ê³ ì„±ê³¼ì</h5>
                        <h3 class="stats-badge text-warning">{{ high_performers_count }}ëª…</h3>
                        <small class="text-muted"><span class="method-tag">Q()</span> ê°ì²´</small>
                    </div>
                </div>
            </div>
        </div>

        <!-- ì„±ë³„ í†µê³„ -->
        <div class="card mb-4">
            <div class="card-header bg-info text-white">
                <h5 class="mb-0">ğŸ‘¥ ì„±ë³„ í†µê³„ ë¶„ì„</h5>
                <small>Case/Whenì„ í™œìš©í•œ ì¡°ê±´ë¶€ ì§‘ê³„</small>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6">
                        <h6>ğŸ‘¨ ë‚¨ì„± ì§ì›</h6>
                        <p class="mb-1">ì¸ì›: <strong>{{ gender_stats.ë‚¨ì„±ì§ì›ìˆ˜ }}ëª…</strong></p>
                        <p class="mb-0">í‰ê·  ì—°ë´‰: <strong>{{ gender_stats.ë‚¨ì„±í‰ê· ì—°ë´‰|floatformat:0 }}ë§Œì›</strong></p>
                    </div>
                    <div class="col-md-6">
                        <h6>ğŸ‘© ì—¬ì„± ì§ì›</h6>
                        <p class="mb-1">ì¸ì›: <strong>{{ gender_stats.ì—¬ì„±ì§ì›ìˆ˜ }}ëª…</strong></p>
                        <p class="mb-0">í‰ê·  ì—°ë´‰: <strong>{{ gender_stats.ì—¬ì„±í‰ê· ì—°ë´‰|floatformat:0 }}ë§Œì›</strong></p>
                    </div>
                </div>
            </div>
        </div>

        <!-- ì§ì› ëª©ë¡ -->
        <div class="card mb-4">
            <div class="card-header bg-success text-white">
                <h5 class="mb-0">ğŸ‘¨â€ğŸ’¼ ì§ì› ëª©ë¡ (JOIN ê²°ê³¼)</h5>
                <small>
                    <span class="method-tag">select_related()</span>ë¡œ N+1 ë¬¸ì œ í•´ê²° ë° 
                    <span class="method-tag">filter()</span>ë¡œ ì¡°ê±´ ê²€ìƒ‰
                </small>
            </div>
            <div class="card-body">
                {% if total_count > 0 %}
                    <div class="table-responsive">
                        {{ join_html|safe }}
                    </div>
                    <p class="text-muted mt-2">
                        <strong>ORM ì¿¼ë¦¬:</strong> 
                        <code>Jikwon.objects.select_related('busernum').filter(...).order_by('jikwonno')</code>
                    </p>
                {% else %}
                    <div class="alert alert-warning text-center">
                        <h5>âš ï¸ ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤</h5>
                        <p class="mb-0">ë‹¤ë¥¸ ê²€ìƒ‰ ì¡°ê±´ì„ ì‹œë„í•´ë³´ì„¸ìš”.</p>
                    </div>
                {% endif %}
            </div>
        </div>

        <!-- ë¶€ì„œë³„ í†µê³„ -->
        <div class="card mb-4">
            <div class="card-header bg-warning text-dark">
                <h5 class="mb-0">ğŸ¢ ë¶€ì„œë³„ í†µê³„</h5>
                <small>
                    <span class="method-tag">annotate()</span> + ì§‘ê³„ í•¨ìˆ˜ë“¤ 
                    (<span class="method-tag">Count</span>, <span class="method-tag">Avg</span>, <span class="method-tag">Sum</span>, <span class="method-tag">Max</span>, <span class="method-tag">Min</span>)
                </small>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    {{ dept_html|safe }}
                </div>
                <p class="text-muted mt-2">
                    <strong>ORM ì¿¼ë¦¬:</strong> 
                    <code>Buser.objects.annotate(ì§ì›ìˆ˜=Count('jikwon'), í‰ê· ì—°ë´‰=Avg('jikwon__jikwonpay')...)</code>
                </p>
            </div>
        </div>

        <!-- ì§ê¸‰ë³„ ë¶„ì„ -->
        <div class="card mb-4">
            <div class="card-header bg-danger text-white">
                <h5 class="mb-0">ğŸ“Š ì§ê¸‰ë³„ ë¶„ì„</h5>
                <small>
                    <span class="method-tag">values()</span> + 
                    <span class="method-tag">annotate()</span>ë¡œ GROUP BY êµ¬í˜„
                </small>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    {{ position_html|safe }}
                </div>
                <p class="text-muted mt-2">
                    <strong>ORM ì¿¼ë¦¬:</strong> 
                    <code>Jikwon.objects.values('jikwonjik').annotate(ì¸ì›ìˆ˜=Count('jikwonno')...)</code>
                </p>
            </div>
        </div>

        <!-- ORM ì¥ì  ì„¤ëª… -->
        <div class="card mb-4">
            <div class="card-header bg-dark text-white">
                <h5 class="mb-0">ğŸ”§ Django ORMì˜ ì¥ì </h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6">
                        <h6>âœ… ë³´ì•ˆ ì¸¡ë©´</h6>
                        <ul class="list-group list-group-flush">
                            <li class="list-group-item">SQL ì¸ì ì…˜ ìë™ ë°©ì§€</li>
                            <li class="list-group-item">ë§¤ê°œë³€ìˆ˜ ìë™ ì´ìŠ¤ì¼€ì´í”„</li>
                            <li class="list-group-item">íƒ€ì… ì•ˆì „ì„± ë³´ì¥</li>
                        </ul>
                    </div>
                    <div class="col-md-6">
                        <h6>âœ… ê°œë°œ íš¨ìœ¨ì„±</h6>
                        <ul class="list-group list-group-flush">
                            <li class="list-group-item">ë°ì´í„°ë² ì´ìŠ¤ ë…ë¦½ì„±</li>
                            <li class="list-group-item">ê°ì²´ì§€í–¥ì  ì ‘ê·¼</li>
                            <li class="list-group-item">IntelliSense ì§€ì›</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>

        <!-- ì‚¬ìš©ëœ ORM ë©”ì„œë“œ ìš”ì•½ -->
        <div class="card mb-4">
            <div class="card-header bg-secondary text-white">
                <h5 class="mb-0">ğŸ“‹ ì´ í˜ì´ì§€ì—ì„œ ì‚¬ìš©ëœ ORM ë©”ì„œë“œë“¤</h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-4">
                        <h6>ê¸°ë³¸ ì¡°íšŒ</h6>
                        <span class="method-tag">objects.all()</span><br>
                        <span class="method-tag">filter()</span><br>
                        <span class="method-tag">order_by()</span><br>
                        <span class="method-tag">count()</span>
                    </div>
                    <div class="col-md-4">
                        <h6>ê´€ê³„ & ì„±ëŠ¥</h6>
                        <span class="method-tag">select_related()</span><br>
                        <span class="method-tag">prefetch_related()</span><br>
                        <span class="method-tag">Exists()</span><br>
                        <span class="method-tag">OuterRef()</span>
                    </div>
                    <div class="col-md-4">
                        <h6>ì§‘ê³„ & ì¡°ê±´</h6>
                        <span class="method-tag">annotate()</span><br>
                        <span class="method-tag">aggregate()</span><br>
                        <span class="method-tag">Q()</span><br>
                        <span class="method-tag">F()</span><br>
                        <span class="method-tag">Case/When</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- ë„¤ë¹„ê²Œì´ì…˜ -->
        <div class="text-center mb-4">
            <a href="/dbshow/" class="btn btn-outline-primary me-2">Raw SQL ë²„ì „</a>
            <a href="/orm-examples/" class="btn btn-info me-2">ORM ê¸°ë³¸ ì˜ˆì œ</a>
            <a href="/" class="btn btn-primary">ë©”ì¸ìœ¼ë¡œ</a>
        </div>

        <!-- ê°•ì‚¬ë‹˜ ì¡°ì–¸ -->
        <div class="alert alert-info">
            <h6>ğŸ’¡ ê°•ì‚¬ë‹˜ ì¡°ì–¸</h6>
            <p class="mb-0">
                <em>"ì¥ê³  ORMì„ ì¨ë„ ë˜ê³  ê·¸ëƒ¥ Raw SQL ë¬¸ì¥ì„ ì¨ë„ ê´œì°®ì•„ìš”. í¸í•œ ê±¸ë¡œ í•˜ì‹œë©´ ë©ë‹ˆë‹¤."</em><br>
                ìƒí™©ì— ë§ê²Œ ORMê³¼ Raw SQLì„ ì ì ˆíˆ í˜¼ìš©í•˜ëŠ” ê²ƒì´ ì‹¤ë¬´ì˜ ë² ìŠ¤íŠ¸ í”„ë™í‹°ìŠ¤ì…ë‹ˆë‹¤!
            </p>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>